import{K as he,i as d,s as le,o as s,c as o,h as I,L as xe,b as a,n as g,t as r,m as N,j as we,p as C,f as ke,w as G,d as T,B as se,k as c,a as b,F as M,E as P,I as oe,u as Z,M as Ve,J as Ce}from"./app-d57d0c87.js";import{_ as Be}from"./AppLayout-163c3920.js";import{u as Se,C as re}from"./gameStore-955c2ad7.js";import Ue from"./BonusBattleViewers-f8e346c6.js";import{_ as Te}from"./DialogModal-e128ec45.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./NavLink-dba68a34.js";import"./RegisterForm-6d36e2db.js";import"./AuthenticationCard-320c9634.js";import"./TextInput-524b34f7.js";import"./InputLabel-a05ee1cd.js";import"./PrimaryButton-c502e1cb.js";const Fe=he("battle",{state:()=>({concurrents:[{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null}]}),actions:{setConcurrents(p){this.concurrents=p},addConcurrent(p){this.concurrents=Array.from({length:p},()=>({game_id:"",for_user:""}))},updateConcurrent(p,U){this.concurrents[p]={...this.concurrents[p],...U}}},persist:!0}),Ae={class:"relative"},$e=["type","disabled","readonly"],ze={for:"floating_filled",class:"pl-4 pointer-events-none absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-3 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-indigo-600 peer-focus:dark:text-indigo-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-3 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"},S={__name:"MyInput",props:{modelValue:{type:String,default:""},disabled:{type:Boolean,default:!1},type:{type:String,default:"text"},label:{type:String,required:!0}},emits:["update:modelValue","input"],setup(p,{emit:U}){const n=p,B=U,w=d(n.modelValue),F=y=>{const _=y.target.value;w.value=_,B("input",_)};return le(w,y=>{B("update:modelValue",y)}),le(()=>n.modelValue,y=>{w.value=y}),(y,_)=>(s(),o("div",Ae,[I(a("input",{type:p.type,"onUpdate:modelValue":_[0]||(_[0]=h=>w.value=h),disabled:p.disabled,readonly:p.disabled,placeholder:" ",class:g([{"input-disabled":p.disabled},"input-primary block rounded-t-lg px-2.5 pb-2.5 pt-5 w-full text-sm border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 focus:outline-none focus:ring-0 peer"]),onInput:F},null,42,$e),[[xe,w.value]]),a("label",ze,r(p.label),1)]))}};const Ee={class:"py-4"},Ne={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ge={key:0,class:"px-6 py-3 flex items-center justify-between bg-gray-800 rounded-md shadow-md transition-all duration-300"},Me={class:"flex items-center space-x-4"},Pe={class:"text-sm font-bold py-1 px-3 bg-gray-700 rounded-md border border-gray-600 transition"},Le={class:"flex items-center space-x-4"},Re={class:"ml-3 text-sm font-medium text-gray-300 flex items-center gap-2"},je={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},Oe={key:1,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},De={class:"p-6 space-y-4"},He={class:"flex flex-row gap-2"},Je={class:"ml-3 text-sm font-medium text-gray-300 flex items-center gap-2"},Ke={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},We={class:"flex flex-col md:flex-row md:space-x-4"},qe={class:"md:w-2/3 bg-gray-800 p-6 rounded-md shadow-md space-y-4 transition-all duration-300"},Ze={class:"text-lg font-semibold text-gray-300 flex gap-2 items-center"},Ie={class:"flex gap-4"},Qe={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},Xe={class:"relative z-10 flex items-center gap-4 w-full"},Ye=["src"],et=["disabled"],tt={key:2,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},at={class:"p-6 flex justify-center items-center bg-gray-800"},lt={class:"w-full max-w-md bg-gray-800 shadow-lg rounded-md p-6 text-center transition-all duration-300"},st=["src"],ot={class:"text-2xl font-bold text-gray-100 mb-2"},rt={class:"text-lg font-medium text-gray-300"},nt={key:3,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md mt-6 transition-all duration-300"},it={class:"p-6"},dt={class:"flex flex-row justify-between"},ut={class:"text-xl font-bold mb-4 text-gray-100"},ct={class:"text-gray-300"},pt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},mt={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},bt={class:"flex gap-2 items-center mb-2 p-2 rounded-md border border-gray-600 transition-all duration-300"},gt=["src"],vt={class:"w-full"},ft={class:"text-lg font-bold mb-2 text-gray-100"},yt={class:"flex flex-row gap-2"},_t=["onClick","disabled"],ht=["disabled"],xt={class:"mt-4 text-lg font-bold text-gray-100"},wt={key:1,class:"mt-4"},kt={class:"text-lg font-bold text-gray-100"},Vt={class:"mt-6 flex flex-col gap-4"},Ct=["disabled"],Bt=["disabled"],St={class:"p-6"},Ut={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2 transition-all duration-300"},Tt={class:"px-4 py-2 font-bold"},Ft={class:"px-4 py-2"},At={key:1,class:"table-auto w-full text-sm text-gray-200 transition-all duration-300"},$t={class:"border border-black px-1 py-1 shrink w-0"},zt={class:"border border-black px-2 py-1"},Et={class:"border border-black px-2 py-1"},Wt={__name:"BonusBattle",setup(p){const U=Fe(),n=d(!0),B=d(""),w=d("5-10"),F=d(""),y=d("2"),_=d(!0),h=N(()=>U.concurrents),m=d(null),H=d(null),L=d(null),R=d(null),A=d([{}]),Q=d(null),$=d([]),j=d(!1),z=d(!1),x=d(null),k=d([]);let J=d(!1);const X=Se(),Y=N(()=>X.availableGames);let K=d(null);we(async()=>{await V()});const ee=N(()=>h.value.length<4?!0:h.value.some(l=>!l.game_id)),O=N(()=>A.value?A.value.length<2?!1:A.value.every(l=>l.cost_buy>0):!1),ne=N(()=>`${window.location.origin}/${Ce().props.user.name}`),ie=()=>{J.value=!0},W=()=>{J.value=!1},D=l=>{U.addConcurrent(l)},de=async()=>{await C.patch("/api/bonus-battles/switch-predictions",{is_open:z.value,bonus_battle_id:m.value.id}).then(async()=>{await V()})},te=async()=>{k.value.forEach(l=>{const t=(l==null?void 0:l.scores.length)>0?l.scores[l.scores.length-1].cost_buy:0;l==null||l.scores.push({bracket_id:R.value.id,bonus_concurrent_id:l.id,cost_buy:t,score:0,result_buy:0})}),await q(),await V()},ue=async(l,t)=>{await pe(k.value[l].scores[t].id),k.value[l].scores.splice(t,1),await V()},ae=async(l,t)=>{K&&clearTimeout(K),K=setTimeout(async()=>{const e=k.value[l].scores[t];e.cost_buy>0?(e.score=parseFloat((e.result_buy/e.cost_buy).toFixed(3)),await q()):alert("Amount must be greater than 0.")},1e3)},ce=l=>l.reduce((t,e)=>t+e.score,0).toFixed(3),pe=async l=>{var t;try{n.value=!0;const e=await C.delete(`/api/bonus-battles/delete-score/${l}`);await q()}catch(e){console.error("Failed to delete bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}finally{n.value=!1}},q=async()=>{var l;try{n.value=!0;const t=await C.post("/api/bonus-battles/add-score",{active_bracket:R.value.id,bracket:k.value})}catch(t){console.error("Failed to store bonus score:",((l=t.response)==null?void 0:l.data)||t.message)}finally{n.value=!1}},me=async()=>{var l;if(!B.value||h.value.some(t=>!t.game_id)){alert("All fields must be filled to start.");return}try{await C.post("/api/bonus-battles",{title:B.value,stake:w.value,prize:F.value,buys:y.value,isRandom:_.value,concurrents:h.value}),await V()}catch(t){console.error("Failed to store bonus battle:",((l=t.response)==null?void 0:l.data)||t.message),alert("An error occurred while saving the bonus battle. Please try again.")}},be=async()=>{var l;try{const t=await C.post("/api/bonus-battles/end-battle",{bonus_battle_id:m.value.id});x.value=t.data.winner,await V()}catch(t){console.log("endBattle error:",((l=t.response)==null?void 0:l.data)||t.message)}},ge=async()=>{var l;try{n.value=!0,await C.post("/api/bonus-battles/end-battle-forced",{bonus_battle_id:m.value.id}),W()}catch(t){console.error("Failed to force close bonus battle:",((l=t.response)==null?void 0:l.data)||t.message),alert("A aparut o eroare la închiderea forțată a turneului. Te rugăm să în contactezi pe Mala!")}finally{await V(),n.value=!1}},ve=async()=>{var l;try{n.value=!0,await C.post("/api/bonus-battles/finish-round",{active_bracket:R.value.id}),await V()}catch(t){console.error("Failed to finish round:",((l=t.response)==null?void 0:l.data)||t.message),alert("An error occurred while finishing the round. Please try again.")}finally{n.value=!1}},fe=async(l,t)=>{try{n.value=!0,await C.put("/api/bonus-battles/edit-concurrent",{id:l,game_id:t}),await V(),j.value=!1}catch{alert("Please try again.")}finally{n.value=!1}},V=async()=>{var l,t;try{n.value=!0;const e=await C.get("/api/bonus-battles/active");if(Q.value=e.data.total_battles,m.value=e.data.battle,H.value=e.data.concurrents,L.value=e.data.stage,R.value=e.data.bracket,A.value=e.data.scores,$.value=e.data.history,z.value=Boolean((l=e.data.battle)==null?void 0:l.is_open),B.value="Bonus Battle #"+(Q.value+1),H.value){const i=H.value;k.value=i.slice(0,2).map(u=>{const f=A.value.filter(_e=>_e.bonus_concurrent_id===u.id);return{...u,scores:f.length?f:[]}})}if(k.value.some(i=>i.scores.length===0)){const i=((t=m.value)==null?void 0:t.buys)||0;if(i>0)for(let u=0;u<i;u++)await te()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{n.value=!1}},E=l=>{const t=X.availableGames.find(e=>e.id===l);return t?`/storage/games/${t.image}`:""},ye=l=>{h.value=h.value.map((t,e)=>({...t,for_user:l[e]!==void 0?l[e]:""}))};return(l,t)=>(s(),ke(Be,{title:"Bonus Battle"},{default:G(()=>[a("div",Ee,[a("div",Ne,[m.value?(s(),o("div",Ge,[a("div",Me,[t[12]||(t[12]=a("span",{class:"text-sm text-gray-300"},"LINK pentru View-eri (predicții)",-1)),a("div",Pe,r(ne.value),1)]),a("div",Le,[a("span",Re,[T(r(z.value?"Predicții Pornite":"Predicții Oprite")+" ",1),a("label",je,[I(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),onChange:de,class:"sr-only peer"},null,544),[[se,z.value]]),t[13]||(t[13]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),a("button",{class:"btn-danger",onClick:ie}," INCHIDE TURNEU FORȚAT ")])])):c("",!0),!m.value&&!x.value?(s(),o("div",Oe,[a("div",De,[a("div",He,[b(S,{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e),label:"Titlu Bonus Battle",type:"text"},null,8,["modelValue"]),b(S,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),label:"Miză (eg: 5-8, 5, 10-20)",type:"text"},null,8,["modelValue"]),b(S,{modelValue:F.value,"onUpdate:modelValue":t[3]||(t[3]=e=>F.value=e),label:"Premiu",type:"text"},null,8,["modelValue"]),b(S,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),label:"Câte buys per joc",type:"text"},null,8,["modelValue"]),a("div",Je,[a("label",Ke,[I(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":t[5]||(t[5]=e=>_.value=e),class:"sr-only peer"},null,512),[[se,_.value]]),t[14]||(t[14]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))]),T(" "+r(_.value?"Random":"În funcție de lista"),1)])]),a("div",We,[a("div",qe,[a("h3",Ze,[t[15]||(t[15]=T(" Participanți ")),a("div",Ie,[a("button",{onClick:t[6]||(t[6]=e=>D(4)),class:"btn-primary"},"4"),a("button",{onClick:t[7]||(t[7]=e=>D(8)),class:"btn-primary"},"8"),a("button",{onClick:t[8]||(t[8]=e=>D(16)),class:"btn-primary"},"16"),a("button",{onClick:t[9]||(t[9]=e=>D(4)),class:"btn-danger"},"RESET")])]),b(Ve,{name:"fade"},{default:G(()=>[(s(!0),o(M,null,P(h.value,(e,v)=>(s(),o("div",{key:v,class:"relative overflow-hidden flex items-center gap-4 bg-gray-800 p-4 rounded-md shadow transition-all duration-300",style:oe(e.game_id?{"--bg-image":"url("+E(e.game_id)+")"}:{})},[e.game_id?(s(),o("div",Qe)):c("",!0),a("div",Xe,[e.game_id?(s(),o("img",{key:0,src:E(e.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-md"},null,8,Ye)):c("",!0),b(Z(re),{options:Y.value,label:"name",reduce:i=>i.id,modelValue:e.game_id,"onUpdate:modelValue":i=>e.game_id=i,placeholder:"Alege Joc",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),b(S,{modelValue:e.for_user,"onUpdate:modelValue":i=>e.for_user=i,label:"Cine a ales? (opțional)"},null,8,["modelValue","onUpdate:modelValue"])])],4))),128))]),_:1})]),b(Ue,{onWinnersPicked:ye,fillCount:h.value.length},null,8,["fillCount"])]),a("button",{disabled:ee.value,class:g([{"opacity-50 cursor-not-allowed":ee.value},"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300"]),type:"button",onClick:me}," Start ",10,et)])])):c("",!0),x.value&&!m.value?(s(),o("div",tt,[a("div",at,[a("div",lt,[x.value.game.image?(s(),o("img",{key:0,src:E(x.value.game.id),alt:"Game Thumbnail",class:"w-32 mx-auto object-cover rounded-md mb-4"},null,8,st)):c("",!0),a("h2",ot," Câștigător! - "+r(x.value.game.name),1),a("p",rt," User: "+r(x.value.for_user),1)])])])):c("",!0),b(Te,{show:Z(J),onClose:W},{title:G(()=>t[16]||(t[16]=[T(" Ești sigur că vrei să închizi forțat acest Bonus Battle? ")])),content:G(()=>t[17]||(t[17]=[T(" Vom închide forțat acest Bonus Battle și nu vei mai putea reveni la el. Ești sigur că vrei să continui? ")])),footer:G(()=>[a("button",{onClick:W,class:"btn-danger"}," ANULEAZĂ "),a("button",{class:"ml-3 btn-primary",onClick:ge}," ÎNCHIDE FORȚAT ACEST BONUS BATTLE ")]),_:1},8,["show"]),m.value?(s(),o("div",nt,[a("div",it,[a("div",dt,[a("h2",ut,"Active Battle: "+r(m.value.title),1),a("p",ct," Miza: "+r(m.value.stake)+" | Etapa: "+r(L.value.name)+" | Premiu: "+r(m.value.prize)+" | Buys: "+r(m.value.buys),1)]),k.value.length>1?(s(),o("div",pt,[(s(!0),o(M,null,P(k.value,(e,v)=>(s(),o("div",{key:v,class:g(["relative border rounded-md p-4 shadow transition-all duration-300 game-active-row",e.game.image?"bg-transparent":"bg-gray-900"]),style:oe(e.game.image?{"--bg-image":"url("+E(e.game.id)+")"}:{})},[e.game.image?(s(),o("div",mt)):c("",!0),a("div",{class:g(["relative z-10 p-4 rounded-lg",e.game.image?"bg-black bg-opacity-60":"bg-gray-900"])},[a("div",bt,[e.game.image?(s(),o("img",{key:0,src:E(e.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-md"},null,8,gt)):c("",!0),a("div",vt,[a("h3",ft,r(e.game.name)+" - "+r(e.for_user),1),a("div",yt,[b(Z(re),{disabled:!j.value,options:Y.value,label:"name",reduce:i=>i.id,"onUpdate:modelValue":i=>fe(e.id,i),placeholder:"Schimbi jocul?",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["disabled","options","reduce","onUpdate:modelValue"]),a("button",{class:"btn-secondary transition-all duration-300",onClick:t[10]||(t[10]=i=>j.value=!j.value)}," SCHIMBA JOCU ")])])]),a("div",null,[(s(!0),o(M,null,P(e.scores,(i,u)=>(s(),o("div",{key:u,class:"flex items-center space-x-2 mt-1 transition-all duration-300"},[b(S,{modelValue:e.scores[u].cost_buy,"onUpdate:modelValue":f=>e.scores[u].cost_buy=f,label:"Cost Buy",type:"number",disabled:n.value,onInput:f=>ae(v,u)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),b(S,{modelValue:e.scores[u].result_buy,"onUpdate:modelValue":f=>e.scores[u].result_buy=f,label:"Rezultat",type:"number",disabled:i.cost_buy<=0||n.value,onInput:f=>ae(v,u)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),b(S,{modelValue:e.scores[u].score,"onUpdate:modelValue":f=>e.scores[u].score=f,label:"Scor",type:"number",disabled:!0},null,8,["modelValue","onUpdate:modelValue"]),a("button",{type:"button",onClick:f=>ue(v,u),class:g(["btn-danger transition-all duration-300 align-middle",{"opacity-0":u===0}]),disabled:u===0},t[18]||(t[18]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),10,_t)]))),128)),a("button",{type:"button",onClick:t[11]||(t[11]=i=>te()),disabled:n.value,class:g([{"input-disabled":n.value},"btn-primary mt-2"])}," Adaugă Buy ",10,ht)]),a("p",xt," Scor Total: "+r(ce(e.scores)),1)],2)],6))),128))])):c("",!0),x.value?(s(),o("div",wt,[a("p",kt,"Câștigător: "+r(x.value.game.name)+" | User: "+r(x.value.for_user),1)])):c("",!0),a("div",Vt,[L.value.name!=="Final"?(s(),o("button",{key:0,type:"button",onClick:ve,class:g(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!O.value||n.value}]),disabled:!O.value||n.value}," Următoarii Concurenți ",10,Ct)):c("",!0),L.value.name==="Final"?(s(),o("button",{key:1,type:"button",onClick:be,class:g(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!O.value}]),disabled:!O.value}," Termina Battle ",10,Bt)):c("",!0)])]),a("div",St,[$.value.stage_brackets.length>0?(s(),o("table",Ut,[a("tbody",null,[(s(!0),o(M,null,P($.value.stage_brackets,(e,v)=>(s(),o("tr",{key:e.id,class:g(v%2===0?"bg-gray-900":"bg-gray-800")},[a("td",Tt,[a("span",{class:g({"line-through text-gray-500":e.winner!==e.participant_a})},r(e.participant_a),3),t[19]||(t[19]=T(" vs ")),a("span",{class:g({"line-through text-gray-500":e.winner!==e.participant_b})},r(e.participant_b),3)]),a("td",Ft,r(parseFloat(e.participant_a_score).toFixed(3))+" - "+r(parseFloat(e.participant_b_score).toFixed(3)),1)],2))),128))])])):c("",!0),$.value.concurrents.length>0?(s(),o("table",At,[a("tbody",null,[(s(!0),o(M,null,P($.value.concurrents,(e,v)=>(s(),o("tr",{key:e==null?void 0:e.id,class:g(v%2===0?"bg-gray-900":"bg-gray-800")},[a("td",$t,r(e!=null&&e.is_eliminated?"❌":"✅"),1),a("td",zt,r((e==null?void 0:e.game.name)||"N/A"),1),a("td",Et,r((e==null?void 0:e.for_user)||"N/A"),1)],2))),128))])])):c("",!0)])])):c("",!0)])])]),_:1}))}};export{Wt as default};
