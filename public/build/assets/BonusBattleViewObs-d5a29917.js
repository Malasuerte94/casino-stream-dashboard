import z from"./SvgBh-f644fe92.js";import{c as a,b as t,I as d,t as i,d as f,n as g,F as x,E as _,k as b,f as A,w as B,M as C,o as n,a as k,T}from"./app-c9e312fd.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";const P={components:{SvgBh:z},props:["id"],data(){return{loading:!0,settings:{},bonusBattleInfo:[],bonusBattleConcurrents:[],bonusBattleStage:[],bonusBattleBracket:[],bonusBattleScores:[],bonusBattleWinner:[],bonusBattleAllConcurrents:[],bonusBattleAllBracketsCurentStage:[],battleWinner:[],avgScore:0,bestScore:0,totalProfit:0,totalCost:0,isUpdating:!1,vsImageUrl:"/storage/assets/images/vs_symbol.png",shooting:!1,showExplosion:!1}},computed:{totalConcurrents(){return this.bonusBattleAllConcurrents.length},totalBalanceScore(){return((this.totalCost+this.totalProfit)/this.totalCost).toFixed(2)},winnerIndex(){var l;if(this.bonusBattleConcurrents.length===2&&((l=this.bonusBattleBracket)!=null&&l.id)){const o=parseFloat(this.getTotalConcurrentScore(this.bonusBattleConcurrents[0].id,this.bonusBattleBracket.id)),u=parseFloat(this.getTotalConcurrentScore(this.bonusBattleConcurrents[1].id,this.bonusBattleBracket.id));return o>u?0:u>o?1:null}return null},loserIndex(){return this.winnerIndex===0?1:this.winnerIndex===1?0:null}},async mounted(){await this.getSettings(),await this.getActiveBonusBattle(),this.loading=!1,window.Echo.channel(`App.Models.User.${this.id}`).listen("BonusBattleUpdated",async()=>{await this.updateList()}).listen("SettingsUpdated",async()=>{await this.updateList()})},methods:{async getActiveBonusBattle(){await axios.get("/api/bonus-battle-info/"+this.id).then(l=>{this.bonusBattleInfo=l.data.battle,this.bonusBattleConcurrents=l.data.concurrents,this.bonusBattleAllConcurrents=l.data.all_concurrents,this.bonusBattleAllBracketsCurentStage=l.data.stage_brackets,this.bonusBattleStage=l.data.stage,this.bonusBattleBracket=l.data.bracket,this.bonusBattleScores=l.data.current_score,this.bonusBattleWinner=l.data.winner,this.battleWinner=l.data.battle_winner,this.avgScore=l.data.avg_score.toFixed(2),this.bestScore=l.data.best_score.toFixed(2),this.totalProfit=l.data.total_profit,this.totalCost=l.data.total_cost}).catch(l=>{console.log(l)})},async getSettings(){let l="obs_bonus_battle";try{const o=await axios.get("/api/get-setting-public",{params:{setting_name:l,user_id:this.id}});o.data.setting_value&&(this.settings=JSON.parse(o.data.setting_value))}catch(o){console.error(`Error loading setting "${l}":`,o),this.error=`Failed to load setting: ${l}`}},async updateList(){this.isUpdating||(this.isUpdating=!0,await this.getSettings(),await this.getActiveBonusBattle(),this.isUpdating=!1,await this.$nextTick(()=>{this.bonusBattleConcurrents.length===2&&!this.shooting&&this.winnerIndex!==null&&this.shoot()}))},getConcurrentScores(l,o){if(!l||!o)return[];const u=[];for(let c=0;c<this.bonusBattleScores.length;c++){const e=this.bonusBattleScores[c];e.bonus_concurrent_id===l&&e.bracket_id===o&&u.push(e)}return u},getGameThumbnail(l){return l?`/storage/games/${l}`:""},getTotalConcurrentScore(l,o){let u=0;return this.getConcurrentScores(l,o).forEach(e=>{u+=parseFloat(e.score)}),u.toFixed(2)},shoot(){this.shooting=!0,setTimeout(()=>{this.showExplosion=!0,setTimeout(()=>{this.shooting=!1,this.showExplosion=!1},250)},500)}}},E={class:"table-container"},N={class:"header-list"},W={class:"bonus-details"},U={class:"list-cost"},V={class:"list-opened"},G={class:"details"},j={key:0,class:"main-battle"},L={class:"battle flex gap-2 align-middle items-center justify-center relative"},O={class:"flex flex-col gap-2 mt-2"},H={class:g("concurrent flex rounded-md text-white ")},M=["src"],R={key:0},J={class:"px-2 py-1"},D={class:"px-2 py-1"},q={key:1,class:"w-full p-4 text-white shadow-lg flex space-x-4 winner-battle"},K={class:"text-center w-40 flex flex-col justify-center"},Q=["src"],X={class:"flex-grow"},Y={class:"w-full text-sm text-gray-200"},Z={class:"p-1 text-right bg-gray-900 rounded-md"},$={class:"second-battle"},tt={class:"participant-name"},et={class:"result-score"},st={class:"result-score"},ot={class:"participant-name"},lt={key:1,class:"shadow-md py-2 px-2"},it={class:"overflow-x-auto"},nt={class:"border border-black px-1 py-1 shrink w-0"},at={class:"border border-black px-2 py-1"},rt={class:"border border-black px-2 py-1"};function dt(l,o,u,c,e,r){var m;return e.loading?b("",!0):(n(),a("div",{key:0,class:"table-list",ref:"viewport",style:d({"background-color":e.settings.tableBgColor,border:e.settings.borderEnabled?e.settings.borderWidth+"px "+e.settings.borderColor+" solid":"unset"})},[t("div",E,[t("div",N,[t("div",{class:"header-list-title",style:d({"background-color":e.settings.headerBgColor,color:e.settings.headerFontColor,"font-size":e.settings.headerFontSize+"px"})},[t("span",null,i(e.bonusBattleInfo.title),1),t("div",W,[t("div",U,[o[0]||(o[0]=f("Miză ")),t("span",null,i(e.bonusBattleInfo.stake)+" "+i(e.settings.currency),1)]),t("div",V,[t("div",G,[t("span",null,i(r.totalConcurrents)+" Jocuri",1)])])])],4),t("div",{class:"header-details",style:d({"background-color":e.settings.subheaderBgColor,color:e.settings.subheaderFontColor,"font-size":e.settings.subheaderFontSize+"px"})},[t("div",{class:"text-center uppercase text-sm stage font-bold flex justify-center items-center",style:d({"background-color":e.settings.subheaderBgColorRound,color:e.settings.subheaderFontColorRound})},i(e.bonusBattleStage.name),5),t("div",null,[t("span",null,"AVG: "+i(e.avgScore),1)]),t("div",null,[t("span",null,"TOP: "+i(e.bestScore),1)]),t("div",null,[t("span",{class:g({"text-red-500":e.totalProfit<0,"text-green-500":e.totalProfit>=0})},i(e.totalProfit)+" "+i(e.settings.currency),3)])],4)]),(m=e.battleWinner)!=null&&m.id?(n(),a("div",q,[t("div",K,[e.battleWinner.game.image?(n(),a("img",{key:0,src:r.getGameThumbnail(e.battleWinner.game.image),alt:"Game Thumbnail",class:"w-100 auto mx-auto object-cover rounded-lg"},null,8,Q)):b("",!0)]),t("div",X,[t("div",{class:"mb-4",style:d({"font-size":e.settings.headerFontSize*1.2+"px"})},[o[6]||(o[6]=t("span",{class:"font-bold mb-2"},"Winner Winner!",-1)),t("p",null,[o[4]||(o[4]=t("span",{class:"font-bold"},"Total Scor:",-1)),f(" "+i(r.totalBalanceScore),1)]),t("p",null,[o[5]||(o[5]=t("span",{class:"font-bold"},"Pentru User:",-1)),f(" "+i(e.battleWinner.for_user||"N/A"),1)])],4),t("div",{class:"bg-gray-800 rounded-md p-2",style:d({"background-color":e.settings.headerBgColor,color:e.settings.headerFontColor,"font-size":e.settings.headerFontSize+"px"})},[t("table",Y,[o[9]||(o[9]=t("thead",null,[t("tr",null,[t("th",{class:"text-left p-1 border-b border-gray-700"},"Battle Info"),t("th",{class:"text-right p-1 border-b border-gray-700"},"LEI")])],-1)),t("tbody",null,[t("tr",null,[o[7]||(o[7]=t("td",{class:"p-1"},"Battle Cost",-1)),t("td",Z,i(e.totalCost),1)]),t("tr",null,[o[8]||(o[8]=t("td",{class:"p-1"},"Battle Profit",-1)),t("td",{class:g(["p-1 text-right bg-gray-900 rounded-md",{"text-green-400":e.totalProfit>0,"text-red-400":e.totalProfit<0}])},i(e.totalProfit>0?"+":"")+i(e.totalProfit),3)])])])],4)])])):(n(),a("div",j,[t("div",L,[(n(!0),a(x,null,_(e.bonusBattleConcurrents,(s,h)=>{var y,v,w;return n(),a("div",{key:(s==null?void 0:s.id)||h,class:"w-100 grow flex-col flex gap-2 px-2 max-w-[190px]"},[t("div",O,[t("div",H,[k(T,{name:"flip",mode:"out-in"},{default:B(()=>[(n(),a("img",{src:r.getGameThumbnail(s.game.image),alt:"Game Thumbnail",class:"w-[100px] rounded-lg",key:s.game.image},null,8,M))]),_:2},1024),t("div",{class:g({gun:!0,shoot:e.shooting&&r.winnerIndex===h,flipped:r.winnerIndex===1&&h===r.winnerIndex})},o[1]||(o[1]=[t("img",{src:"/storage/assets/images/gun.png",alt:"Gun"},null,-1)]),2)]),t("div",{class:"from-user",style:d({"background-color":e.settings.tableParticipantBgColor,color:e.settings.tableParticipantFontColor,"font-size":e.settings.tableParticipantFontSize+"px"})},[(s==null?void 0:s.for_user)!==null?(n(),a("div",R,i((s==null?void 0:s.for_user)||"N/A"),1)):b("",!0),t("div",{class:g(["total-game-score font-bold",r.getTotalConcurrentScore(s==null?void 0:s.id,(y=e.bonusBattleBracket)==null?void 0:y.id)<1?"text-red-500":"text-green-500"])},i(r.getTotalConcurrentScore(s==null?void 0:s.id,(v=e.bonusBattleBracket)==null?void 0:v.id)),3)],4)]),r.getConcurrentScores(s==null?void 0:s.id,(w=e.bonusBattleBracket)==null?void 0:w.id).length>0?(n(),a("table",{key:0,style:d({color:e.settings.tableScoresFontColor,"font-size":e.settings.tableScoresFontSize+"px"}),class:"table-auto mb-2 w-full border-collapse border border-gray-700 rounded-md overflow-hidden"},[t("thead",null,[t("tr",{class:"bg-black text-white uppercase",style:d({"background-color":e.settings.tableScoresLabelBgColor})},o[2]||(o[2]=[t("th",{class:"border border-gray-700 px-1 py-1"},"Cost",-1),t("th",{class:"border border-gray-700 px-1 py-1"},"Rezultat",-1),t("th",{class:"border border-gray-700 px-1 py-1"},"Scor",-1)]),4)]),k(C,{name:"fade-down",tag:"tbody"},{default:B(()=>{var S;return[(n(!0),a(x,null,_(r.getConcurrentScores(s==null?void 0:s.id,(S=e.bonusBattleBracket)==null?void 0:S.id),(p,F)=>(n(),a("tr",{key:p.id||F,style:d({"background-color":e.settings.tableScoresBgColor,"font-size":e.settings.tableScoresFontSize*1.2+"px"})},[t("td",J,i(p.cost_buy),1),t("td",D,i(p.result_buy),1),t("td",{class:g(["px-2 py-1 font-bold",p.score<1?"text-red-500":"text-green-500"])},i(p.score.toFixed(2)),3)],4))),128))]}),_:2},1024)],4)):b("",!0)])}),128)),e.shooting?(n(),a("div",{key:0,class:g(["projectile",{"left-to-right":r.winnerIndex===0,"right-to-left":r.winnerIndex===1}])},null,2)):b("",!0),e.showExplosion?(n(),a("div",{key:1,class:g(["explosion",{"explosion-left":r.winnerIndex===0,"explosion-right":r.winnerIndex===1}])},null,2)):b("",!0),o[3]||(o[3]=t("div",{class:"vs-symbol flex justify-center items-center"}," VS ",-1))])])),t("div",$,[e.bonusBattleAllBracketsCurentStage.length>0?(n(),A(C,{key:0,name:"fade-down",tag:"div",class:"bracket-container py-2 px-2"},{default:B(()=>[(n(!0),a(x,null,_(e.bonusBattleAllBracketsCurentStage,s=>(n(),a("div",{key:s.id,class:"bracket-item"},[t("div",{class:g(["participant",{loser:s.winner!==s.participant_a&&s.winner!=="N/A"}])},[t("span",tt,i(s.participant_a),1),o[10]||(o[10]=f(" - ")),t("span",et,i(parseFloat(s.participant_a_score).toFixed(3)),1)],2),o[12]||(o[12]=t("div",{class:"vs"},"VS",-1)),t("div",{class:g(["participant",{loser:s.winner!==s.participant_b&&s.winner!=="N/A"}])},[t("span",st,i(parseFloat(s.participant_b_score).toFixed(3)),1),o[11]||(o[11]=f(" - ")),t("span",ot,i(s.participant_b),1)],2)]))),128))]),_:1})):b("",!0),e.settings.tableHistoryEnable?(n(),a("div",lt,[t("div",it,[t("table",{class:"table-auto w-full text-gray-200",style:d({"font-size":e.settings.tableBodyFontSize+"px"})},[t("tbody",null,[(n(!0),a(x,null,_(e.bonusBattleAllConcurrents,(s,h)=>(n(),a("tr",{key:s==null?void 0:s.id,style:d({"background-color":h%2===0?e.settings.tableHistoryBgOddColor:e.settings.tableHistoryBgEvenColor})},[t("td",nt,i(s!=null&&s.is_eliminated?"❌":"✅"),1),t("td",at,i((s==null?void 0:s.game.name)||"N/A"),1),t("td",rt,i((s==null?void 0:s.for_user)||"N/A"),1)],4))),128))])],4)])])):b("",!0)])])],4))}const ct=I(P,[["render",dt]]);export{ct as default};
