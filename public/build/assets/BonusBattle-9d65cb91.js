import{K as me,i as u,l as P,j as be,f as pe,w as U,o as l,b as a,c as o,h,L as x,d as k,a as T,F as A,E as F,I as ee,k as c,u as K,M as ve,n as b,t as r}from"./app-6df4a8a7.js";import{_ as ge}from"./AppLayout-89254938.js";import{u as ye,C as te}from"./gameStore-499e401f.js";import _e from"./BonusBattleViewers-2f4b0d89.js";import{_ as fe}from"./DialogModal-7ac334a0.js";import"./ResponsiveNavLink-414db4db.js";import"./_plugin-vue_export-helper-c27b6911.js";const he=me("battle",{state:()=>({concurrents:[{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null}]}),actions:{setConcurrents(w){this.concurrents=w},addConcurrent(w){this.concurrents=Array.from({length:w},()=>({game_id:"",for_user:""}))},updateConcurrent(w,z){this.concurrents[w]={...this.concurrents[w],...z}}},persist:!0});const xe={class:"py-4"},we={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ke={key:0,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},Ce={class:"p-6 space-y-4"},Be={class:"flex flex-row gap-2"},Se={class:"flex flex-col md:flex-row md:space-x-4"},Ve={class:"md:w-2/3 bg-gray-800 p-6 rounded-md shadow-md space-y-4 transition-all duration-300"},Ue={class:"text-lg font-semibold text-gray-300 flex gap-2 items-center"},Te={class:"flex gap-4"},Ae={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},Fe={class:"relative z-10 flex items-center gap-4 w-full"},ze=["src"],Ee=["onUpdate:modelValue"],Ne=["disabled"],$e={key:1,class:"bg-gray-900 overflow-hidden shadow-lg rounded-md transition-all duration-300"},Ge={class:"p-6 flex justify-center items-center bg-gray-800"},Me={class:"w-full max-w-md bg-gray-900 shadow-lg rounded-md p-6 text-center transition-all duration-300"},Pe=["src"],Re={class:"text-2xl font-bold text-gray-100 mb-2"},je={class:"text-lg font-medium text-gray-300"},Le={key:2,class:"bg-gray-900 overflow-hidden shadow-lg rounded-md mt-6 transition-all duration-300"},He={class:"p-6"},De={class:"flex justify-between items-center"},Oe={class:"text-xl font-bold mb-4 text-gray-100"},Je={class:"text-gray-300"},We={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Ke={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},Ze={class:"flex gap-2 items-center mb-2 p-2 rounded-md border border-gray-600 transition-all duration-300"},qe=["src"],Qe={class:"w-full"},Xe={class:"text-lg font-bold mb-2 text-gray-100"},Ye={class:"flex flex-row gap-2"},Ie={class:"text-sm font-medium text-gray-300"},et=["onUpdate:modelValue","disabled","onInput"],tt={class:"text-sm font-medium text-gray-300"},at=["disabled","onUpdate:modelValue","onInput"],st={class:"text-sm font-medium text-gray-300"},lt=["onUpdate:modelValue"],ot=["onClick"],it=["disabled"],nt={class:"mt-4 text-lg font-bold text-gray-100"},rt={key:1,class:"mt-4"},dt={class:"text-lg font-bold text-gray-100"},ut={class:"mt-6 flex flex-col gap-4"},ct=["disabled"],mt=["disabled"],bt={class:"p-6"},pt={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2 transition-all duration-300"},vt={class:"px-4 py-2 font-bold"},gt={class:"px-4 py-2"},yt={key:1,class:"table-auto w-full text-sm text-gray-200 transition-all duration-300"},_t={class:"border border-black px-1 py-1 shrink w-0"},ft={class:"border border-black px-2 py-1"},ht={class:"border border-black px-2 py-1"},Ut={__name:"BonusBattle",setup(w){const z=he(),n=u(!0),C=u(""),R=u("5-10"),j=u(""),L=u("2"),_=P(()=>z.concurrents),p=u(null),H=u(null),E=u(null),N=u(null),B=u([{}]),Z=u(null),S=u([]),$=u(!1),v=u(null),y=u([]);let D=u(!1);const q=ye(),Q=P(()=>q.availableGames);let O=u(null);be(async()=>{await f()});const X=P(()=>_.value.length<4?!0:_.value.some(s=>!s.game_id)),G=P(()=>B.value?B.value.length<2?!1:B.value.every(s=>s.cost_buy>0):!1),ae=()=>{D.value=!0},J=()=>{D.value=!1},M=s=>{z.addConcurrent(s)},Y=async()=>{y.value.forEach(s=>{const e=(s==null?void 0:s.scores.length)>0?s.scores[s.scores.length-1].cost_buy:0;s==null||s.scores.push({bracket_id:N.value.id,bonus_concurrent_id:s.id,cost_buy:e,score:0,result_buy:0})}),await W(),await f()},se=async(s,e)=>{await oe(y.value[s].scores[e].id),y.value[s].scores.splice(e,1),await f()},I=async(s,e)=>{O&&clearTimeout(O),O=setTimeout(async()=>{const t=y.value[s].scores[e];t.cost_buy>0?(t.score=parseFloat((t.result_buy/t.cost_buy).toFixed(3)),await W()):alert("Amount must be greater than 0.")},1e3)},le=s=>s.reduce((e,t)=>e+t.score,0).toFixed(3),oe=async s=>{var e;try{n.value=!0;const t=await axios.delete(`/api/bonus-battles/delete-score/${s}`);await W()}catch(t){console.error("Failed to delete bonus score:",((e=t.response)==null?void 0:e.data)||t.message)}finally{n.value=!1}},W=async()=>{var s;try{n.value=!0;const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:N.value.id,bracket:y.value})}catch(e){console.error("Failed to store bonus score:",((s=e.response)==null?void 0:s.data)||e.message)}finally{n.value=!1}},ie=async()=>{var s;if(!C.value||_.value.some(e=>!e.game_id)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:C.value,stake:R.value,prize:j.value,buys:L.value,concurrents:_.value});await f()}catch(e){console.error("Failed to store bonus battle:",((s=e.response)==null?void 0:s.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},ne=async()=>{var s;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:p.value.id});v.value=e.data.winner,await f()}catch(e){console.log("endBattle error:",((s=e.response)==null?void 0:s.data)||e.message)}},re=async()=>{var s;try{n.value=!0,await axios.post("/api/bonus-battles/end-battle-forced",{bonus_battle_id:p.value.id}),J()}catch(e){console.error("Failed to force close bonus battle:",((s=e.response)==null?void 0:s.data)||e.message),alert("A aparut o eroare la închiderea forțată a turneului. Te rugăm să în contactezi pe Mala!")}finally{await f(),n.value=!1}},de=async()=>{var s;try{n.value=!0,await axios.post("/api/bonus-battles/finish-round",{active_bracket:N.value.id}),await f()}catch(e){console.error("Failed to finish round:",((s=e.response)==null?void 0:s.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}finally{n.value=!1}},ue=async(s,e)=>{try{n.value=!0,await axios.put("/api/bonus-battles/edit-concurrent",{id:s,game_id:e}),await f(),$.value=!1}catch{alert("Please try again.")}finally{n.value=!1}},f=async()=>{var s;try{n.value=!0;const e=await axios.get("/api/bonus-battles/active");if(Z.value=e.data.total_battles,p.value=e.data.battle,H.value=e.data.concurrents,E.value=e.data.stage,N.value=e.data.bracket,B.value=e.data.scores,S.value=e.data.history,C.value="Bonus Battle #"+(Z.value+1),H.value){const d=H.value;y.value=d.slice(0,2).map(i=>{const m=B.value.filter(g=>g.bonus_concurrent_id===i.id);return{...i,scores:m.length?m:[]}})}if(y.value.some(d=>d.scores.length===0)){const d=((s=p.value)==null?void 0:s.buys)||0;if(d>0)for(let i=0;i<d;i++)await Y()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{n.value=!1}},V=s=>{const e=q.availableGames.find(t=>t.id===s);return e?`/storage/games/${e.image}`:""},ce=s=>{_.value=_.value.map((e,t)=>({...e,for_user:s[t]!==void 0?s[t]:""}))};return(s,e)=>(l(),pe(ge,{title:"Bonus Battle"},{default:U(()=>[a("div",xe,[a("div",we,[!p.value&&!v.value?(l(),o("div",ke,[a("div",Ce,[a("div",Be,[a("div",null,[e[10]||(e[10]=a("label",{for:"title",class:"block text-sm font-medium text-gray-300"},"Titlu Bonus Battle",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),id:"title",class:"mt-1 block w-full input-primary"},null,512),[[x,C.value]])]),a("div",null,[e[11]||(e[11]=a("label",{for:"stake",class:"block text-sm font-medium text-gray-300"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>R.value=t),id:"stake",class:"mt-1 block w-full input-primary"},null,512),[[x,R.value]])]),a("div",null,[e[12]||(e[12]=a("label",{for:"prize",class:"block text-sm font-medium text-gray-300"},"Premiu",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>j.value=t),id:"prize",class:"mt-1 block w-full input-primary"},null,512),[[x,j.value]])]),a("div",null,[e[13]||(e[13]=a("label",{for:"buys",class:"block text-sm font-medium text-gray-300"},"Câte buys per joc (poți face ulterior câte vrei)",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>L.value=t),id:"buys",class:"mt-1 block w-full input-primary"},null,512),[[x,L.value]])])]),a("div",Se,[a("div",Ve,[a("h3",Ue,[e[14]||(e[14]=k(" Participanți ")),a("div",Te,[a("button",{onClick:e[4]||(e[4]=t=>M(4)),class:"btn-primary"},"4"),a("button",{onClick:e[5]||(e[5]=t=>M(8)),class:"btn-primary"},"8"),a("button",{onClick:e[6]||(e[6]=t=>M(16)),class:"btn-primary"},"16"),a("button",{onClick:e[7]||(e[7]=t=>M(4)),class:"btn-danger"},"RESET")])]),T(ve,{name:"fade"},{default:U(()=>[(l(!0),o(A,null,F(_.value,(t,d)=>(l(),o("div",{key:d,class:"relative overflow-hidden flex items-center gap-4 bg-gray-900 p-4 rounded-md shadow transition-all duration-300",style:ee(t.game_id?{"--bg-image":"url("+V(t.game_id)+")"}:{})},[t.game_id?(l(),o("div",Ae)):c("",!0),a("div",Fe,[t.game_id?(l(),o("img",{key:0,src:V(t.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-md"},null,8,ze)):c("",!0),T(K(te),{options:Q.value,label:"name",reduce:i=>i.id,modelValue:t.game_id,"onUpdate:modelValue":i=>t.game_id=i,placeholder:"Alege Joc",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),h(a("input",{type:"text","onUpdate:modelValue":i=>t.for_user=i,class:"flex-1 input-primary",placeholder:"Cine a ales? (opțional)"},null,8,Ee),[[x,t.for_user]])])],4))),128))]),_:1})]),T(_e,{onWinnersPicked:ce,fillCount:_.value.length},null,8,["fillCount"])]),a("button",{disabled:X.value,class:b([{"opacity-50 cursor-not-allowed":X.value},"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300"]),type:"button",onClick:ie}," Start ",10,Ne)])])):c("",!0),v.value&&!p.value?(l(),o("div",$e,[a("div",Ge,[a("div",Me,[v.value.game.image?(l(),o("img",{key:0,src:V(v.value.game.id),alt:"Game Thumbnail",class:"w-32 mx-auto object-cover rounded-md mb-4"},null,8,Pe)):c("",!0),a("h2",Re," Câștigător! - "+r(v.value.game.name),1),a("p",je," User: "+r(v.value.for_user),1)])])])):c("",!0),T(fe,{show:K(D),onClose:J},{title:U(()=>e[15]||(e[15]=[k(" Ești sigur că vrei să închizi forțat acest Bonus Battle? ")])),content:U(()=>e[16]||(e[16]=[k(" Vom închide forțat acest Bonus Battle și nu vei mai putea reveni la el. Ești sigur că vrei să continui? ")])),footer:U(()=>[a("button",{onClick:J,class:"btn-danger"}," ANULEAZĂ "),a("button",{class:"ml-3 btn-primary",onClick:re}," ÎNCHIDE FORȚAT ACEST BONUS BATTLE ")]),_:1},8,["show"]),p.value?(l(),o("div",Le,[a("div",He,[a("div",De,[a("h2",Oe,"Active Battle: "+r(p.value.title),1),a("button",{class:"btn-danger",onClick:ae}," INCHIDE TURNEU FORȚAT ")]),a("p",Je," Miza: "+r(p.value.stake)+" | Etapa: "+r(E.value.name)+" | Premiu: "+r(p.value.prize)+" | Buys: "+r(p.value.buys),1),y.value.length>1?(l(),o("div",We,[(l(!0),o(A,null,F(y.value,(t,d)=>(l(),o("div",{key:d,class:b(["relative border rounded-md p-4 shadow transition-all duration-300 game-active-row",t.game.image?"bg-transparent":"bg-gray-900"]),style:ee(t.game.image?{"--bg-image":"url("+V(t.game.id)+")"}:{})},[t.game.image?(l(),o("div",Ke)):c("",!0),a("div",{class:b(["relative z-10 p-4",t.game.image?"bg-black bg-opacity-60":"bg-gray-900"])},[a("div",Ze,[t.game.image?(l(),o("img",{key:0,src:V(t.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-md"},null,8,qe)):c("",!0),a("div",Qe,[a("h3",Xe,r(t.game.name)+" - "+r(t.for_user),1),a("div",Ye,[T(K(te),{disabled:!$.value,options:Q.value,label:"name",reduce:i=>i.id,"onUpdate:modelValue":i=>ue(t.id,i),placeholder:"Schimbi jocul?",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["disabled","options","reduce","onUpdate:modelValue"]),a("button",{class:"btn-secondary transition-all duration-300",onClick:e[8]||(e[8]=i=>$.value=!$.value)}," SCHIMBA JOCU ")])])]),a("div",null,[(l(!0),o(A,null,F(t.scores,(i,m)=>(l(),o("div",{key:m,class:"flex items-center space-x-2 mt-1 transition-all duration-300"},[a("label",Ie,[e[17]||(e[17]=k(" Cost Buy ")),h(a("input",{type:"number","onUpdate:modelValue":g=>t.scores[m].cost_buy=g,class:b(["block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300 input-primary",{"input-disabled":n.value}]),disabled:n.value,placeholder:"Amount",onInput:g=>I(d,m)},null,42,et),[[x,t.scores[m].cost_buy]])]),a("label",tt,[e[18]||(e[18]=k(" Rezultat Buy ")),h(a("input",{disabled:i.cost_buy<=0||n.value,class:b([{"input-disabled":i.cost_buy<=0||n.value,"input-primary":i.cost_buy>0},"block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300"]),type:"number","onUpdate:modelValue":g=>t.scores[m].result_buy=g,placeholder:"Result",onInput:g=>I(d,m)},null,42,at),[[x,t.scores[m].result_buy]])]),a("label",st,[e[19]||(e[19]=k(" Scor ")),h(a("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":g=>t.scores[m].score=g,class:"block w-20 border border-gray-600 rounded-md shadow-sm p-2 input-disabled transition-all duration-300",placeholder:"Result"},null,8,lt),[[x,t.scores[m].score]])]),m>=1?(l(),o("button",{key:0,type:"button",onClick:g=>se(d,m),class:"btn-danger transition-all duration-300 align-middle"},e[20]||(e[20]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,ot)):c("",!0)]))),128)),a("button",{type:"button",onClick:e[9]||(e[9]=i=>Y()),disabled:n.value,class:b([{"input-disabled":n.value},"btn-primary mt-2"])}," Adaugă Buy ",10,it)]),a("p",nt," Scor Total: "+r(le(t.scores)),1)],2)],6))),128))])):c("",!0),v.value?(l(),o("div",rt,[a("p",dt,"Câștigător: "+r(v.value.game.name)+" | User: "+r(v.value.for_user),1)])):c("",!0),a("div",ut,[E.value.name!=="Final"?(l(),o("button",{key:0,type:"button",onClick:de,class:b(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!G.value||n.value}]),disabled:!G.value||n.value}," Următoarii Concurenți ",10,ct)):c("",!0),E.value.name==="Final"?(l(),o("button",{key:1,type:"button",onClick:ne,class:b(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!G.value}]),disabled:!G.value}," Termina Battle ",10,mt)):c("",!0)])]),a("div",bt,[S.value.stage_brackets.length>0?(l(),o("table",pt,[a("tbody",null,[(l(!0),o(A,null,F(S.value.stage_brackets,(t,d)=>(l(),o("tr",{key:t.id,class:b(d%2===0?"bg-gray-900":"bg-gray-800")},[a("td",vt,[a("span",{class:b({"line-through text-gray-500":t.winner!==t.participant_a})},r(t.participant_a),3),e[21]||(e[21]=k(" vs ")),a("span",{class:b({"line-through text-gray-500":t.winner!==t.participant_b})},r(t.participant_b),3)]),a("td",gt,r(parseFloat(t.participant_a_score).toFixed(3))+" - "+r(parseFloat(t.participant_b_score).toFixed(3)),1)],2))),128))])])):c("",!0),S.value.concurrents.length>0?(l(),o("table",yt,[a("tbody",null,[(l(!0),o(A,null,F(S.value.concurrents,(t,d)=>(l(),o("tr",{key:t==null?void 0:t.id,class:b(d%2===0?"bg-gray-900":"bg-gray-800")},[a("td",_t,r(t!=null&&t.is_eliminated?"❌":"✅"),1),a("td",ft,r((t==null?void 0:t.game.name)||"N/A"),1),a("td",ht,r((t==null?void 0:t.for_user)||"N/A"),1)],2))),128))])])):c("",!0)])])):c("",!0)])])]),_:1}))}};export{Ut as default};
