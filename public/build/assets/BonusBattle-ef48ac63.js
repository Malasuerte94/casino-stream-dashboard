import{K as ye,i as d,l as A,j as fe,q as _,f as _e,w as F,o as l,b as a,c as o,t as n,d as w,h,m as he,k as c,L as k,a as z,F as E,E as N,I as ae,u as Z,M as xe,n as p,J as we}from"./app-45f49d1d.js";import{_ as ke}from"./AppLayout-debfb9b0.js";import{u as Ce,C as se}from"./gameStore-6da72f30.js";import Be from"./BonusBattleViewers-24a2933d.js";import{_ as Se}from"./DialogModal-547ec034.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./NavLink-f075d3b4.js";const Ve=ye("battle",{state:()=>({concurrents:[{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null}]}),actions:{setConcurrents(C){this.concurrents=C},addConcurrent(C){this.concurrents=Array.from({length:C},()=>({game_id:"",for_user:""}))},updateConcurrent(C,$){this.concurrents[C]={...this.concurrents[C],...$}}},persist:!0});const Ue={class:"py-4"},Te={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ae={key:0,class:"px-6 py-3 flex items-center justify-between bg-gray-800 rounded-md shadow-md transition-all duration-300"},Fe={class:"flex items-center space-x-4"},ze={class:"text-sm font-bold py-1 px-3 bg-gray-700 rounded-md border border-gray-600 transition"},Ee={class:"flex items-center space-x-4"},Ne={class:"ml-3 text-sm font-medium text-gray-300 flex items-center gap-2"},$e={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},Ge={key:1,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},Pe={class:"p-6 space-y-4"},Me={class:"flex flex-row gap-2"},Le={class:"flex flex-col md:flex-row md:space-x-4"},je={class:"md:w-2/3 bg-gray-800 p-6 rounded-md shadow-md space-y-4 transition-all duration-300"},Re={class:"text-lg font-semibold text-gray-300 flex gap-2 items-center"},Oe={class:"flex gap-4"},He={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},De={class:"relative z-10 flex items-center gap-4 w-full"},Je=["src"],Ke=["onUpdate:modelValue"],We=["disabled"],qe={key:2,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},Ze={class:"p-6 flex justify-center items-center bg-gray-800"},Qe={class:"w-full max-w-md bg-gray-800 shadow-lg rounded-md p-6 text-center transition-all duration-300"},Xe=["src"],Ye={class:"text-2xl font-bold text-gray-100 mb-2"},Ie={class:"text-lg font-medium text-gray-300"},et={key:3,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md mt-6 transition-all duration-300"},tt={class:"p-6"},at={class:"flex flex-row justify-between"},st={class:"text-xl font-bold mb-4 text-gray-100"},lt={class:"text-gray-300"},ot={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},it={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},nt={class:"flex gap-2 items-center mb-2 p-2 rounded-md border border-gray-600 transition-all duration-300"},rt=["src"],dt={class:"w-full"},ut={class:"text-lg font-bold mb-2 text-gray-100"},ct={class:"flex flex-row gap-2"},mt={class:"text-sm font-medium text-gray-300"},pt=["onUpdate:modelValue","disabled","onInput"],bt={class:"text-sm font-medium text-gray-300"},vt=["disabled","onUpdate:modelValue","onInput"],gt={class:"text-sm font-medium text-gray-300"},yt=["onUpdate:modelValue"],ft=["onClick"],_t=["disabled"],ht={class:"mt-4 text-lg font-bold text-gray-100"},xt={key:1,class:"mt-4"},wt={class:"text-lg font-bold text-gray-100"},kt={class:"mt-6 flex flex-col gap-4"},Ct=["disabled"],Bt=["disabled"],St={class:"p-6"},Vt={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2 transition-all duration-300"},Ut={class:"px-4 py-2 font-bold"},Tt={class:"px-4 py-2"},At={key:1,class:"table-auto w-full text-sm text-gray-200 transition-all duration-300"},Ft={class:"border border-black px-1 py-1 shrink w-0"},zt={class:"border border-black px-2 py-1"},Et={class:"border border-black px-2 py-1"},Rt={__name:"BonusBattle",setup(C){const $=Ve(),r=d(!0),B=d(""),R=d("5-10"),O=d(""),H=d("2"),x=A(()=>$.concurrents),m=d(null),D=d(null),G=d(null),P=d(null),S=d([{}]),Q=d(null),V=d([]),M=d(!1),U=d(!1),g=d(null),y=d([]);let J=d(!1);const X=Ce(),Y=A(()=>X.availableGames);let K=d(null);fe(async()=>{await f()});const I=A(()=>x.value.length<4?!0:x.value.some(s=>!s.game_id)),L=A(()=>S.value?S.value.length<2?!1:S.value.every(s=>s.cost_buy>0):!1),le=A(()=>`${window.location.origin}/streamer/${we().props.user.id}`),oe=()=>{J.value=!0},W=()=>{J.value=!1},j=s=>{$.addConcurrent(s)},ie=async()=>{await _.patch("/api/bonus-battles/switch-predictions",{is_open:U.value,bonus_battle_id:m.value.id}).then(async()=>{await f()})},ee=async()=>{y.value.forEach(s=>{const t=(s==null?void 0:s.scores.length)>0?s.scores[s.scores.length-1].cost_buy:0;s==null||s.scores.push({bracket_id:P.value.id,bonus_concurrent_id:s.id,cost_buy:t,score:0,result_buy:0})}),await q(),await f()},ne=async(s,t)=>{await de(y.value[s].scores[t].id),y.value[s].scores.splice(t,1),await f()},te=async(s,t)=>{K&&clearTimeout(K),K=setTimeout(async()=>{const e=y.value[s].scores[t];e.cost_buy>0?(e.score=parseFloat((e.result_buy/e.cost_buy).toFixed(3)),await q()):alert("Amount must be greater than 0.")},1e3)},re=s=>s.reduce((t,e)=>t+e.score,0).toFixed(3),de=async s=>{var t;try{r.value=!0;const e=await _.delete(`/api/bonus-battles/delete-score/${s}`);await q()}catch(e){console.error("Failed to delete bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}finally{r.value=!1}},q=async()=>{var s;try{r.value=!0;const t=await _.post("/api/bonus-battles/add-score",{active_bracket:P.value.id,bracket:y.value})}catch(t){console.error("Failed to store bonus score:",((s=t.response)==null?void 0:s.data)||t.message)}finally{r.value=!1}},ue=async()=>{var s;if(!B.value||x.value.some(t=>!t.game_id)){alert("All fields must be filled to start.");return}try{await _.post("/api/bonus-battles",{title:B.value,stake:R.value,prize:O.value,buys:H.value,concurrents:x.value}),await f()}catch(t){console.error("Failed to store bonus battle:",((s=t.response)==null?void 0:s.data)||t.message),alert("An error occurred while saving the bonus battle. Please try again.")}},ce=async()=>{var s;try{const t=await _.post("/api/bonus-battles/end-battle",{bonus_battle_id:m.value.id});g.value=t.data.winner,await f()}catch(t){console.log("endBattle error:",((s=t.response)==null?void 0:s.data)||t.message)}},me=async()=>{var s;try{r.value=!0,await _.post("/api/bonus-battles/end-battle-forced",{bonus_battle_id:m.value.id}),W()}catch(t){console.error("Failed to force close bonus battle:",((s=t.response)==null?void 0:s.data)||t.message),alert("A aparut o eroare la închiderea forțată a turneului. Te rugăm să în contactezi pe Mala!")}finally{await f(),r.value=!1}},pe=async()=>{var s;try{r.value=!0,await _.post("/api/bonus-battles/finish-round",{active_bracket:P.value.id}),await f()}catch(t){console.error("Failed to finish round:",((s=t.response)==null?void 0:s.data)||t.message),alert("An error occurred while finishing the round. Please try again.")}finally{r.value=!1}},be=async(s,t)=>{try{r.value=!0,await _.put("/api/bonus-battles/edit-concurrent",{id:s,game_id:t}),await f(),M.value=!1}catch{alert("Please try again.")}finally{r.value=!1}},f=async()=>{var s,t;try{r.value=!0;const e=await _.get("/api/bonus-battles/active");if(Q.value=e.data.total_battles,m.value=e.data.battle,D.value=e.data.concurrents,G.value=e.data.stage,P.value=e.data.bracket,S.value=e.data.scores,V.value=e.data.history,U.value=Boolean((s=e.data.battle)==null?void 0:s.is_open),B.value="Bonus Battle #"+(Q.value+1),D.value){const i=D.value;y.value=i.slice(0,2).map(u=>{const v=S.value.filter(ge=>ge.bonus_concurrent_id===u.id);return{...u,scores:v.length?v:[]}})}if(y.value.some(i=>i.scores.length===0)){const i=((t=m.value)==null?void 0:t.buys)||0;if(i>0)for(let u=0;u<i;u++)await ee()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{r.value=!1}},T=s=>{const t=X.availableGames.find(e=>e.id===s);return t?`/storage/games/${t.image}`:""},ve=s=>{x.value=x.value.map((t,e)=>({...t,for_user:s[e]!==void 0?s[e]:""}))};return(s,t)=>(l(),_e(ke,{title:"Bonus Battle"},{default:F(()=>[a("div",Ue,[a("div",Te,[m.value?(l(),o("div",Ae,[a("div",Fe,[t[11]||(t[11]=a("span",{class:"text-sm text-gray-300"},"LINK pentru View-eri (predicții)",-1)),a("div",ze,n(le.value),1)]),a("div",Ee,[a("span",Ne,[w(n(U.value?"Predicții Pornite":"Predicții Oprite")+" ",1),a("label",$e,[h(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),onChange:ie,class:"sr-only peer"},null,544),[[he,U.value]]),t[12]||(t[12]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),a("button",{class:"btn-danger",onClick:oe}," INCHIDE TURNEU FORȚAT ")])])):c("",!0),!m.value&&!g.value?(l(),o("div",Ge,[a("div",Pe,[a("div",Me,[a("div",null,[t[13]||(t[13]=a("label",{for:"title",class:"block text-sm font-medium text-gray-300"},"Titlu Bonus Battle",-1)),h(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e),id:"title",class:"mt-1 block w-full input-primary"},null,512),[[k,B.value]])]),a("div",null,[t[14]||(t[14]=a("label",{for:"stake",class:"block text-sm font-medium text-gray-300"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),h(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>R.value=e),id:"stake",class:"mt-1 block w-full input-primary"},null,512),[[k,R.value]])]),a("div",null,[t[15]||(t[15]=a("label",{for:"prize",class:"block text-sm font-medium text-gray-300"},"Premiu",-1)),h(a("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>O.value=e),id:"prize",class:"mt-1 block w-full input-primary"},null,512),[[k,O.value]])]),a("div",null,[t[16]||(t[16]=a("label",{for:"buys",class:"block text-sm font-medium text-gray-300"},"Câte buys per joc (poți face ulterior câte vrei)",-1)),h(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>H.value=e),id:"buys",class:"mt-1 block w-full input-primary"},null,512),[[k,H.value]])])]),a("div",Le,[a("div",je,[a("h3",Re,[t[17]||(t[17]=w(" Participanți ")),a("div",Oe,[a("button",{onClick:t[5]||(t[5]=e=>j(4)),class:"btn-primary"},"4"),a("button",{onClick:t[6]||(t[6]=e=>j(8)),class:"btn-primary"},"8"),a("button",{onClick:t[7]||(t[7]=e=>j(16)),class:"btn-primary"},"16"),a("button",{onClick:t[8]||(t[8]=e=>j(4)),class:"btn-danger"},"RESET")])]),z(xe,{name:"fade"},{default:F(()=>[(l(!0),o(E,null,N(x.value,(e,b)=>(l(),o("div",{key:b,class:"relative overflow-hidden flex items-center gap-4 bg-gray-800 p-4 rounded-md shadow transition-all duration-300",style:ae(e.game_id?{"--bg-image":"url("+T(e.game_id)+")"}:{})},[e.game_id?(l(),o("div",He)):c("",!0),a("div",De,[e.game_id?(l(),o("img",{key:0,src:T(e.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-md"},null,8,Je)):c("",!0),z(Z(se),{options:Y.value,label:"name",reduce:i=>i.id,modelValue:e.game_id,"onUpdate:modelValue":i=>e.game_id=i,placeholder:"Alege Joc",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),h(a("input",{type:"text","onUpdate:modelValue":i=>e.for_user=i,class:"flex-1 input-primary",placeholder:"Cine a ales? (opțional)"},null,8,Ke),[[k,e.for_user]])])],4))),128))]),_:1})]),z(Be,{onWinnersPicked:ve,fillCount:x.value.length},null,8,["fillCount"])]),a("button",{disabled:I.value,class:p([{"opacity-50 cursor-not-allowed":I.value},"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300"]),type:"button",onClick:ue}," Start ",10,We)])])):c("",!0),g.value&&!m.value?(l(),o("div",qe,[a("div",Ze,[a("div",Qe,[g.value.game.image?(l(),o("img",{key:0,src:T(g.value.game.id),alt:"Game Thumbnail",class:"w-32 mx-auto object-cover rounded-md mb-4"},null,8,Xe)):c("",!0),a("h2",Ye," Câștigător! - "+n(g.value.game.name),1),a("p",Ie," User: "+n(g.value.for_user),1)])])])):c("",!0),z(Se,{show:Z(J),onClose:W},{title:F(()=>t[18]||(t[18]=[w(" Ești sigur că vrei să închizi forțat acest Bonus Battle? ")])),content:F(()=>t[19]||(t[19]=[w(" Vom închide forțat acest Bonus Battle și nu vei mai putea reveni la el. Ești sigur că vrei să continui? ")])),footer:F(()=>[a("button",{onClick:W,class:"btn-danger"}," ANULEAZĂ "),a("button",{class:"ml-3 btn-primary",onClick:me}," ÎNCHIDE FORȚAT ACEST BONUS BATTLE ")]),_:1},8,["show"]),m.value?(l(),o("div",et,[a("div",tt,[a("div",at,[a("h2",st,"Active Battle: "+n(m.value.title),1),a("p",lt," Miza: "+n(m.value.stake)+" | Etapa: "+n(G.value.name)+" | Premiu: "+n(m.value.prize)+" | Buys: "+n(m.value.buys),1)]),y.value.length>1?(l(),o("div",ot,[(l(!0),o(E,null,N(y.value,(e,b)=>(l(),o("div",{key:b,class:p(["relative border rounded-md p-4 shadow transition-all duration-300 game-active-row",e.game.image?"bg-transparent":"bg-gray-900"]),style:ae(e.game.image?{"--bg-image":"url("+T(e.game.id)+")"}:{})},[e.game.image?(l(),o("div",it)):c("",!0),a("div",{class:p(["relative z-10 p-4",e.game.image?"bg-black bg-opacity-60":"bg-gray-900"])},[a("div",nt,[e.game.image?(l(),o("img",{key:0,src:T(e.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-md"},null,8,rt)):c("",!0),a("div",dt,[a("h3",ut,n(e.game.name)+" - "+n(e.for_user),1),a("div",ct,[z(Z(se),{disabled:!M.value,options:Y.value,label:"name",reduce:i=>i.id,"onUpdate:modelValue":i=>be(e.id,i),placeholder:"Schimbi jocul?",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["disabled","options","reduce","onUpdate:modelValue"]),a("button",{class:"btn-secondary transition-all duration-300",onClick:t[9]||(t[9]=i=>M.value=!M.value)}," SCHIMBA JOCU ")])])]),a("div",null,[(l(!0),o(E,null,N(e.scores,(i,u)=>(l(),o("div",{key:u,class:"flex items-center space-x-2 mt-1 transition-all duration-300"},[a("label",mt,[t[20]||(t[20]=w(" Cost Buy ")),h(a("input",{type:"number","onUpdate:modelValue":v=>e.scores[u].cost_buy=v,class:p(["block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300 input-primary",{"input-disabled":r.value}]),disabled:r.value,placeholder:"Amount",onInput:v=>te(b,u)},null,42,pt),[[k,e.scores[u].cost_buy]])]),a("label",bt,[t[21]||(t[21]=w(" Rezultat Buy ")),h(a("input",{disabled:i.cost_buy<=0||r.value,class:p([{"input-disabled":i.cost_buy<=0||r.value,"input-primary":i.cost_buy>0},"block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300"]),type:"number","onUpdate:modelValue":v=>e.scores[u].result_buy=v,placeholder:"Result",onInput:v=>te(b,u)},null,42,vt),[[k,e.scores[u].result_buy]])]),a("label",gt,[t[22]||(t[22]=w(" Scor ")),h(a("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":v=>e.scores[u].score=v,class:"block w-20 border border-gray-600 rounded-md shadow-sm p-2 input-disabled transition-all duration-300",placeholder:"Result"},null,8,yt),[[k,e.scores[u].score]])]),u>=1?(l(),o("button",{key:0,type:"button",onClick:v=>ne(b,u),class:"btn-danger transition-all duration-300 align-middle"},t[23]||(t[23]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,ft)):c("",!0)]))),128)),a("button",{type:"button",onClick:t[10]||(t[10]=i=>ee()),disabled:r.value,class:p([{"input-disabled":r.value},"btn-primary mt-2"])}," Adaugă Buy ",10,_t)]),a("p",ht," Scor Total: "+n(re(e.scores)),1)],2)],6))),128))])):c("",!0),g.value?(l(),o("div",xt,[a("p",wt,"Câștigător: "+n(g.value.game.name)+" | User: "+n(g.value.for_user),1)])):c("",!0),a("div",kt,[G.value.name!=="Final"?(l(),o("button",{key:0,type:"button",onClick:pe,class:p(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!L.value||r.value}]),disabled:!L.value||r.value}," Următoarii Concurenți ",10,Ct)):c("",!0),G.value.name==="Final"?(l(),o("button",{key:1,type:"button",onClick:ce,class:p(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!L.value}]),disabled:!L.value}," Termina Battle ",10,Bt)):c("",!0)])]),a("div",St,[V.value.stage_brackets.length>0?(l(),o("table",Vt,[a("tbody",null,[(l(!0),o(E,null,N(V.value.stage_brackets,(e,b)=>(l(),o("tr",{key:e.id,class:p(b%2===0?"bg-gray-900":"bg-gray-800")},[a("td",Ut,[a("span",{class:p({"line-through text-gray-500":e.winner!==e.participant_a})},n(e.participant_a),3),t[24]||(t[24]=w(" vs ")),a("span",{class:p({"line-through text-gray-500":e.winner!==e.participant_b})},n(e.participant_b),3)]),a("td",Tt,n(parseFloat(e.participant_a_score).toFixed(3))+" - "+n(parseFloat(e.participant_b_score).toFixed(3)),1)],2))),128))])])):c("",!0),V.value.concurrents.length>0?(l(),o("table",At,[a("tbody",null,[(l(!0),o(E,null,N(V.value.concurrents,(e,b)=>(l(),o("tr",{key:e==null?void 0:e.id,class:p(b%2===0?"bg-gray-900":"bg-gray-800")},[a("td",Ft,n(e!=null&&e.is_eliminated?"❌":"✅"),1),a("td",zt,n((e==null?void 0:e.game.name)||"N/A"),1),a("td",Et,n((e==null?void 0:e.for_user)||"N/A"),1)],2))),128))])])):c("",!0)])])):c("",!0)])])]),_:1}))}};export{Rt as default};
