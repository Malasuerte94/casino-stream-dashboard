import{i as d,l as j,j as le,f as oe,w as q,k as u,o as l,b as a,c as o,h as y,q as _,d as C,a as E,F as V,s as S,x as O,u as K,T as ie,n as b,t as n}from"./app-c875309f.js";import{_ as ne}from"./AppLayout-00d9b5c7.js";import{u as re,C as Q}from"./gameStore-860d10ea.js";import"./ResponsiveNavLink-65c0217e.js";import"./_plugin-vue_export-helper-c27b6911.js";const de={class:"py-4"},ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},me={key:0,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},ce={class:"p-6 space-y-4"},pe={class:"flex flex-row gap-2"},be={class:"bg-gray-800 p-6 rounded-md shadow-md space-y-4 transition-all duration-300"},ge={class:"text-lg font-semibold text-gray-300 flex gap-2 items-center"},ve={class:"flex gap-4"},ye={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},_e={class:"relative z-10 flex items-center gap-4 w-full"},fe=["src"],he=["onUpdate:modelValue"],xe=["disabled"],we={key:1,class:"bg-gray-900 overflow-hidden shadow-lg rounded-md transition-all duration-300"},ke={class:"p-6 flex justify-center items-center bg-gray-800"},Be={class:"w-full max-w-md bg-gray-900 shadow-lg rounded-md p-6 text-center transition-all duration-300"},Ce=["src"],Ve={class:"text-2xl font-bold text-gray-100 mb-2"},Se={class:"text-lg font-medium text-gray-300"},Ue={key:2,class:"bg-gray-900 overflow-hidden shadow-lg rounded-md mt-6 transition-all duration-300"},Fe={class:"p-6"},ze={class:"text-xl font-bold mb-4 text-gray-100"},Ae={class:"text-gray-300"},Ge={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Te={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},$e={class:"flex gap-2 items-center mb-2 p-2 rounded-md border border-gray-600 transition-all duration-300"},Ne=["src"],Me={class:"w-full"},Pe={class:"text-lg font-bold mb-2 text-gray-100"},je={class:"flex flex-row gap-2"},Ee={class:"text-sm font-medium text-gray-300"},Re=["onUpdate:modelValue"],He={class:"text-sm font-medium text-gray-300"},Le=["disabled","onUpdate:modelValue","onInput"],De={class:"text-sm font-medium text-gray-300"},Je=["onUpdate:modelValue"],qe=["onClick"],Oe={class:"mt-4 text-lg font-bold text-gray-100"},Ke={key:1,class:"mt-4"},Qe={class:"text-lg font-bold text-gray-100"},We={class:"mt-6 flex flex-col gap-4"},Xe=["disabled"],Ye=["disabled"],Ze={class:"p-6"},Ie={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2 transition-all duration-300"},et={class:"px-4 py-2 font-bold"},tt={class:"px-4 py-2"},at={key:1,class:"table-auto w-full text-sm text-gray-200 transition-all duration-300"},st={class:"border border-black px-1 py-1 shrink w-0"},lt={class:"border border-black px-2 py-1"},ot={class:"border border-black px-2 py-1"},ct={__name:"BonusBattle",setup(it){const W=d(!0),x=d(""),G=d("5-10"),T=d(""),$=d("2"),h=d([{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null}]),c=d(null),N=d(null),U=d(null),F=d(null),w=d([{}]),R=d(null),k=d([]),z=d(!1),p=d(null),g=d([]),H=re(),L=j(()=>H.availableGames);le(async()=>{await f()});const D=j(()=>h.value.length<4?!0:h.value.some(s=>!s.game_id)),A=j(()=>w.value?w.value.length<2?!1:w.value.every(s=>s.cost_buy>0):!1),M=s=>{h.value=Array.from({length:s},()=>({game_id:"",for_user:""}))},J=async()=>{g.value.forEach(s=>{const e=(s==null?void 0:s.scores.length)>0?s.scores[s.scores.length-1].cost_buy:0;s==null||s.scores.push({bracket_id:F.value.id,bonus_concurrent_id:s.id,cost_buy:e,score:0,result_buy:0})}),await P(),await f()},X=async(s,e)=>{await I(g.value[s].scores[e].id),g.value[s].scores.splice(e,1),await f()},Y=async(s,e)=>{const t=g.value[s].scores[e];t.cost_buy>0?(t.score=parseFloat((t.result_buy/t.cost_buy).toFixed(3)),await P()):alert("Amount must be greater than 0.")},Z=s=>s.reduce((e,t)=>e+t.score,0).toFixed(3),I=async s=>{var e;try{const t=await axios.delete(`/api/bonus-battles/delete-score/${s}`);console.log("Bonus score deleted successfully:",t.data),await P()}catch(t){console.error("Failed to delete bonus score:",((e=t.response)==null?void 0:e.data)||t.message)}},P=async()=>{var s;try{const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:F.value.id,bracket:g.value});console.log("Bonus battle stored successfully:",e.data)}catch(e){console.error("Failed to store bonus score:",((s=e.response)==null?void 0:s.data)||e.message)}},ee=async()=>{var s;if(!x.value||h.value.some(e=>!e.game_id)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:x.value,stake:G.value,prize:T.value,buys:$.value,concurrents:h.value});console.log("Bonus battle stored successfully:",e.data),await f()}catch(e){console.error("Failed to store bonus battle:",((s=e.response)==null?void 0:s.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},te=async()=>{var s;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:c.value.id});p.value=e.data.winner,await f()}catch(e){console.log("endBattle error:",((s=e.response)==null?void 0:s.data)||e.message)}},ae=async()=>{var s;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:F.value.id}),await f()}catch(e){console.error("Failed to finish round:",((s=e.response)==null?void 0:s.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}},se=async(s,e)=>{try{await axios.put("/api/bonus-battles/edit-concurrent",{id:s,game_id:e}),await f(),z.value=!1}catch{alert("Please try again.")}},f=async()=>{var s;try{const e=await axios.get("/api/bonus-battles/active");if(R.value=e.data.total_battles,c.value=e.data.battle,N.value=e.data.concurrents,U.value=e.data.stage,F.value=e.data.bracket,w.value=e.data.scores,k.value=e.data.history,x.value="Bonus Battle #"+(R.value+1),N.value){const r=N.value;g.value=r.slice(0,2).map(i=>{const m=w.value.filter(v=>v.bonus_concurrent_id===i.id);return{...i,scores:m.length?m:[]}})}if(g.value.some(r=>r.scores.length===0)){const r=((s=c.value)==null?void 0:s.buys)||0;if(r>0)for(let i=0;i<r;i++)await J()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{W.value=!1}},B=s=>{const e=H.availableGames.find(t=>t.id===s);return e?`/storage/games/${e.image}`:""};return(s,e)=>s.loadiwng?u("",!0):(l(),oe(ne,{key:0,title:"Bonus Battle"},{default:q(()=>[a("div",de,[a("div",ue,[!c.value&&!p.value?(l(),o("div",me,[a("div",ce,[a("div",pe,[a("div",null,[e[9]||(e[9]=a("label",{for:"title",class:"block text-sm font-medium text-gray-300"},"Titlu Bonus Battle",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),id:"title",class:"mt-1 block w-full input-primary"},null,512),[[_,x.value]])]),a("div",null,[e[10]||(e[10]=a("label",{for:"stake",class:"block text-sm font-medium text-gray-300"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>G.value=t),id:"stake",class:"mt-1 block w-full input-primary"},null,512),[[_,G.value]])]),a("div",null,[e[11]||(e[11]=a("label",{for:"prize",class:"block text-sm font-medium text-gray-300"},"Premiu",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),id:"prize",class:"mt-1 block w-full input-primary"},null,512),[[_,T.value]])]),a("div",null,[e[12]||(e[12]=a("label",{for:"buys",class:"block text-sm font-medium text-gray-300"},"Câte buys per joc (poți face ulterior câte vrei)",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>$.value=t),id:"buys",class:"mt-1 block w-full input-primary"},null,512),[[_,$.value]])])]),a("div",be,[a("h3",ge,[e[13]||(e[13]=C(" Participanți ")),a("div",ve,[a("button",{onClick:e[4]||(e[4]=t=>M(4)),class:"btn-primary"},"4"),a("button",{onClick:e[5]||(e[5]=t=>M(8)),class:"btn-primary"},"8"),a("button",{onClick:e[6]||(e[6]=t=>M(16)),class:"btn-primary"},"16")])]),E(ie,{name:"fade"},{default:q(()=>[(l(!0),o(V,null,S(h.value,(t,r)=>(l(),o("div",{key:r,class:"relative overflow-hidden flex items-center gap-4 bg-gray-900 p-4 rounded-md shadow transition-all duration-300",style:O(t.game_id?{"--bg-image":"url("+B(t.game_id)+")"}:{})},[t.game_id?(l(),o("div",ye)):u("",!0),a("div",_e,[t.game_id?(l(),o("img",{key:0,src:B(t.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-md"},null,8,fe)):u("",!0),E(K(Q),{options:L.value,label:"name",reduce:i=>i.id,modelValue:t.game_id,"onUpdate:modelValue":i=>t.game_id=i,placeholder:"Alege Joc",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),y(a("input",{type:"text","onUpdate:modelValue":i=>t.for_user=i,class:"flex-1 input-primary",placeholder:"Cine a ales? (opțional)"},null,8,he),[[_,t.for_user]])])],4))),128))]),_:1})]),a("button",{disabled:D.value,class:b([{"opacity-50 cursor-not-allowed":D.value},"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300"]),type:"button",onClick:ee}," Start ",10,xe)])])):u("",!0),p.value&&!c.value?(l(),o("div",we,[a("div",ke,[a("div",Be,[p.value.game.image?(l(),o("img",{key:0,src:B(p.value.game.id),alt:"Game Thumbnail",class:"w-32 mx-auto object-cover rounded-md mb-4"},null,8,Ce)):u("",!0),a("h2",Ve," Câștigător! - "+n(p.value.game.name),1),a("p",Se," User: "+n(p.value.for_user),1)])])])):u("",!0),c.value?(l(),o("div",Ue,[a("div",Fe,[a("h2",ze,"Active Battle: "+n(c.value.title),1),a("p",Ae," Miza: "+n(c.value.stake)+" | Etapa: "+n(U.value.name)+" | Premiu: "+n(c.value.prize)+" | Buys: "+n(c.value.buys),1),g.value.length>1?(l(),o("div",Ge,[(l(!0),o(V,null,S(g.value,(t,r)=>(l(),o("div",{key:r,class:b(["relative border rounded-md p-4 shadow transition-all duration-300 game-active-row",t.game.image?"bg-transparent":"bg-gray-900"]),style:O(t.game.image?{"--bg-image":"url("+B(t.game.id)+")"}:{})},[t.game.image?(l(),o("div",Te)):u("",!0),a("div",{class:b(["relative z-10 p-4",t.game.image?"bg-black bg-opacity-60":"bg-gray-900"])},[a("div",$e,[t.game.image?(l(),o("img",{key:0,src:B(t.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-md"},null,8,Ne)):u("",!0),a("div",Me,[a("h3",Pe,n(t.game.name)+" - "+n(t.for_user),1),a("div",je,[E(K(Q),{disabled:!z.value,options:L.value,label:"name",reduce:i=>i.id,"onUpdate:modelValue":i=>se(t.id,i),placeholder:"Schimbi jocul?",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["disabled","options","reduce","onUpdate:modelValue"]),a("button",{class:"btn-secondary transition-all duration-300",onClick:e[7]||(e[7]=i=>z.value=!z.value)}," SCHIMBA JOCU ")])])]),a("div",null,[(l(!0),o(V,null,S(t.scores,(i,m)=>(l(),o("div",{key:m,class:"flex items-center space-x-2 mt-1 transition-all duration-300"},[a("label",Ee,[e[14]||(e[14]=C(" Cost Buy ")),y(a("input",{type:"number","onUpdate:modelValue":v=>t.scores[m].cost_buy=v,class:"block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300 input-primary",placeholder:"Amount"},null,8,Re),[[_,t.scores[m].cost_buy]])]),a("label",He,[e[15]||(e[15]=C(" Rezultat Buy ")),y(a("input",{disabled:i.cost_buy<=0,class:b([{"input-disabled opacity-50":i.cost_buy<=0,"input-primary":i.cost_buy>0},"block w-40 border border-gray-600 rounded-md shadow-sm p-2 transition-all duration-300"]),type:"number","onUpdate:modelValue":v=>t.scores[m].result_buy=v,placeholder:"Result",onInput:v=>Y(r,m)},null,42,Le),[[_,t.scores[m].result_buy]])]),a("label",De,[e[16]||(e[16]=C(" Scor ")),y(a("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":v=>t.scores[m].score=v,class:"block w-20 border border-gray-600 rounded-md shadow-sm p-2 input-disabled transition-all duration-300",placeholder:"Result"},null,8,Je),[[_,t.scores[m].score]])]),m>=1?(l(),o("button",{key:0,type:"button",onClick:v=>X(r,m),class:"btn-danger transition-all duration-300 align-middle"},e[17]||(e[17]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,qe)):u("",!0)]))),128)),a("button",{type:"button",onClick:e[8]||(e[8]=i=>J()),class:"btn-primary mt-2"}," Adaugă Buy ")]),a("p",Oe," Scor Total: "+n(Z(t.scores)),1)],2)],6))),128))])):u("",!0),p.value?(l(),o("div",Ke,[a("p",Qe,"Câștigător: "+n(p.value.game.name)+" | User: "+n(p.value.for_user),1)])):u("",!0),a("div",We,[U.value.name!=="Final"?(l(),o("button",{key:0,type:"button",onClick:ae,class:b(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!A.value}]),disabled:!A.value}," Următoarii Concurenți ",10,Xe)):u("",!0),U.value.name==="Final"?(l(),o("button",{key:1,type:"button",onClick:te,class:b(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!A.value}]),disabled:!A.value}," Termina Battle ",10,Ye)):u("",!0)])]),a("div",Ze,[k.value.stage_brackets.length>0?(l(),o("table",Ie,[a("tbody",null,[(l(!0),o(V,null,S(k.value.stage_brackets,(t,r)=>(l(),o("tr",{key:t.id,class:b(r%2===0?"bg-gray-900":"bg-gray-800")},[a("td",et,[a("span",{class:b({"line-through text-gray-500":t.winner!==t.participant_a})},n(t.participant_a),3),e[18]||(e[18]=C(" vs ")),a("span",{class:b({"line-through text-gray-500":t.winner!==t.participant_b})},n(t.participant_b),3)]),a("td",tt,n(parseFloat(t.participant_a_score).toFixed(3))+" - "+n(parseFloat(t.participant_b_score).toFixed(3)),1)],2))),128))])])):u("",!0),k.value.concurrents.length>0?(l(),o("table",at,[a("tbody",null,[(l(!0),o(V,null,S(k.value.concurrents,(t,r)=>(l(),o("tr",{key:t==null?void 0:t.id,class:b(r%2===0?"bg-gray-900":"bg-gray-800")},[a("td",st,n(t!=null&&t.is_eliminated?"❌":"✅"),1),a("td",lt,n((t==null?void 0:t.game.name)||"N/A"),1),a("td",ot,n((t==null?void 0:t.for_user)||"N/A"),1)],2))),128))])])):u("",!0)])])):u("",!0)])])]),_:1}))}};export{ct as default};
