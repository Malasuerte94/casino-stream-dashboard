import{_ as y,C as _,u as f}from"./MyInput-b14173b6.js";import{p as r,q as g,c as o,b as i,a as d,F as H,w as v,L as V,k as p,o as l,E as k,I as G,t as U,n as B}from"./app-044fa54a.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const L={components:{MyInput:y,vSelect:_},data(){return{bonusHunt:{},bonusHuntGames:[],fieldUpdateTimeouts:{},debounceTimer:null,loading:!1}},computed:{gameOptions(){return f().availableGames},isEnded(){return Boolean(this.bonusHunt.ended)}},mounted(){this.getLatestList()},methods:{validateBonusHuntStart(){return!this.bonusHunt.start||this.bonusHunt.start<=0?(alert("Vă rugăm să introduceți costul listei (Costul Hunt-ului)."),!1):!0},debounceUpdateBonusHunt(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.updateBonusHunt()},1e3)},debounceFieldUpdate(e,s){(s==="stake"||s==="result")&&this.calcCurentRowMultiplier(e),this.fieldUpdateTimeouts[e.id]||(this.fieldUpdateTimeouts[e.id]={}),this.fieldUpdateTimeouts[e.id][s]&&clearTimeout(this.fieldUpdateTimeouts[e.id][s]),this.fieldUpdateTimeouts[e.id][s]=setTimeout(()=>{this.updateBonusHuntGame()},1e3)},getGameThumbnail(e){const s=this.gameOptions.find(m=>m.id===e);return s?`/storage/games/${s.image}`:""},async getLatestList(){try{const e=await r.get("/api/bonus-hunt");this.bonusHunt=e.data.bonusHunt,this.bonusHuntGames=e.data.bonusHuntGames}catch(e){console.error(e)}},async updateBonusHunt(){let e=this.bonusHunt;this.loading=!0,await r.patch("/api/bonus-hunt",{bonusHunt:e}).catch(s=>{console.log(s)}).finally(async()=>{await this.getLatestList(),this.$emit("update"),this.loading=!1})},async updateBonusHuntGame(){if(this.validateBonusHuntStart())try{this.loading=!0;let e=this.bonusHuntGames;await r.put("/api/bonus-hunt-games",{games:e})}catch(e){console.error(e)}finally{await this.getLatestList(),this.loading=!1}},async createNewBonusHuntGameRow(){if(this.validateBonusHuntStart())try{await r.post("/api/bonus-hunt-games",{bonusHuntId:this.bonusHunt.id}),await this.getLatestList()}catch(e){console.error(e)}},async removeBonusHuntGameRow(e){try{await r.delete(`/api/bonus-hunt-games/${e}`),await this.getLatestList()}catch(s){console.error(s)}},wantToReset(){this.validateBonusHuntStart()&&this.$dialog({message:"Ești sigur că vrei să faci o listă nouă?",buttons:["da","nu"],da:this.resetBonusHunt,nu:()=>console.log("Canceled reset")})},async resetBonusHunt(){try{await r.post("/api/close-bonus-list",{close:!0,list_id:this.bonusHunt.id,type:"hunt"}),await r.post("/api/bonus-hunt"),await this.getLatestList(),this.$emit("newlist")}catch(e){console.error(e)}},calcCurentRowMultiplier(e){const s=this.bonusHuntGames.findIndex(n=>n.id===e.id);if(s===-1){console.error("Game not found in bonusHuntGames.");return}const m=parseFloat(e.stake),c=parseFloat(e.result);if(!e.game_id||isNaN(m)||isNaN(c)||c<0){console.warn("Invalid game data: Missing or invalid stake or result.");return}const a=c===0?0:Math.round(c/m);this.bonusHuntGames[s]={...e,multiplier:a,result:c,stake:m}}}},I={class:"p-6 rounded-lg shadow-md bg-gray-100 dark:bg-gray-800"},x={class:"space-y-6 mb-6"},C={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},E={key:0,class:"absolute inset-0 pointer-events-none bg-blur"},N={class:"text-center text-gray-800 dark:text-gray-200 font-medium"},R=["src"],M={key:1},S=["onClick"],z={key:0,class:"flex justify-center mt-8"},F={key:1};function A(e,s,m,c,a,n){const b=g("MyInput"),w=g("v-select");return l(),o("div",I,[i("div",x,[i("div",C,[d(b,{modelValue:a.bonusHunt.name,"onUpdate:modelValue":s[0]||(s[0]=t=>a.bonusHunt.name=t),type:"text",disabled:n.isEnded,onInput:n.debounceUpdateBonusHunt,label:"Nume Lista"},null,8,["modelValue","disabled","onInput"]),d(b,{modelValue:a.bonusHunt.start,"onUpdate:modelValue":s[1]||(s[1]=t=>a.bonusHunt.start=t),type:"number",disabled:n.isEnded,onInput:n.debounceUpdateBonusHunt,label:"Cost (LEI)"},null,8,["modelValue","disabled","onInput"]),d(b,{modelValue:a.bonusHunt.result,"onUpdate:modelValue":s[2]||(s[2]=t=>a.bonusHunt.result=t),type:"number",disabled:!0,label:"Rezultat (LEI)"},null,8,["modelValue"]),i("button",{onClick:s[3]||(s[3]=(...t)=>n.wantToReset&&n.wantToReset(...t)),class:"btn-primary w-full md:w-auto"}," LISTA NOUA ")])]),a.bonusHuntGames.length>0&&a.bonusHunt.start>0?(l(),o(H,{key:0},[d(V,{name:"fade"},{default:v(()=>[(l(!0),o(H,null,k(a.bonusHuntGames,(t,h)=>(l(),o("div",{key:t.id||h,class:"relative mb-4 rounded-lg shadow overflow-hidden game-row",style:G(t.game_id?{"--bg-image":`url(${n.getGameThumbnail(t.game_id)})`}:{})},[t.game_id?(l(),o("div",E)):p("",!0),i("div",{class:B(["relative z-10 grid grid-cols-1 md:grid-cols-[10px_50px_1fr_120px_120px_120px_50px] gap-4 items-center p-2",t.game_id?"bg-transparent":"bg-white dark:bg-gray-700"])},[i("div",N,U(h+1),1),t.game_id?(l(),o("img",{key:0,src:n.getGameThumbnail(t.game_id),alt:"Game Thumbnail",class:"w-20 h-20 object-cover rounded-lg mb-2"},null,8,R)):(l(),o("span",M)),d(w,{disabled:n.isEnded||a.loading,options:n.gameOptions,label:"name",reduce:u=>u.id,"append-to-body":"","onUpdate:modelValue":[u=>n.debounceFieldUpdate(t,"game_id"),u=>t.game_id=u],modelValue:t.game_id},null,8,["disabled","options","reduce","onUpdate:modelValue","modelValue"]),d(b,{modelValue:t.stake,"onUpdate:modelValue":u=>t.stake=u,type:"number",disabled:n.isEnded||a.loading,onInput:u=>n.debounceFieldUpdate(t,"stake"),label:"Miză",min:"1",step:"0.1"},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),d(b,{modelValue:t.result,"onUpdate:modelValue":u=>t.result=u,type:"number",disabled:n.isEnded||a.loading,onInput:u=>n.debounceFieldUpdate(t,"result"),step:"0.1",min:"0.1",label:"Rezultat (LEI)"},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),d(b,{modelValue:t.multiplier,"onUpdate:modelValue":u=>t.multiplier=u,type:"number",disabled:!0,label:"Multiplicator"},null,8,["modelValue","onUpdate:modelValue"]),n.isEnded?p("",!0):(l(),o("button",{key:2,onClick:u=>n.removeBonusHuntGameRow(t.id),class:"btn-danger"},s[5]||(s[5]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,S))],2)],4))),128))]),_:1}),n.isEnded?p("",!0):(l(),o("div",z,[i("button",{onClick:s[4]||(s[4]=(...t)=>n.createNewBonusHuntGameRow&&n.createNewBonusHuntGameRow(...t)),class:"btn-primary w-full max-w-md"}," + Adaugă Joc ")]))],64)):(l(),o("div",F," Introdu costul listei pentru a adăuga jocuri. "))])}const D=T(L,[["render",A]]);export{D as default};
