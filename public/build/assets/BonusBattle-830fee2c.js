import{K as _e,i as n,m as F,j as he,p as h,f as xe,w as A,o as s,b as a,c as o,t as i,d as C,h as ae,B as le,k as c,a as b,F as z,E as $,I as se,u as q,L as we,n as v,J as ke}from"./app-066868d1.js";import{_ as Ve}from"./AppLayout-bdcd2d17.js";import{u as Ce,_ as w,C as oe}from"./MyInput-6d08464b.js";import Be from"./BonusBattleViewers-17f080a6.js";import{_ as Se}from"./DialogModal-a92ddbea.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./NavLink-5f7fc5e9.js";import"./RegisterForm-181d71b1.js";import"./AuthenticationCard-15693253.js";import"./TextInput-2767d28d.js";import"./InputLabel-20d7c0e0.js";import"./PrimaryButton-f0fcd8df.js";const Ue=_e("battle",{state:()=>({concurrents:[{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null},{game_id:null,for_user:null}]}),actions:{setConcurrents(k){this.concurrents=k},addConcurrent(k){this.concurrents=Array.from({length:k},()=>({game_id:"",for_user:""}))},updateConcurrent(k,E){this.concurrents[k]={...this.concurrents[k],...E}}},persist:!0});const Te={class:"py-4"},Fe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ae={key:0,class:"px-6 py-3 flex items-center justify-between bg-gray-800 rounded-md shadow-md transition-all duration-300"},ze={class:"flex items-center space-x-4"},$e={class:"text-sm font-bold py-1 px-3 bg-gray-700 rounded-md border border-gray-600 transition"},Ee={class:"flex items-center space-x-4"},Ne={class:"ml-3 text-sm font-medium text-gray-300 flex items-center gap-2"},Ge={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},Pe={key:1,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},je={class:"p-6 space-y-4"},Le={class:"flex flex-row gap-2"},Me={class:"ml-3 text-sm font-medium text-gray-300 flex items-center gap-2"},Re={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},Oe={class:"flex flex-col md:flex-row md:space-x-4"},He={class:"md:w-2/3 bg-gray-800 p-6 rounded-md shadow-md space-y-4 transition-all duration-300"},De={class:"text-lg font-semibold text-gray-300 flex gap-2 items-center"},Je={class:"flex gap-4"},Ke={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},We={class:"relative z-10 flex items-center gap-4 w-full"},Ze=["src"],qe=["disabled"],Qe={key:2,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md transition-all duration-300"},Xe={class:"p-6 flex justify-center items-center bg-gray-800"},Ye={class:"w-full max-w-md bg-gray-800 shadow-lg rounded-md p-6 text-center transition-all duration-300"},Ie=["src"],et={class:"text-2xl font-bold text-gray-100 mb-2"},tt={class:"text-lg font-medium text-gray-300"},at={key:3,class:"bg-gray-800 overflow-hidden shadow-lg rounded-md mt-6 transition-all duration-300 relative"},lt={key:0,class:"absolute inset-0 bg-black/30 backdrop-blur-md flex items-center justify-center rounded-lg p-0 z-50"},st={class:"p-6"},ot={class:"flex flex-row justify-between"},it={class:"text-xl font-bold mb-4 text-gray-100"},rt={class:"text-gray-300"},nt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},dt={key:0,class:"absolute inset-0 pointer-events-none bg-blur transition-all duration-300"},ut={class:"flex gap-2 items-center mb-2 p-2 rounded-md border border-gray-600 transition-all duration-300"},ct=["src"],mt={class:"w-full"},bt={class:"text-lg font-bold mb-2 text-gray-100"},pt={class:"flex flex-row gap-2"},gt=["onClick","disabled"],vt=["disabled"],ft={class:"mt-4 text-lg font-bold text-gray-100"},yt={key:1,class:"mt-4"},_t={class:"text-lg font-bold text-gray-100"},ht={class:"mt-6 flex flex-col gap-4"},xt=["disabled"],wt=["disabled"],kt={class:"p-6"},Vt={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2 transition-all duration-300"},Ct={class:"px-4 py-2 font-bold"},Bt={class:"px-4 py-2"},St={key:1,class:"table-auto w-full text-sm text-gray-200 transition-all duration-300"},Ut={class:"border border-black px-1 py-1 shrink w-0"},Tt={class:"border border-black px-2 py-1"},Ft={class:"border border-black px-2 py-1"},Ht={__name:"BonusBattle",setup(k){const E=Ue(),d=n(!0),B=n(""),R=n("5-10"),O=n(""),H=n("2"),N=n(!0),x=F(()=>E.concurrents),m=n(null),D=n(null),G=n(null),P=n(null),S=n([{}]),Q=n(null),U=n([]),j=n(!1),V=n(!1),f=n(null),y=n([]);let J=n(!1);const X=Ce(),Y=F(()=>X.availableGames);let K=n(null);he(async()=>{await _()});const I=F(()=>x.value.length<4?!0:x.value.some(l=>!l.game_id)),L=F(()=>S.value?S.value.length<2?!1:S.value.every(l=>l.cost_buy>0):!1),ie=F(()=>`${window.location.origin}/${ke().props.user.name}`),re=()=>{J.value=!0},W=()=>{J.value=!1},M=l=>{E.addConcurrent(l)},ne=async()=>{await h.patch("/api/bonus-battles/switch-predictions",{is_open:V.value,bonus_battle_id:m.value.id}).then(async()=>{await _()})},ee=async()=>{y.value.forEach(l=>{const t=(l==null?void 0:l.scores.length)>0?l.scores[l.scores.length-1].cost_buy:0;l==null||l.scores.push({bracket_id:P.value.id,bonus_concurrent_id:l.id,cost_buy:t,score:0,result_buy:0})}),await Z(),await _()},de=async(l,t)=>{await ce(y.value[l].scores[t].id),y.value[l].scores.splice(t,1),await _()},te=async(l,t)=>{K&&clearTimeout(K),K=setTimeout(async()=>{const e=y.value[l].scores[t];e.cost_buy>0?(e.score=parseFloat((e.result_buy/e.cost_buy).toFixed(3)),await Z()):alert("Amount must be greater than 0.")},1e3)},ue=l=>l.reduce((t,e)=>t+e.score,0).toFixed(3),ce=async l=>{var t;try{d.value=!0;const e=await h.delete(`/api/bonus-battles/delete-score/${l}`);await Z()}catch(e){console.error("Failed to delete bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}finally{d.value=!1}},Z=async()=>{var l;try{d.value=!0;const t=await h.post("/api/bonus-battles/add-score",{active_bracket:P.value.id,bracket:y.value})}catch(t){console.error("Failed to store bonus score:",((l=t.response)==null?void 0:l.data)||t.message)}finally{d.value=!1}},me=async()=>{var l;if(!B.value||x.value.some(t=>!t.game_id)){alert("All fields must be filled to start.");return}try{await h.post("/api/bonus-battles",{title:B.value,stake:R.value,prize:O.value,buys:H.value,isRandom:N.value,concurrents:x.value}),await _()}catch(t){console.error("Failed to store bonus battle:",((l=t.response)==null?void 0:l.data)||t.message),alert("An error occurred while saving the bonus battle. Please try again.")}},be=async()=>{var l;try{const t=await h.post("/api/bonus-battles/end-battle",{bonus_battle_id:m.value.id});f.value=t.data.winner,await _()}catch(t){console.log("endBattle error:",((l=t.response)==null?void 0:l.data)||t.message)}},pe=async()=>{var l;try{d.value=!0,await h.post("/api/bonus-battles/end-battle-forced",{bonus_battle_id:m.value.id}),W()}catch(t){console.error("Failed to force close bonus battle:",((l=t.response)==null?void 0:l.data)||t.message),alert("A aparut o eroare la închiderea forțată a turneului. Te rugăm să în contactezi pe Mala!")}finally{await _(),d.value=!1}},ge=async()=>{var l;try{d.value=!0,await h.post("/api/bonus-battles/finish-round",{active_bracket:P.value.id}),await _()}catch(t){console.error("Failed to finish round:",((l=t.response)==null?void 0:l.data)||t.message),alert("An error occurred while finishing the round. Please try again.")}finally{d.value=!1}},ve=async(l,t)=>{try{d.value=!0,await h.put("/api/bonus-battles/edit-concurrent",{id:l,game_id:t}),await _(),j.value=!1}catch{alert("Please try again.")}finally{d.value=!1}},_=async()=>{var l,t;try{d.value=!0;const e=await h.get("/api/bonus-battles/active");if(Q.value=e.data.total_battles,m.value=e.data.battle,D.value=e.data.concurrents,G.value=e.data.stage,P.value=e.data.bracket,S.value=e.data.scores,U.value=e.data.history,V.value=Boolean((l=e.data.battle)==null?void 0:l.is_open),B.value="Bonus Battle #"+(Q.value+1),D.value){const r=D.value;y.value=r.slice(0,2).map(u=>{const g=S.value.filter(ye=>ye.bonus_concurrent_id===u.id);return{...u,scores:g.length?g:[]}})}if(y.value.some(r=>r.scores.length===0)){const r=((t=m.value)==null?void 0:t.buys)||0;if(r>0)for(let u=0;u<r;u++)await ee()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{d.value=!1}},T=l=>{const t=X.availableGames.find(e=>e.id===l);return t?`/storage/games/${t.image}`:""},fe=l=>{x.value=x.value.map((t,e)=>({...t,for_user:l[e]!==void 0?l[e]:""}))};return(l,t)=>(s(),xe(Ve,{title:"Bonus Battle"},{default:A(()=>[a("div",Te,[a("div",Fe,[m.value?(s(),o("div",Ae,[a("div",ze,[t[12]||(t[12]=a("span",{class:"text-sm text-gray-300"},"LINK pentru View-eri (predicții)",-1)),a("div",$e,i(ie.value),1)]),a("div",Ee,[a("span",Ne,[C(i(V.value?"Predicții Pornite":"Predicții Oprite")+" ",1),a("label",Ge,[ae(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),onChange:ne,class:"sr-only peer"},null,544),[[le,V.value]]),t[13]||(t[13]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))])]),a("button",{class:"btn-danger",onClick:re}," INCHIDE TURNEU FORȚAT ")])])):c("",!0),!m.value&&!f.value?(s(),o("div",Pe,[a("div",je,[a("div",Le,[b(w,{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e),label:"Titlu Bonus Battle",type:"text"},null,8,["modelValue"]),b(w,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=e=>R.value=e),label:"Miză (eg: 5-8, 5, 10-20)",type:"text"},null,8,["modelValue"]),b(w,{modelValue:O.value,"onUpdate:modelValue":t[3]||(t[3]=e=>O.value=e),label:"Premiu",type:"text"},null,8,["modelValue"]),b(w,{modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=e=>H.value=e),label:"Câte buys per joc",type:"text"},null,8,["modelValue"]),a("div",Me,[a("label",Re,[ae(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":t[5]||(t[5]=e=>N.value=e),class:"sr-only peer"},null,512),[[le,N.value]]),t[14]||(t[14]=a("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1))]),C(" "+i(N.value?"Random":"În funcție de lista"),1)])]),a("div",Oe,[a("div",He,[a("h3",De,[t[15]||(t[15]=C(" Participanți ")),a("div",Je,[a("button",{onClick:t[6]||(t[6]=e=>M(4)),class:"btn-primary"},"4"),a("button",{onClick:t[7]||(t[7]=e=>M(8)),class:"btn-primary"},"8"),a("button",{onClick:t[8]||(t[8]=e=>M(16)),class:"btn-primary"},"16"),a("button",{onClick:t[9]||(t[9]=e=>M(4)),class:"btn-danger"},"RESET")])]),b(we,{name:"fade"},{default:A(()=>[(s(!0),o(z,null,$(x.value,(e,p)=>(s(),o("div",{key:p,class:"relative overflow-hidden flex items-center gap-4 bg-gray-800 p-4 rounded-md shadow transition-all duration-300",style:se(e.game_id?{"--bg-image":"url("+T(e.game_id)+")"}:{})},[e.game_id?(s(),o("div",Ke)):c("",!0),a("div",We,[e.game_id?(s(),o("img",{key:0,src:T(e.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-md"},null,8,Ze)):c("",!0),b(q(oe),{options:Y.value,label:"name",reduce:r=>r.id,modelValue:e.game_id,"onUpdate:modelValue":r=>e.game_id=r,placeholder:"Alege Joc",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),b(w,{modelValue:e.for_user,"onUpdate:modelValue":r=>e.for_user=r,label:"Cine a ales? (opțional)"},null,8,["modelValue","onUpdate:modelValue"])])],4))),128))]),_:1})]),b(Be,{onWinnersPicked:fe,fillCount:x.value.length},null,8,["fillCount"])]),a("button",{disabled:I.value,class:v([{"opacity-50 cursor-not-allowed":I.value},"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300"]),type:"button",onClick:me}," Start ",10,qe)])])):c("",!0),f.value&&!m.value?(s(),o("div",Qe,[a("div",Xe,[a("div",Ye,[f.value.game.image?(s(),o("img",{key:0,src:T(f.value.game.id),alt:"Game Thumbnail",class:"w-32 mx-auto object-cover rounded-md mb-4"},null,8,Ie)):c("",!0),a("h2",et," Câștigător! - "+i(f.value.game.name),1),a("p",tt," User: "+i(f.value.for_user),1)])])])):c("",!0),b(Se,{show:q(J),onClose:W},{title:A(()=>t[16]||(t[16]=[C(" Ești sigur că vrei să închizi forțat acest Bonus Battle? ")])),content:A(()=>t[17]||(t[17]=[C(" Vom închide forțat acest Bonus Battle și nu vei mai putea reveni la el. Ești sigur că vrei să continui? ")])),footer:A(()=>[a("button",{onClick:W,class:"btn-danger"}," ANULEAZĂ "),a("button",{class:"ml-3 btn-primary",onClick:pe}," ÎNCHIDE FORȚAT ACEST BONUS BATTLE ")]),_:1},8,["show"]),m.value?(s(),o("div",at,[V.value?(s(),o("div",lt," Predicțiile sunt pornite ")):c("",!0),a("div",st,[a("div",ot,[a("h2",it,"Active Battle: "+i(m.value.title),1),a("p",rt," Miza: "+i(m.value.stake)+" | Etapa: "+i(G.value.name)+" | Premiu: "+i(m.value.prize)+" | Buys: "+i(m.value.buys),1)]),y.value.length>1?(s(),o("div",nt,[(s(!0),o(z,null,$(y.value,(e,p)=>(s(),o("div",{key:p,class:v(["relative border rounded-md p-4 shadow transition-all duration-300 game-active-row",e.game.image?"bg-transparent":"bg-gray-900"]),style:se(e.game.image?{"--bg-image":"url("+T(e.game.id)+")"}:{})},[e.game.image?(s(),o("div",dt)):c("",!0),a("div",{class:v(["relative z-10 p-4 rounded-lg",e.game.image?"bg-black bg-opacity-60":"bg-gray-900"])},[a("div",ut,[e.game.image?(s(),o("img",{key:0,src:T(e.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-md"},null,8,ct)):c("",!0),a("div",mt,[a("h3",bt,i(e.game.name)+" - "+i(e.for_user),1),a("div",pt,[b(q(oe),{disabled:!j.value,options:Y.value,label:"name",reduce:r=>r.id,"onUpdate:modelValue":r=>ve(e.id,r),placeholder:"Schimbi jocul?",class:"flex-1 transition-all duration-300","append-to-body":""},null,8,["disabled","options","reduce","onUpdate:modelValue"]),a("button",{class:"btn-secondary transition-all duration-300",onClick:t[10]||(t[10]=r=>j.value=!j.value)}," SCHIMBA JOCU ")])])]),a("div",null,[(s(!0),o(z,null,$(e.scores,(r,u)=>(s(),o("div",{key:u,class:"flex items-center space-x-2 mt-1 transition-all duration-300"},[b(w,{modelValue:e.scores[u].cost_buy,"onUpdate:modelValue":g=>e.scores[u].cost_buy=g,label:"Cost Buy",type:"number",disabled:d.value,onInput:g=>te(p,u)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),b(w,{modelValue:e.scores[u].result_buy,"onUpdate:modelValue":g=>e.scores[u].result_buy=g,label:"Rezultat",type:"number",disabled:r.cost_buy<=0||d.value,onInput:g=>te(p,u)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),b(w,{modelValue:e.scores[u].score,"onUpdate:modelValue":g=>e.scores[u].score=g,label:"Scor",type:"number",disabled:!0},null,8,["modelValue","onUpdate:modelValue"]),a("button",{type:"button",onClick:g=>de(p,u),class:v(["btn-danger transition-all duration-300 align-middle",{"opacity-0":u===0}]),disabled:u===0},t[18]||(t[18]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),10,gt)]))),128)),a("button",{type:"button",onClick:t[11]||(t[11]=r=>ee()),disabled:d.value,class:v([{"input-disabled":d.value},"btn-primary mt-2"])}," Adaugă Buy ",10,vt)]),a("p",ft," Scor Total: "+i(ue(e.scores)),1)],2)],6))),128))])):c("",!0),f.value?(s(),o("div",yt,[a("p",_t,"Câștigător: "+i(f.value.game.name)+" | User: "+i(f.value.for_user),1)])):c("",!0),a("div",ht,[G.value.name!=="Final"?(s(),o("button",{key:0,type:"button",onClick:ge,class:v(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!L.value||d.value}]),disabled:!L.value||d.value}," Următoarii Concurenți ",10,xt)):c("",!0),G.value.name==="Final"?(s(),o("button",{key:1,type:"button",onClick:be,class:v(["bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-all duration-300",{"input-disabled opacity-50":!L.value}]),disabled:!L.value}," Termina Battle ",10,wt)):c("",!0)])]),a("div",kt,[U.value.stage_brackets.length>0?(s(),o("table",Vt,[a("tbody",null,[(s(!0),o(z,null,$(U.value.stage_brackets,(e,p)=>(s(),o("tr",{key:e.id,class:v(p%2===0?"bg-gray-900":"bg-gray-800")},[a("td",Ct,[a("span",{class:v({"line-through text-gray-500":e.winner!==e.participant_a})},i(e.participant_a),3),t[19]||(t[19]=C(" vs ")),a("span",{class:v({"line-through text-gray-500":e.winner!==e.participant_b})},i(e.participant_b),3)]),a("td",Bt,i(parseFloat(e.participant_a_score).toFixed(3))+" - "+i(parseFloat(e.participant_b_score).toFixed(3)),1)],2))),128))])])):c("",!0),U.value.concurrents.length>0?(s(),o("table",St,[a("tbody",null,[(s(!0),o(z,null,$(U.value.concurrents,(e,p)=>(s(),o("tr",{key:e==null?void 0:e.id,class:v(p%2===0?"bg-gray-900":"bg-gray-800")},[a("td",Ut,i(e!=null&&e.is_eliminated?"❌":"✅"),1),a("td",Tt,i((e==null?void 0:e.game.name)||"N/A"),1),a("td",Ft,i((e==null?void 0:e.for_user)||"N/A"),1)],2))),128))])])):c("",!0)])])):c("",!0)])])]),_:1}))}};export{Ht as default};
