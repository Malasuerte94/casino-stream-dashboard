import{d as u,l as E,q as se,c as ae,w as le,f as n,o as l,a as s,e as o,k as y,E as v,g as B,F as C,h as S,b as H,u as O,n as _,t as r}from"./app-9d2dcac1.js";import{_ as oe}from"./AppLayout-c3985eaf.js";import{u as de,C as X}from"./gameStore-5b205f7a.js";import"./ResponsiveNavLink-6aeb9ac1.js";import"./_plugin-vue_export-helper-c27b6911.js";const re={class:"py-2"},ie={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ue={key:0,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},ne={class:"p-6 space-y-4"},ce={class:"flex flex-row gap-2"},me={class:"bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-4"},be={class:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex gap-2 items-center"},pe={class:"flex gap-4"},ge=["src"],ye=["onUpdate:modelValue"],ve=["disabled"],_e={key:1,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},he={class:"p-6 flex justify-center items-center bg-gray-100 dark:bg-gray-800"},fe={class:"w-full max-w-md bg-white dark:bg-gray-700 shadow-lg rounded-lg p-6 text-center"},xe=["src"],we={class:"text-2xl font-bold text-gray-800 dark:text-white mb-2"},ke={class:"text-lg font-medium text-gray-600 dark:text-gray-300"},Be={key:2,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg mt-6"},Ce={class:"p-6"},Se={class:"text-xl font-bold mb-4"},Ve={key:0,class:"grid grid-cols-2 gap-4 mt-4"},Ue={class:"flex gap-2 items-center mb-2 bg-blend-darken p-2 rounded border-blue-900 border"},Fe=["src"],Ae={class:"w-full"},Ge={class:"text-lg font-bold mb-2"},Te={class:"flex flex-row"},$e={class:"text-sm font-medium text-gray-700"},Ne=["onUpdate:modelValue"],ze={class:"text-sm font-medium text-gray-700"},Pe=["disabled","onUpdate:modelValue","onInput"],je={class:"text-sm font-medium text-gray-700"},Ee=["onUpdate:modelValue"],Me=["onClick"],Re={class:"mt-4 text-lg font-bold"},De={key:1},Je={class:"mt-4 text-lg font-bold"},Le=["disabled"],qe=["disabled"],He={class:"p-6"},Oe={key:0,class:"table-auto w-full text-sm text-gray-200 mb-2"},Xe={class:"px-4 py-2 font-bold"},Ke={class:"px-4 py-2"},Qe={key:1,class:"table-auto w-full text-sm text-gray-200"},We={class:"border border-black px-1 py-1 shrink w-0"},Ye={class:"border border-black px-2 py-1"},Ze={class:"border border-black px-2 py-1"},ot={__name:"BonusBattle",setup(Ie){const M=u(!0),x=u(""),G=u("5-10"),T=u(""),$=u("2"),f=u([{game_id:null,for_user:null},{game_id:null,for_user:null}]),m=u(null),N=u(null),V=u(null),U=u(null),w=u([{}]),R=u(null),k=u([]),F=u(!1),b=u(null),p=u([]),D=de(),J=E(()=>D.availableGames);se(async()=>{await h()});const L=E(()=>f.value.length<2?!0:f.value.some(a=>!a.game_id)),A=E(()=>w.value?w.value.length<2?!1:w.value.every(a=>a.cost_buy>0):!1),z=a=>{f.value=Array.from({length:a},()=>({game_id:"",for_user:""}))},q=async()=>{p.value.forEach(a=>{const e=(a==null?void 0:a.scores.length)>0?a.scores[a.scores.length-1].cost_buy:0;a==null||a.scores.push({bracket_id:U.value.id,bonus_concurrent_id:a.id,cost_buy:e,score:0,result_buy:0})}),await P(),await h()},K=async(a,e)=>{await Y(p.value[a].scores[e].id),p.value[a].scores.splice(e,1),await h()},Q=async(a,e)=>{const t=p.value[a].scores[e];t.cost_buy>0?(t.score=parseFloat((t.result_buy/t.cost_buy).toFixed(3)),await P()):alert("Amount must be greater than 0.")},W=a=>a.reduce((e,t)=>e+t.score,0).toFixed(3),Y=async a=>{var e;try{const t=await axios.delete(`/api/bonus-battles/delete-score/${a}`);console.log("Bonus score deleted successfully:",t.data),await P()}catch(t){console.error("Failed to delete bonus score:",((e=t.response)==null?void 0:e.data)||t.message)}},P=async()=>{var a;try{const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:U.value.id,bracket:p.value});console.log("Bonus battle stored successfully:",e.data)}catch(e){console.error("Failed to store bonus score:",((a=e.response)==null?void 0:a.data)||e.message)}},Z=async()=>{var a;if(!x.value||f.value.some(e=>!e.game_id)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:x.value,stake:G.value,prize:T.value,buys:$.value,concurrents:f.value});console.log("Bonus battle stored successfully:",e.data),await h()}catch(e){console.error("Failed to store bonus battle:",((a=e.response)==null?void 0:a.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},I=async()=>{var a;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:m.value.id});b.value=e.data.winner,await h()}catch(e){console.log("endBattle error:",((a=e.response)==null?void 0:a.data)||e.message)}},ee=async()=>{var a;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:U.value.id}),await h()}catch(e){console.error("Failed to finish round:",((a=e.response)==null?void 0:a.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}},te=async(a,e)=>{try{await axios.put("/api/bonus-battles/edit-concurrent",{id:a,game_id:e}),await h(),F.value=!1}catch{alert("Please try again.")}},h=async()=>{var a;try{const e=await axios.get("/api/bonus-battles/active");if(R.value=e.data.total_battles,m.value=e.data.battle,N.value=e.data.concurrents,V.value=e.data.stage,U.value=e.data.bracket,w.value=e.data.scores,k.value=e.data.history,x.value="Bonus Battle #"+(R.value+1),N.value){const i=N.value;p.value=i.slice(0,2).map(d=>{const c=w.value.filter(g=>g.bonus_concurrent_id===d.id);return{...d,scores:c.length?c:[]}})}if(p.value.some(i=>i.scores.length===0)){const i=((a=m.value)==null?void 0:a.buys)||0;if(i>0)for(let d=0;d<i;d++)await q()}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}finally{M.value=!1}},j=a=>{const e=D.availableGames.find(t=>t.id===a);return e?`/storage/games/${e.image}`:""};return(a,e)=>M.value?n("",!0):(l(),ae(oe,{key:0,title:"Bonus Battle"},{default:le(()=>[s("div",re,[s("div",ie,[!m.value&&!b.value?(l(),o("div",ue,[s("div",ne,[s("div",ce,[s("div",null,[e[9]||(e[9]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Titlu Bonus Battle",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),id:"title",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[v,x.value]])]),s("div",null,[e[10]||(e[10]=s("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=t=>G.value=t),id:"stake",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[v,G.value]])]),s("div",null,[e[11]||(e[11]=s("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Premiu",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),id:"prize",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[v,T.value]])]),s("div",null,[e[12]||(e[12]=s("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Câte buys per joc (poți face ulterior câte vrei)",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>$.value=t),id:"buys",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[v,$.value]])])]),s("div",me,[s("h3",be,[e[13]||(e[13]=B("Participanți ")),s("div",pe,[s("button",{onClick:e[4]||(e[4]=t=>z(4)),class:"btn-primary"},"4"),s("button",{onClick:e[5]||(e[5]=t=>z(8)),class:"btn-primary"},"8"),s("button",{onClick:e[6]||(e[6]=t=>z(16)),class:"btn-primary"},"16")])]),(l(!0),o(C,null,S(f.value,(t,i)=>(l(),o("div",{key:i,class:"flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow"},[t.game_id?(l(),o("img",{key:0,src:j(t.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-lg"},null,8,ge)):n("",!0),H(O(X),{options:J.value,label:"name",reduce:d=>d.id,modelValue:t.game_id,"onUpdate:modelValue":d=>t.game_id=d,placeholder:"Alege Joc",class:"flex-1 input-select"},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),y(s("input",{type:"text","onUpdate:modelValue":d=>t.for_user=d,class:"flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 p-2.5",placeholder:"Cine a ales? (opțional)"},null,8,ye),[[v,t.for_user]])]))),128))]),s("button",{disabled:L.value,class:_([{"input-disabled opacity-50":L.value},"mt-4 bg-green-600 text-white px-4 py-2 rounded-md"]),type:"button",onClick:Z},"Start",10,ve)])])):n("",!0),b.value&&!m.value?(l(),o("div",_e,[s("div",he,[s("div",fe,[b.value.game.image?(l(),o("img",{key:0,src:j(b.value.game.id),alt:"Game Thumbnail",class:"w-32 auto mx-auto object-cover rounded-lg mb-4"},null,8,xe)):n("",!0),s("h2",we," Câștigător! - "+r(b.value.game.name),1),s("p",ke," User: "+r(b.value.for_user),1)])])])):n("",!0),m.value?(l(),o("div",Be,[s("div",Ce,[s("h2",Se,"Active Battle: "+r(m.value.title),1),s("p",null,"Miza: "+r(m.value.stake)+" | Etapa: "+r(V.value.name)+" | Premiu: "+r(m.value.prize)+" | Buys: "+r(m.value.buys),1),p.value.length>1?(l(),o("div",Ve,[(l(!0),o(C,null,S(p.value,(t,i)=>(l(),o("div",{key:i,class:"border rounded-md p-4 shadow"},[s("div",Ue,[t.game.image?(l(),o("img",{key:0,src:j(t.game.id),alt:"Game Thumbnail",class:"w-auto h-[100px] rounded-lg"},null,8,Fe)):n("",!0),s("div",Ae,[s("h3",Ge,r(t.game.name)+" - "+r(t.for_user),1),s("div",Te,[H(O(X),{disabled:!F.value,options:J.value,label:"name",reduce:d=>d.id,"onUpdate:modelValue":d=>te(t.id,d),placeholder:"Schimbi jocul?",class:"flex-1"},null,8,["disabled","options","reduce","onUpdate:modelValue"]),s("div",null,[s("button",{class:"btn-secondary",onClick:e[7]||(e[7]=d=>F.value=!F.value)},"SCHIMBA JOCU")])])])]),s("div",null,[(l(!0),o(C,null,S(t.scores,(d,c)=>(l(),o("div",{key:c,class:"flex items-center space-x-2 mt-1"},[s("label",$e,[e[14]||(e[14]=B(" Cost Buy ")),y(s("input",{type:"number","onUpdate:modelValue":g=>t.scores[c].cost_buy=g,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Amount"},null,8,Ne),[[v,t.scores[c].cost_buy]])]),s("label",ze,[e[15]||(e[15]=B(" Rezultat Buy ")),y(s("input",{disabled:d.cost_buy<=0,class:_([{"input-disabled opacity-50":d.cost_buy<=0},"block w-40 border-gray-300 rounded-md shadow-sm"]),type:"number","onUpdate:modelValue":g=>t.scores[c].result_buy=g,placeholder:"Result",onInput:g=>Q(i,c)},null,42,Pe),[[v,t.scores[c].result_buy]])]),s("label",je,[e[16]||(e[16]=B(" Scor ")),y(s("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":g=>t.scores[c].score=g,class:"block w-20 border-gray-300 rounded-md shadow-sm disabled input-disabled",placeholder:"Result"},null,8,Ee),[[v,t.scores[c].score]])]),c>=1?(l(),o("button",{key:0,type:"button",onClick:g=>K(i,c),class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"}," X ",8,Me)):n("",!0)]))),128)),s("button",{type:"button",onClick:e[8]||(e[8]=d=>q()),class:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-md text-sm"}," Adaugă Buy ")]),s("p",Re," Scor Total: "+r(W(t.scores)),1)]))),128))])):n("",!0),b.value?(l(),o("div",De,[s("p",Je,"Câștigător: "+r(b.value.game.name)+" | User: "+r(b.value.for_user),1)])):n("",!0),V.value.name!=="Final"?(l(),o("button",{key:2,type:"button",onClick:ee,class:_(["mt-6 bg-green-600 text-white px-4 py-2 rounded-md",{"input-disabled opacity-50":!A.value}]),disabled:!A.value}," Următoarii Concurenți ",10,Le)):n("",!0),V.value.name==="Final"?(l(),o("button",{key:3,disabled:!A.value,class:_([{"input-disabled opacity-50":!A.value},"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"]),type:"button",onClick:I}," Termina Battle ",10,qe)):n("",!0)]),s("div",He,[k.value.stage_brackets.length>0?(l(),o("table",Oe,[s("tbody",null,[(l(!0),o(C,null,S(k.value.stage_brackets,(t,i)=>(l(),o("tr",{key:t.id,class:_(i%2===0?"bg-gray-900":"bg-gray-800")},[s("td",Xe,[s("span",{class:_({"line-through text-gray-500":t.winner!==t.participant_a})},r(t.participant_a),3),e[17]||(e[17]=B(" vs ")),s("span",{class:_({"line-through text-gray-500":t.winner!==t.participant_b})},r(t.participant_b),3)]),s("td",Ke,r(parseFloat(t.participant_a_score).toFixed(3))+" - "+r(parseFloat(t.participant_b_score).toFixed(3)),1)],2))),128))])])):n("",!0),k.value.concurrents.length>0?(l(),o("table",Qe,[s("tbody",null,[(l(!0),o(C,null,S(k.value.concurrents,(t,i)=>(l(),o("tr",{key:t==null?void 0:t.id,class:_(i%2===0?"bg-gray-900":"bg-gray-800")},[s("td",We,r(t!=null&&t.is_eliminated?"❌":"✅"),1),s("td",Ye,r((t==null?void 0:t.game.name)||"N/A"),1),s("td",Ze,r((t==null?void 0:t.for_user)||"N/A"),1)],2))),128))])])):n("",!0)])])):n("",!0)])])]),_:1}))}};export{ot as default};
