import{d as r,q as j,c as q,w as G,o,a,e as l,k as p,E as b,F as S,h as V,t as v,f as h,g as U}from"./app-8eb1a515.js";import{_ as J}from"./AppLayout-35c2fc63.js";import"./ResponsiveNavLink-281bcb72.js";import"./_plugin-vue_export-helper-c27b6911.js";const X={class:"py-2"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={key:0,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},K={class:"p-6 space-y-4"},O=a("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Titlu Bonus Battle",-1),Q=a("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1),W=a("label",{class:"block text-sm font-medium text-gray-700"},"Participanți",-1),Z={class:"border-solid border-black border-[1px] flex gap-2 px-2 py-2 rounded-md"},I=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],te={key:1,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},se={class:"p-6"},ae={class:"text-xl font-bold mb-4"},oe={key:2,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg mt-6"},le={class:"p-6"},ne={class:"text-xl font-bold mb-4"},re={key:0,class:"grid grid-cols-2 gap-4 mt-4"},de={class:"text-lg font-bold mb-2"},ue={class:"text-sm font-medium text-gray-700"},ce=["onUpdate:modelValue"],ie={class:"text-sm font-medium text-gray-700"},me=["onUpdate:modelValue","onInput"],pe={class:"text-sm font-medium text-gray-700"},be=["onUpdate:modelValue"],ve=["onClick"],he={class:"mt-4 text-lg font-bold"},ye={key:1},_e={class:"mt-4 text-lg font-bold"},Be={__name:"BonusBattle",setup(ge){const g=r(""),k=r("5-10"),c=r([]),y=r(null),B=r(null),f=r(null),w=r(null),F=r(null),A=r(null),_=r(null),u=r([]),E=()=>{const t=n=>Array.from({length:n},()=>Math.random().toString(36).charAt(2)).join(""),e=c.value.length,s=e===0?2:e*2;for(let n=0;n<s-e;n++)c.value.push({name:t(10),for_user:t(6)})},T=()=>{const t=c.value.length;if(t<=2){alert("You must have at least 2 participants.");return}const e=t/2;c.value.splice(e)},P=async()=>{u.value.forEach(t=>{t==null||t.scores.push({bracket_id:w.value.id,bonus_concurrent_id:t.id,cost_buy:0,score:0,result_buy:0})}),await C(),await x()},R=async(t,e)=>{await N(u.value[t].scores[e].id),u.value[t].scores.splice(e,1)},$=async(t,e)=>{const s=u.value[t].scores[e];s.cost_buy>0?(s.score=parseFloat((s.result_buy/s.cost_buy).toFixed(2)),await C()):alert("Amount must be greater than 0.")},M=t=>t.reduce((e,s)=>e+s.score,0).toFixed(2),N=async t=>{var e;try{const s=await axios.delete(`/api/bonus-battles/delete-score/${t}`);console.log("Bonus score deleted successfully:",s.data),await C()}catch(s){console.error("Failed to delete bonus score:",((e=s.response)==null?void 0:e.data)||s.message)}},C=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:w.value.id,bracket:u.value});console.log("Bonus battle stored successfully:",e.data)}catch(e){console.error("Failed to store bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}},z=async()=>{var t;if(!g.value||c.value.some(e=>!e.name)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:g.value,stake:k.value,concurrents:c.value});console.log("Bonus battle stored successfully:",e.data),await x()}catch(e){console.error("Failed to store bonus battle:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},D=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:y.value.id});_.value=e.data.winner,await x()}catch(e){console.log("endBattle error:",((t=e.response)==null?void 0:t.data)||e.message)}},L=async()=>{var t;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:w.value.id}),await x()}catch(e){console.error("Failed to finish round:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}},x=async()=>{try{const t=await axios.get("/api/bonus-battles/active");if(A.value=t.data.total_battles,y.value=t.data.battle,B.value=t.data.concurrents,f.value=t.data.stage,w.value=t.data.bracket,F.value=t.data.scores,g.value="Bonus Battle #"+(A.value+1),B.value){const e=B.value;u.value=e.slice(0,2).map(s=>{const n=F.value.filter(i=>i.bonus_concurrent_id===s.id);return{...s,scores:n.length?n:[]}})}}catch(t){console.error("Failed to fetch active bonus battle:",t.message)}};return j(()=>{x()}),(t,e)=>(o(),q(J,{title:"Bonus Battle"},{default:G(()=>[a("div",X,[a("div",Y,[!y.value&&!_.value?(o(),l("div",H,[a("div",K,[a("div",null,[O,p(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),id:"title",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[b,g.value]])]),a("div",null,[Q,p(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),id:"stake",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[b,k.value]])]),a("div",null,[W,(o(!0),l(S,null,V(c.value,(s,n)=>(o(),l("div",{key:n,class:"flex space-x-2 mt-1"},[a("div",Z,[p(a("input",{type:"text","onUpdate:modelValue":i=>s.name=i,class:"block w-full border-gray-300 rounded-md shadow-sm",placeholder:"Nume Joc"},null,8,I),[[b,s.name]]),p(a("input",{type:"text","onUpdate:modelValue":i=>s.for_user=i,class:"block w-full border-gray-300 rounded-md shadow-sm",placeholder:"Cine a ales (opțional)?"},null,8,ee),[[b,s.for_user]])])]))),128)),a("div",{class:"flex gap-2 mt-2"},[a("button",{type:"button",onClick:E,class:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm"},"Adaugă Participanți "),a("button",{type:"button",onClick:T,class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"},"ȘTERGE ")])]),a("button",{type:"button",onClick:z,class:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md"},"Start ")])])):_.value?(o(),l("div",te,[a("div",se,[a("h2",ae,"Câștigător! - "+v(_.value.name),1)])])):h("",!0),y.value?(o(),l("div",oe,[a("div",le,[a("h2",ne,"Active Battle: "+v(y.value.title),1),a("p",null,"Stake: "+v(y.value.stake)+" | Etapa: "+v(f.value.name),1),u.value.length>1?(o(),l("div",re,[(o(!0),l(S,null,V(u.value,(s,n)=>(o(),l("div",{key:n,class:"border rounded-md p-4 shadow"},[a("h3",de,v(s.name),1),a("div",null,[(o(!0),l(S,null,V(s.scores,(i,d)=>(o(),l("div",{key:d,class:"flex items-center space-x-2 mt-1"},[a("label",ue,[U(" Cost Buy "),p(a("input",{type:"number","onUpdate:modelValue":m=>s.scores[d].cost_buy=m,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Amount"},null,8,ce),[[b,s.scores[d].cost_buy]])]),a("label",ie,[U(" Rezultat Buy "),p(a("input",{type:"number","onUpdate:modelValue":m=>s.scores[d].result_buy=m,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Result",onInput:m=>$(n,d)},null,40,me),[[b,s.scores[d].result_buy]])]),a("label",pe,[U(" Scor "),p(a("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":m=>s.scores[d].score=m,class:"block w-20 border-gray-300 rounded-md shadow-sm disabled",placeholder:"Result"},null,8,be),[[b,s.scores[d].score]])]),d>=1?(o(),l("button",{key:0,type:"button",onClick:m=>R(n,d),class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"}," X ",8,ve)):h("",!0)]))),128)),a("button",{type:"button",onClick:e[2]||(e[2]=i=>P()),class:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-md text-sm"}," Adaugă Buy ")]),a("p",he," Scor Total: "+v(M(s.scores)),1)]))),128))])):h("",!0),_.value?(o(),l("div",ye,[a("p",_e,"Câștigător: "+v(_.value.name),1)])):h("",!0),f.value.name!=="Final"?(o(),l("button",{key:2,type:"button",onClick:L,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Următoarii Concurenți ")):h("",!0),f.value.name==="Final"?(o(),l("button",{key:3,type:"button",onClick:D,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Termina Battle ")):h("",!0)])])):h("",!0)])])]),_:1}))}};export{Be as default};
