import{C as w,u as f}from"./gameStore-499e401f.js";import{q as d,s as v,c as o,b as a,h as p,L as m,n as b,F as _,a as H,w as x,M as k,k as h,o as l,E as G,I as U,t as B}from"./app-6df4a8a7.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const L={components:{vSelect:w},data(){return{bonusHunt:{},bonusHuntGames:[],fieldUpdateTimeouts:{},debounceTimer:null,loading:!1}},computed:{gameOptions(){return f().availableGames},isEnded(){return Boolean(this.bonusHunt.ended)}},mounted(){this.getLatestList()},methods:{validateBonusHuntStart(){return!this.bonusHunt.start||this.bonusHunt.start<=0?(alert("Vă rugăm să introduceți costul listei (Costul Hunt-ului)."),!1):!0},debounceUpdateBonusHunt(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.updateBonusHunt()},1e3)},debounceFieldUpdate(e,t){(t==="stake"||t==="result")&&this.calcCurentRowMultiplier(e),this.fieldUpdateTimeouts[e.id]||(this.fieldUpdateTimeouts[e.id]={}),this.fieldUpdateTimeouts[e.id][t]&&clearTimeout(this.fieldUpdateTimeouts[e.id][t]),this.fieldUpdateTimeouts[e.id][t]=setTimeout(()=>{this.updateBonusHuntGame()},1e3)},getGameThumbnail(e){const t=this.gameOptions.find(r=>r.id===e);return t?`/storage/games/${t.image}`:""},async getLatestList(){try{const e=await d.get("/api/bonus-hunt");this.bonusHunt=e.data.bonusHunt,this.bonusHuntGames=e.data.bonusHuntGames}catch(e){console.error(e)}},async updateBonusHunt(){let e=this.bonusHunt;this.loading=!0,await d.patch("/api/bonus-hunt",{bonusHunt:e}).catch(t=>{console.log(t)}).finally(async()=>{await this.getLatestList(),this.$emit("update"),this.loading=!1})},async updateBonusHuntGame(){if(this.validateBonusHuntStart())try{this.loading=!0;let e=this.bonusHuntGames;await d.put("/api/bonus-hunt-games",{games:e})}catch(e){console.error(e)}finally{await this.getLatestList(),this.loading=!1}},async createNewBonusHuntGameRow(){if(this.validateBonusHuntStart())try{await d.post("/api/bonus-hunt-games",{bonusHuntId:this.bonusHunt.id}),await this.getLatestList()}catch(e){console.error(e)}},async removeBonusHuntGameRow(e){try{await d.delete(`/api/bonus-hunt-games/${e}`),await this.getLatestList()}catch(t){console.error(t)}},wantToReset(){this.validateBonusHuntStart()&&this.$dialog({message:"Ești sigur că vrei să faci o listă nouă?",buttons:["da","nu"],da:this.resetBonusHunt,nu:()=>console.log("Canceled reset")})},async resetBonusHunt(){try{await d.post("/api/close-bonus-list",{close:!0,list_id:this.bonusHunt.id,type:"hunt"}),await d.post("/api/bonus-hunt"),await this.getLatestList(),this.$emit("newlist")}catch(e){console.error(e)}},calcCurentRowMultiplier(e){const t=this.bonusHuntGames.findIndex(n=>n.id===e.id);if(t===-1){console.error("Game not found in bonusHuntGames.");return}const r=parseFloat(e.stake),c=parseFloat(e.result);if(!e.game_id||isNaN(r)||isNaN(c)||c<0){console.warn("Invalid game data: Missing or invalid stake or result.");return}const i=c===0?0:Math.round(c/r);this.bonusHuntGames[t]={...e,multiplier:i,result:c,stake:r}}}},V={class:"p-6 rounded-lg shadow-md bg-gray-100 dark:bg-gray-800"},E={class:"space-y-6 mb-6"},C={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},I=["disabled"],R=["disabled"],M={key:0,class:"absolute inset-0 pointer-events-none bg-blur"},N={class:"text-center text-gray-800 dark:text-gray-200 font-medium"},z=["src"],S={key:1},F=["disabled","onInput","onUpdate:modelValue"],A=["disabled","onInput","onUpdate:modelValue"],O=["onUpdate:modelValue"],j=["onClick"],D={key:0,class:"flex justify-center mt-8"},J={key:1};function q(e,t,r,c,i,n){const y=v("v-select");return l(),o("div",V,[a("div",E,[a("div",C,[p(a("input",{disabled:n.isEnded,class:b([{"input-disabled":n.isEnded},"input-primary"]),type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>i.bonusHunt.name=s),placeholder:"Nume Lista"},null,10,I),[[m,i.bonusHunt.name]]),p(a("input",{disabled:n.isEnded,class:b([{"input-disabled":n.isEnded},"input-primary"]),onInput:t[1]||(t[1]=(...s)=>n.debounceUpdateBonusHunt&&n.debounceUpdateBonusHunt(...s)),type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>i.bonusHunt.start=s),placeholder:"Cost (LEI)"},null,42,R),[[m,i.bonusHunt.start]]),p(a("input",{disabled:"",type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>i.bonusHunt.result=s),class:"input-disabled",placeholder:"Rezultat (LEI)"},null,512),[[m,i.bonusHunt.result]]),a("button",{onClick:t[4]||(t[4]=(...s)=>n.wantToReset&&n.wantToReset(...s)),class:"btn-primary w-full md:w-auto"}," LISTA NOUA ")])]),i.bonusHuntGames.length>0&&i.bonusHunt.start>0?(l(),o(_,{key:0},[t[7]||(t[7]=a("div",{class:"hidden md:grid grid-cols-[10px_50px_1fr_120px_120px_120px_50px] gap-4 text-sm font-semibold text-gray-600 dark:text-gray-300 mb-2"},[a("span",null,"#"),a("span"),a("span",null,"Joc"),a("span",null,"Miză"),a("span",null,"Rezultat (LEI)"),a("span",null,"Multiplicator"),a("span")],-1)),H(k,{name:"fade"},{default:x(()=>[(l(!0),o(_,null,G(i.bonusHuntGames,(s,g)=>(l(),o("div",{key:s.id||g,class:"relative mb-4 rounded-lg shadow overflow-hidden game-row",style:U(s.game_id?{"--bg-image":`url(${n.getGameThumbnail(s.game_id)})`}:{})},[s.game_id?(l(),o("div",M)):h("",!0),a("div",{class:b(["relative z-10 grid grid-cols-1 md:grid-cols-[10px_50px_1fr_120px_120px_120px_50px] gap-4 items-center p-2",s.game_id?"bg-transparent":"bg-white dark:bg-gray-700"])},[a("div",N,B(g+1),1),s.game_id?(l(),o("img",{key:0,src:n.getGameThumbnail(s.game_id),alt:"Game Thumbnail",class:"w-20 h-20 object-cover rounded-lg mb-2"},null,8,z)):(l(),o("span",S)),H(y,{disabled:n.isEnded||i.loading,options:n.gameOptions,label:"name",reduce:u=>u.id,"append-to-body":"","onUpdate:modelValue":[u=>n.debounceFieldUpdate(s,"game_id"),u=>s.game_id=u],modelValue:s.game_id},null,8,["disabled","options","reduce","onUpdate:modelValue","modelValue"]),p(a("input",{disabled:n.isEnded||i.loading,class:b([{"input-disabled":n.isEnded||i.loading},"input-primary text-center"]),onInput:u=>n.debounceFieldUpdate(s,"stake"),"onUpdate:modelValue":u=>s.stake=u,min:"1",type:"number",placeholder:"Miză"},null,42,F),[[m,s.stake]]),p(a("input",{disabled:n.isEnded||i.loading,class:b([{"input-disabled":n.isEnded||i.loading},"input-primary text-center"]),onInput:u=>n.debounceFieldUpdate(s,"result"),"onUpdate:modelValue":u=>s.result=u,type:"number",step:"0.1",placeholder:"Rezultat (LEI)"},null,42,A),[[m,s.result]]),p(a("input",{disabled:"","onUpdate:modelValue":u=>s.multiplier=u,type:"number",class:"input-disabled text-center",placeholder:"Multiplicator"},null,8,O),[[m,s.multiplier]]),n.isEnded?h("",!0):(l(),o("button",{key:2,onClick:u=>n.removeBonusHuntGameRow(s.id),class:"btn-danger"},t[6]||(t[6]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,j))],2)],4))),128))]),_:1}),n.isEnded?h("",!0):(l(),o("div",D,[a("button",{onClick:t[5]||(t[5]=(...s)=>n.createNewBonusHuntGameRow&&n.createNewBonusHuntGameRow(...s)),class:"btn-primary w-full max-w-md"}," + Adaugă Joc ")]))],64)):(l(),o("div",J," Introdu costul listei pentru a adăuga jocuri. "))])}const W=T(L,[["render",q]]);export{W as default};
