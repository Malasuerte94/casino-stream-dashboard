import{d as n,q,c as G,w as J,o,a,e as l,k as p,E as b,F as V,h as S,t as v,f as y,g as U}from"./app-4937bbbf.js";import{_ as X}from"./AppLayout-2a47ff16.js";import"./ResponsiveNavLink-cd6a726e.js";import"./_plugin-vue_export-helper-c27b6911.js";const Y={class:"py-2"},j={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},H={key:0,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},K={class:"p-6 space-y-4"},O=a("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Titlu Bonus Battle",-1),Q=a("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1),W=a("label",{class:"block text-sm font-medium text-gray-700"},"Participanți",-1),Z={class:"border-solid border-black border-[1px] flex gap-2 px-2 py-2 rounded-md"},I=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],te={key:1,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},se={class:"p-6"},ae={class:"text-xl font-bold mb-4"},oe={key:2,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg mt-6"},le={class:"p-6"},ne={class:"text-xl font-bold mb-4"},re={key:0,class:"grid grid-cols-2 gap-4 mt-4"},de={class:"text-lg font-bold mb-2"},ue={class:"text-sm font-medium text-gray-700"},ce=["onUpdate:modelValue"],ie={class:"text-sm font-medium text-gray-700"},me=["onUpdate:modelValue","onInput"],pe={class:"text-sm font-medium text-gray-700"},be=["onUpdate:modelValue"],ve=["onClick"],ye={class:"mt-4 text-lg font-bold"},_e={key:1},he={class:"mt-4 text-lg font-bold"},Be={__name:"BonusBattle",setup(ge){const g=n(""),k=n("5-10"),c=n([]),_=n(null),B=n(null),f=n(null),w=n(null),F=n(null),A=n(null),h=n(null),d=n([]),E=()=>{const e=c.value.length,t=e===0?2:e*2;for(let s=0;s<t-e;s++)c.value.push({name:"",for_user:""})},T=()=>{const e=c.value.length;if(e<=2){alert("You must have at least 2 participants.");return}const t=e/2;c.value.splice(t)},P=async()=>{d.value.forEach(e=>{e==null||e.scores.push({bracket_id:w.value.id,bonus_concurrent_id:e.id,cost_buy:0,score:0,result_buy:0})}),await C(),await x()},R=async(e,t)=>{await M(d.value[e].scores[t].id),d.value[e].scores.splice(t,1)},$=async(e,t)=>{const s=d.value[e].scores[t];s.cost_buy>0?(s.score=parseFloat((s.result_buy/s.cost_buy).toFixed(2)),await C()):alert("Amount must be greater than 0.")},N=e=>e.reduce((t,s)=>t+s.score,0).toFixed(2),M=async e=>{var t;try{const s=await axios.delete(`/api/bonus-battles/delete-score/${e}`);console.log("Bonus score deleted successfully:",s.data),await C()}catch(s){console.error("Failed to delete bonus score:",((t=s.response)==null?void 0:t.data)||s.message)}},C=async()=>{var e;try{const t=await axios.post("/api/bonus-battles/add-score",{active_bracket:w.value.id,bracket:d.value});console.log("Bonus battle stored successfully:",t.data)}catch(t){console.error("Failed to store bonus score:",((e=t.response)==null?void 0:e.data)||t.message)}},z=async()=>{var e;if(!g.value||c.value.some(t=>!t.name)){alert("All fields must be filled to start.");return}try{const t=await axios.post("/api/bonus-battles",{title:g.value,stake:k.value,concurrents:c.value});console.log("Bonus battle stored successfully:",t.data),await x()}catch(t){console.error("Failed to store bonus battle:",((e=t.response)==null?void 0:e.data)||t.message),alert("An error occurred while saving the bonus battle. Please try again.")}},D=async()=>{var e;try{const t=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:_.value.id});h.value=t.data.winner,await x()}catch(t){console.log("endBattle error:",((e=t.response)==null?void 0:e.data)||t.message)}},L=async()=>{var e;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:w.value.id}),await x()}catch(t){console.error("Failed to finish round:",((e=t.response)==null?void 0:e.data)||t.message),alert("An error occurred while finishing the round. Please try again.")}},x=async()=>{try{const e=await axios.get("/api/bonus-battles/active");if(A.value=e.data.total_battles,_.value=e.data.battle,B.value=e.data.concurrents,f.value=e.data.stage,w.value=e.data.bracket,F.value=e.data.scores,g.value="Bonus Battle #"+(A.value+1),B.value){const t=B.value;d.value=t.slice(0,2).map(s=>{const u=F.value.filter(i=>i.bonus_concurrent_id===s.id);return{...s,scores:u.length?u:[]}})}}catch(e){console.error("Failed to fetch active bonus battle:",e.message)}};return q(()=>{x()}),(e,t)=>(o(),G(X,{title:"Bonus Battle"},{default:J(()=>[a("div",Y,[a("div",j,[!_.value&&!h.value?(o(),l("div",H,[a("div",K,[a("div",null,[O,p(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),id:"title",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[b,g.value]])]),a("div",null,[Q,p(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),id:"stake",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[b,k.value]])]),a("div",null,[W,(o(!0),l(V,null,S(c.value,(s,u)=>(o(),l("div",{key:u,class:"flex space-x-2 mt-1"},[a("div",Z,[p(a("input",{type:"text","onUpdate:modelValue":i=>s.name=i,class:"block w-full border-gray-300 rounded-md shadow-sm",placeholder:"Nume Joc"},null,8,I),[[b,s.name]]),p(a("input",{type:"text","onUpdate:modelValue":i=>s.for_user=i,class:"block w-full border-gray-300 rounded-md shadow-sm",placeholder:"Cine a ales (opțional)?"},null,8,ee),[[b,s.for_user]])])]))),128)),a("div",{class:"flex gap-2 mt-2"},[a("button",{type:"button",onClick:E,class:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm"},"Adaugă Participanți "),a("button",{type:"button",onClick:T,class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"},"ȘTERGE ")])]),a("button",{type:"button",onClick:z,class:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md"},"Start ")])])):h.value?(o(),l("div",te,[a("div",se,[a("h2",ae,"Câștigător! - "+v(h.value.name),1)])])):y("",!0),_.value?(o(),l("div",oe,[a("div",le,[a("h2",ne,"Active Battle: "+v(_.value.title),1),a("p",null,"Stake: "+v(_.value.stake)+" | Etapa: "+v(f.value.name),1),d.value.length>1?(o(),l("div",re,[(o(!0),l(V,null,S(d.value,(s,u)=>(o(),l("div",{key:u,class:"border rounded-md p-4 shadow"},[a("h3",de,v(s.name),1),a("div",null,[(o(!0),l(V,null,S(s.scores,(i,r)=>(o(),l("div",{key:r,class:"flex items-center space-x-2 mt-1"},[a("label",ue,[U(" Cost Buy "),p(a("input",{type:"number","onUpdate:modelValue":m=>s.scores[r].cost_buy=m,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Amount"},null,8,ce),[[b,s.scores[r].cost_buy]])]),a("label",ie,[U(" Rezultat Buy "),p(a("input",{type:"number","onUpdate:modelValue":m=>s.scores[r].result_buy=m,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Result",onInput:m=>$(u,r)},null,40,me),[[b,s.scores[r].result_buy]])]),a("label",pe,[U(" Scor "),p(a("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":m=>s.scores[r].score=m,class:"block w-20 border-gray-300 rounded-md shadow-sm disabled",placeholder:"Result"},null,8,be),[[b,s.scores[r].score]])]),r>=1?(o(),l("button",{key:0,type:"button",onClick:m=>R(u,r),class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"}," X ",8,ve)):y("",!0)]))),128)),a("button",{type:"button",onClick:t[2]||(t[2]=i=>P()),class:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-md text-sm"}," Adaugă Buy ")]),a("p",ye," Scor Total: "+v(N(s.scores)),1)]))),128))])):y("",!0),h.value?(o(),l("div",_e,[a("p",he,"Câștigător: "+v(h.value.name),1)])):y("",!0),f.value.name!=="Final"?(o(),l("button",{key:2,type:"button",onClick:L,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Următoarii Concurenți ")):y("",!0),f.value.name==="Final"?(o(),l("button",{key:3,type:"button",onClick:D,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Termina Battle ")):y("",!0)])])):y("",!0)])])]),_:1}))}};export{Be as default};
