import{C as w,u as v}from"./gameStore-fb874ead.js";import{p as o,q as f,c as u,b as n,h as r,L as p,n as c,F as h,a as B,w as x,M as U,k as m,o as d,E as L,I as T,t as G}from"./app-6439c665.js";import{_ as E}from"./_plugin-vue_export-helper-c27b6911.js";const V={components:{vSelect:w},data(){return{bonusBuy:{},bonusBuyGames:[],fieldUpdateTimeouts:{},debounceTimer:null,loading:!1}},computed:{gameOptions(){return v().availableGames},isEnded(){return Boolean(this.bonusBuy.ended)}},mounted(){this.getLatestList()},methods:{debounceUpdateBonusBuy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.updateBonusBuy(),1e3)},debounceFieldUpdate(t,s){(s==="result"||s==="price")&&this.calcCurentRowMultiplier(t),this.fieldUpdateTimeouts[t.id]||(this.fieldUpdateTimeouts[t.id]={}),this.fieldUpdateTimeouts[t.id][s]&&clearTimeout(this.fieldUpdateTimeouts[t.id][s]),this.fieldUpdateTimeouts[t.id][s]=setTimeout(()=>{this.updateBonusBuyGames()},1e3)},getGameThumbnail(t){const s=this.gameOptions.find(b=>b.id===t);return s?`/storage/games/${s.image}`:""},async getLatestList(){try{const t=await o.get("/api/bonus-buy");this.bonusBuy=t.data.bonusBuy,this.bonusBuyGames=t.data.bonusBuyGames}catch(t){console.error(t)}},async updateBonusBuy(){try{await o.patch("/api/bonus-buy",{bonusBuy:this.bonusBuy}),await this.getLatestList()}catch(t){console.error(t)}},async updateBonusBuyGames(){try{this.loading=!0,await o.put("/api/bonus-buy-games",{games:this.bonusBuyGames})}catch(t){console.error(t)}finally{await this.getLatestList(),this.loading=!1}},async createNewBonusBuyGameRow(){try{await o.post("/api/bonus-buy-games",{bonusBuyId:this.bonusBuy.id}),await this.getLatestList()}catch(t){console.error(t)}},async removeBonusBuyGameRow(t){try{await o.delete(`/api/bonus-buy-games/${t}`),await this.getLatestList()}catch(s){console.error(s)}},wantToReset(){this.$dialog({message:"Ești sigur că vrei să faci o listă nouă?",buttons:["da","nu"],da:this.resetBonusBuy,nu:()=>console.log("Canceled reset")})},async resetBonusBuy(){try{await o.post("/api/close-bonus-list",{close:!0,list_id:this.bonusBuy.id,type:"buy"}),await o.post("/api/bonus-buy"),await this.getLatestList(),this.$emit("newlist")}catch(t){console.error(t)}},calcCurentRowMultiplier(t){if(!t.price||!t.result||t.result<0)return;const s=Math.round(t.result/t.price*100)/100;t.multiplier=s}}},k={class:"p-6 rounded-lg shadow-lg bg-gray-800"},I={class:"space-y-6 mb-6"},C={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},R=["disabled"],z={class:"text-center text-gray-200 font-medium"},M=["src"],N={key:1},F=["disabled","onUpdate:modelValue","onInput"],S=["disabled","onUpdate:modelValue","onInput"],O=["disabled","onUpdate:modelValue","onInput"],A=["onUpdate:modelValue"],j=["onClick"],D={key:1,class:"flex justify-center mt-8"};function H(t,s,g,b,l,a){const _=f("v-select");return d(),u("div",k,[n("div",I,[n("div",C,[r(n("input",{disabled:a.isEnded,class:c([{"input-disabled":a.isEnded},"input-primary"]),type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>l.bonusBuy.name=e),onInput:s[1]||(s[1]=(...e)=>a.debounceUpdateBonusBuy&&a.debounceUpdateBonusBuy(...e)),placeholder:"Nume Lista"},null,42,R),[[p,l.bonusBuy.name]]),r(n("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=e=>l.bonusBuy.start=e),disabled:"",readonly:"",class:"input-disabled",placeholder:"Cost (LEI)"},null,512),[[p,l.bonusBuy.start]]),r(n("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=e=>l.bonusBuy.result=e),disabled:"",readonly:"",class:"input-disabled",placeholder:"Rezultat (LEI)"},null,512),[[p,l.bonusBuy.result]]),n("button",{onClick:s[4]||(s[4]=(...e)=>a.wantToReset&&a.wantToReset(...e)),class:"btn-primary w-full md:w-auto"}," LISTA NOUA ")])]),l.bonusBuyGames.length>0?(d(),u(h,{key:0},[s[7]||(s[7]=n("div",{class:"hidden md:grid grid-cols-[10px_50px_1fr_120px_120px_120px_120px_50px] gap-4 text-sm font-semibold text-gray-300 mb-2"},[n("span",null,"#"),n("span"),n("span",null,"Joc"),n("span",null,"Miză"),n("span",null,"Preț (LEI)"),n("span",null,"Rezultat (LEI)"),n("span",null,"Multiplicator"),n("span")],-1)),B(U,{name:"fade"},{default:x(()=>[(d(!0),u(h,null,L(l.bonusBuyGames,(e,y)=>(d(),u("div",{key:e.id||y,class:c(["relative overflow-hidden rounded-lg shadow mb-4 game-row",{"bg-gray-700":!e.game_id}])},[e.game_id?(d(),u("div",{key:0,class:"bg-blur",style:T({backgroundImage:"url("+a.getGameThumbnail(e.game_id)+")"})},null,4)):m("",!0),n("div",{class:c(["relative z-10 grid grid-cols-1 md:grid-cols-[10px_50px_1fr_120px_120px_120px_120px_50px] gap-4 items-center p-4",e.game_id?"bg-transparent":"bg-white dark:bg-gray-700"])},[n("div",z,G(y+1),1),e.game_id?(d(),u("img",{key:0,src:a.getGameThumbnail(e.game_id),alt:"Game Thumbnail",class:"w-20 h-20 object-cover rounded-lg"},null,8,M)):(d(),u("span",N)),B(_,{disabled:a.isEnded||l.loading,options:a.gameOptions,label:"name",reduce:i=>i.id,"append-to-body":"","onUpdate:modelValue":[i=>a.debounceFieldUpdate(e,"game_id"),i=>e.game_id=i],modelValue:e.game_id},null,8,["disabled","options","reduce","onUpdate:modelValue","modelValue"]),r(n("input",{disabled:a.isEnded||l.loading,class:c([{"input-disabled":a.isEnded||l.loading},"input-primary text-center"]),type:"number","onUpdate:modelValue":i=>e.stake=i,onInput:i=>a.debounceFieldUpdate(e,"stake"),min:"1",placeholder:"Miză"},null,42,F),[[p,e.stake]]),r(n("input",{disabled:a.isEnded||l.loading,class:c([{"input-disabled":a.isEnded||l.loading},"input-primary text-center"]),type:"number","onUpdate:modelValue":i=>e.price=i,onInput:i=>a.debounceFieldUpdate(e,"price"),min:"0",placeholder:"Preț (LEI)"},null,42,S),[[p,e.price]]),r(n("input",{disabled:a.isEnded,class:c([{"input-disabled":a.isEnded},"input-primary text-center"]),type:"number","onUpdate:modelValue":i=>e.result=i,onInput:i=>a.debounceFieldUpdate(e,"result"),step:"0.1",placeholder:"Rezultat (LEI)"},null,42,O),[[p,e.result]]),r(n("input",{type:"number","onUpdate:modelValue":i=>e.multiplier=i,disabled:"",class:"input-disabled text-center",placeholder:"Multiplicator"},null,8,A),[[p,e.multiplier]]),a.isEnded?m("",!0):(d(),u("button",{key:2,onClick:i=>a.removeBonusBuyGameRow(e.id),class:"btn-danger"},s[6]||(s[6]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,j))],2)],2))),128))]),_:1})],64)):m("",!0),a.isEnded?m("",!0):(d(),u("div",D,[n("button",{onClick:s[5]||(s[5]=(...e)=>a.createNewBonusBuyGameRow&&a.createNewBonusBuyGameRow(...e)),class:"btn-primary w-full max-w-md"}," + Game ")]))])}const K=E(V,[["render",H]]);export{K as default};
