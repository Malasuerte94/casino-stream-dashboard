import _ from"./SvgBh-80daccd4.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";import{q as L,c as g,b as t,I as o,a as S,k as b,t as n,d as m,F as f,E as v,o as h,n as y}from"./app-5ba5a9a5.js";const B={components:{SvgBh:_},props:["id"],data(){return{loading:!0,bonusList:[],bonusListGames:[],allSettings:null,settings:{},isUpdating:!1,scrollSpeed:500,itWasDuplicated:!0,startedOpening:!1}},async mounted(){window.Echo.channel(`App.Models.User.${this.id}`).listen("BonusBuyOrHuntUpdated",async()=>{await this.updateList()}).listen("SettingsUpdated",async()=>{await this.updateList()}),await this.getSettings(),await this.getLatestList(),this.loading=!1,await this.$nextTick(async()=>{await this.updateList(),this.initAutoScroll(this.$refs.scrollWrapper),this.initAutoScroll(this.$refs.scrollWrapperHunt)})},computed:{startAmount(){return this.bonusList.start??0},huntOrBuy(){var e;return((e=this.allSettings)==null?void 0:e.bonus_list)==="buy"?"Buy":"Hunt"},duplicatedGames(){return this.startedOpening?this.bonusListGames:this.shouldScroll()?(this.itWasDuplicated=!0,[...this.bonusListGames,...this.bonusListGames]):(this.itWasDuplicated=!1,this.bonusListGames)},firstEmptyResultId(){const e=this.bonusListGames.find(i=>i.result==="0");return e?e.id:null},nextGameIndex(){return this.bonusListGames.findIndex(e=>!e.result||e.result==="0")},gamesOpenedNr(){return this.bonusListGames.filter(e=>e.result&&e.result!=="0").length},gamesTotalNr(){return this.bonusListGames.length},gamesRemaining(){return this.bonusListGames.filter(e=>!e.result||e.result==="0").length},gameHighestMulti(){const e=this.bonusListGames.map(i=>i!=null&&i.multiplier?parseFloat(i.multiplier.trim()):NaN).filter(i=>!isNaN(i));return e.length?Math.max(...e):0},gameHighestResult(){const e=this.bonusListGames.filter(i=>i.result&&i.result!=="0").map(i=>parseFloat(i.result));return e.length===0?0:Math.max(...e)},progressPercentage(){return this.gamesOpenedNr/this.gamesTotalNr*100},averageMulti(){const e=this.bonusListGames.filter(u=>u.result!==null&&u.result!=="0");if(e.length===0)return 0;const i=e.reduce((u,c)=>u+parseFloat(c.multiplier),0);return Math.round(i/e.length)},requiredAverageX(){const e=this.bonusList.start,i=this.bonusListGames.reduce((a,l)=>a+(l.result?parseFloat(l.result):0),0),u=Math.max(e-i,0),c=this.bonusListGames.filter(a=>!a.result||a.result==="0").length;if(c===0)return 0;const s=u/c;let r=0;return this.bonusListGames.forEach(a=>{const l=parseFloat(a.stake);if(a.result&&a.result!=="0")return;const d=s/l;r+=d}),Math.round(r/c)}},methods:{shouldScroll(){const e=this.$refs.scrollWrapper||this.$refs.scrollWrapperHunt,i=this.$refs.viewport;if(!e||!i)return!1;const u=document.querySelector(".header-list"),c=u?u.getBoundingClientRect().height:0,r=i.getBoundingClientRect().bottom-c,a=e.querySelectorAll(".game-single");if(a.length===0)return!1;let l=0;return a.forEach(d=>{l+=d.getBoundingClientRect().height}),this.itWasDuplicated&&(l=l/2),l+20>r},async getSettings(){await axios.get("/api/settings/"+this.id).then(e=>{this.allSettings=e.data.settings,this.loadSettings()}).catch(e=>{console.log(e)})},async loadSettings(){this.settings=JSON.parse(this.allSettings.obs_bonus_list),this.scrollSpeed=this.settings.scrollSpeed},async getLatestList(){await axios.get("/api/bonus-list/"+this.id).then(e=>{this.bonusList=e.data.bonusList,this.bonusListGames=e.data.bonusListGames}).catch(e=>{console.log(e)})},async updateList(){this.isUpdating||(this.isUpdating=!0,await this.getSettings(),await this.getLatestList(),this.bonusListGames.some(e=>parseInt(e.result)!==0)&&this.gamesRemaining!==0?(this.startedOpening=!0,await this.$nextTick(()=>{this.scrollToNextGame()})):this.startedOpening=!1,this.isUpdating=!1,this.initAutoScroll())},initAutoScroll(){const e=this.$refs.gamesList||this.$refs.gamesListHunt;e&&(this.startedOpening||!this.shouldScroll()?e.style.animation="":e.style.animation=`scrollAnimation ${this.scrollSpeed*this.bonusListGames.length}s linear infinite`)},scrollToNextGame(){const e=this.$refs.gameTableBuy||this.$refs.gameTableHunt,i=this.$refs.gamesList||this.$refs.gamesListHunt,u=this.$refs.scrollWrapper||this.$refs.scrollWrapperHunt;if(!i||!u)return;const c=i.querySelectorAll(".game-single"),s=this.nextGameIndex;if(s===-1||c.length<=s)return;const r=c[s],a=r.offsetTop,l=r.clientHeight,d=e.clientHeight,p=a+l-d/2;i.style.transition="transform 0.5s ease",i.style.transform=`translateY(-${p}px)`}}},C={key:0,class:"table-list",ref:"viewport"},G={class:"table-container"},H={key:0,class:"img-list"},k={class:"bonus-details"},w={class:"details"},F={class:"details"},N={class:"flex flex-col text-center"},T={class:"flex flex-col text-center"},R={class:"flex flex-col text-center"},z={class:"flex flex-col text-center"},A={class:"flex flex-col text-center"},M={class:"number_game"},O={class:"name_game"},W={class:"stake"},E={class:"result"},I={class:"result"},q={class:"multi"},D={class:"number_game"},P={class:"name_game"},U={class:"stake"};function X(e,i,u,c,s,r){const a=L("SvgBh");return s.loading?b("",!0):(h(),g("div",C,[t("div",G,[t("div",{class:"header-list",style:o({border:s.settings.borderEnabled?s.settings.borderWidth+"px "+s.settings.borderColor+" solid":"unset"})},[t("div",{class:"header-list-title",style:o({"background-color":s.settings.headerBgColor,color:s.settings.headerFontColor,"font-size":s.settings.headerFontSize+"px"})},[s.settings.showIcon?(h(),g("span",H,[S(a)])):b("",!0),i[1]||(i[1]=t("span",null,"Bonus",-1)),t("span",null,n(r.huntOrBuy),1),t("div",k,[t("div",{class:"list-cost",style:o({"background-color":s.settings.headerCellBgColor})},[i[0]||(i[0]=m("Cost ")),t("span",null,n(r.startAmount)+" "+n(s.settings.currency),1)],4),t("div",{class:"list-opened",style:o({"background-color":s.settings.headerCellBgColor})},[t("div",w,[t("span",null,n(r.gamesOpenedNr)+"/",1)]),t("div",F,[t("span",null,n(r.gamesTotalNr),1)])],4)])],4),t("div",{class:"progress",style:o({height:s.settings.progressBarHeight+"px"})},[t("div",{class:"progress-bar-fill",style:o({width:r.progressPercentage+"%",background:"linear-gradient(90deg, "+s.settings.progressBarLow+" 0%, "+s.settings.progressBarHigh+" 100%)"})},null,4)],4),t("div",{class:"header-details",style:o({"background-color":s.settings.subheaderBgColor,color:s.settings.subheaderFontColor,"font-size":s.settings.subheaderFontSize+"px"})},[t("div",N,[i[2]||(i[2]=m("Req X")),t("span",null,n(r.requiredAverageX),1)]),t("div",T,[i[3]||(i[3]=m("Avg X")),t("span",null,n(r.averageMulti),1)]),t("div",R,[i[4]||(i[4]=m("Top X")),t("span",null,n(r.gameHighestMulti),1)]),t("div",z,[i[5]||(i[5]=m("Top (plata)")),t("span",null,n(this.$formatCurrency(r.gameHighestResult,s.settings.currency)),1)]),t("div",A,[i[6]||(i[6]=m("Rezultat ")),t("span",null,n(this.$formatCurrency(s.bonusList.result,s.settings.currency)),1)])],4)],4),r.huntOrBuy==="Buy"?(h(),g("div",{key:0,class:"game-table",ref:"gameTableBuy",style:o({border:s.settings.borderEnabled?s.settings.borderWidth+"px "+s.settings.borderColor+" solid":"unset"})},[t("div",{class:"header",style:o({"background-color":s.settings.tableHeaderBgColor,color:s.settings.tableHeaderFontColor,"font-size":s.settings.tableHeaderFontSize+"px"})},i[7]||(i[7]=[t("div",{class:"header-content_buy header-content"},[t("div",{class:"text-center"},"#"),t("div",null,"Joc"),t("div",null,"Miză"),t("div",null,"Preț "),t("div",null,"Plată"),t("div",null,"Multi")],-1)]),4),t("div",{class:"scroll-wrapper",ref:"scrollWrapper",style:o({"background-color":s.settings.tableBgColor})},[t("div",{class:"games",style:o({color:s.settings.tableBodyFontColor,"font-size":s.settings.tableBodyFontSize+"px"}),ref:"gamesList"},[(h(!0),g(f,null,v(r.duplicatedGames,(l,d)=>{var p;return h(),g("div",{key:"a-"+d,class:y(["game-single row-game_buy",{current:r.firstEmptyResultId===l.id}]),style:o({"border-bottom":"1px solid "+s.settings.tableDividerColor,"background-color":r.firstEmptyResultId===l.id?s.settings.tableCurrentGameColor:"unset"})},[t("div",M,n(d%s.bonusListGames.length+1),1),t("div",O,n(((p=l.game)==null?void 0:p.name)??"N/A"),1),t("div",W,n(l.stake),1),t("div",E,n(l.price==="0"||l.price==null?"":l.price),1),t("div",I,n(l.result==="0"||l.result==null?"":l.result),1),t("div",q,n(l.multiplier==="0"||l.multiplier==null?"":"x"+l.multiplier),1)],6)}),128))],4)],4)],4)):(h(),g("div",{key:1,class:"game-table",ref:"gameTableHunt",style:o({border:s.settings.borderEnabled?s.settings.borderWidth+"px "+s.settings.borderColor+" solid":"unset"})},[t("div",{class:"header",style:o({"background-color":s.settings.tableHeaderBgColor,color:s.settings.tableHeaderFontColor,"font-size":s.settings.tableHeaderFontSize+"px"})},i[8]||(i[8]=[t("div",{class:"header-content_hunt header-content"},[t("div",{class:"text-center"},"#"),t("div",null,"Joc"),t("div",null,"Miză"),t("div",null,"Plată"),t("div",null,"Multi")],-1)]),4),t("div",{class:"scroll-wrapper",ref:"scrollWrapperHunt",style:o({"background-color":s.settings.tableBgColor})},[t("div",{class:"games",style:o({color:s.settings.tableBodyFontColor,"font-size":s.settings.tableBodyFontSize+"px"}),ref:"gamesListHunt"},[(h(!0),g(f,null,v(r.duplicatedGames,(l,d)=>{var p;return h(),g("div",{key:"b-"+d,class:y(["game-single row-game_hunt",{current:r.firstEmptyResultId===l.id}]),style:o({"border-bottom":"1px solid "+s.settings.tableDividerColor,"background-color":r.firstEmptyResultId===l.id?s.settings.tableCurrentGameColor:"unset"})},[t("div",D,n(d%s.bonusListGames.length+1),1),t("div",P,n(((p=l.game)==null?void 0:p.name)??"N/A"),1),t("div",U,n(l.stake),1),t("div",null,n(l.result==="0"||l.result==null?"":l.result),1),t("div",null,n(l.multiplier==="0"||l.multiplier==null?"":"x"+l.multiplier),1)],6)}),128))],4)],4)],4))])],512))}const j=x(B,[["render",X]]);export{j as default};
