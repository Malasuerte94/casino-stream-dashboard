import{d as n,l as J,q as X,c as Y,w as H,o,a as s,e as l,k as y,E as _,F as S,h as U,f as r,b as K,u as O,t as b,g as F}from"./app-a1d1fb9a.js";import{_ as Q}from"./AppLayout-f9d96321.js";import{u as W,C as Z}from"./gameStore-e1124e6c.js";import"./ResponsiveNavLink-829e3811.js";import"./_plugin-vue_export-helper-c27b6911.js";const I={class:"py-2"},ee={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},te={key:0,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},ae={class:"p-6 space-y-4"},se={class:"bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-4"},oe=["src"],le=["onUpdate:modelValue"],re=["onClick"],ne={class:"flex gap-4"},de={key:1,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},ue={class:"p-6 flex justify-center items-center bg-gray-100 dark:bg-gray-800"},ie={class:"w-full max-w-md bg-white dark:bg-gray-700 shadow-lg rounded-lg p-6 text-center"},ce=["src"],me={class:"text-2xl font-bold text-gray-800 dark:text-white mb-2"},be={class:"text-lg font-medium text-gray-600 dark:text-gray-300"},ge={key:2,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg mt-6"},pe={class:"p-6"},ve={class:"text-xl font-bold mb-4"},ye={key:0,class:"grid grid-cols-2 gap-4 mt-4"},_e={class:"text-lg font-bold mb-2"},he=["src"],fe={class:"text-sm font-medium text-gray-700"},xe=["onUpdate:modelValue"],ke={class:"text-sm font-medium text-gray-700"},we=["onUpdate:modelValue","onInput"],Be={class:"text-sm font-medium text-gray-700"},Ce=["onUpdate:modelValue"],Ve=["onClick"],Se={class:"mt-4 text-lg font-bold"},Ue={key:1},Fe={class:"mt-4 text-lg font-bold"},je={__name:"BonusBattle",setup(Ae){const h=n(""),w=n("5-10"),c=n([]),v=n(null),B=n(null),x=n(null),k=n(null),A=n(null),T=n(null),d=n(null),g=n([]),G=W(),E=J(()=>G.availableGames);X(async()=>{await f()});const P=()=>{const t=c.value.length,e=t===0?2:t*2;for(let a=0;a<e-t;a++)c.value.push({game_id:"",for_user:""})},$=()=>{const t=c.value.length;if(t<=2){alert("You must have at least 2 participants.");return}const e=t/2;c.value.splice(e)},j=async()=>{g.value.forEach(t=>{t==null||t.scores.push({bracket_id:k.value.id,bonus_concurrent_id:t.id,cost_buy:0,score:0,result_buy:0})}),await C(),await f()},N=async(t,e)=>{await z(g.value[t].scores[e].id),g.value[t].scores.splice(e,1)},R=async(t,e)=>{const a=g.value[t].scores[e];a.cost_buy>0?(a.score=parseFloat((a.result_buy/a.cost_buy).toFixed(2)),await C()):alert("Amount must be greater than 0.")},M=t=>t.reduce((e,a)=>e+a.score,0).toFixed(2),z=async t=>{var e;try{const a=await axios.delete(`/api/bonus-battles/delete-score/${t}`);console.log("Bonus score deleted successfully:",a.data),await C()}catch(a){console.error("Failed to delete bonus score:",((e=a.response)==null?void 0:e.data)||a.message)}},C=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:k.value.id,bracket:g.value});console.log("Bonus battle stored successfully:",e.data)}catch(e){console.error("Failed to store bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}},D=async()=>{var t;if(!h.value||c.value.some(e=>!e.game_id)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:h.value,stake:w.value,concurrents:c.value});console.log("Bonus battle stored successfully:",e.data),await f()}catch(e){console.error("Failed to store bonus battle:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},L=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:v.value.id});d.value=e.data.winner,await f()}catch(e){console.log("endBattle error:",((t=e.response)==null?void 0:t.data)||e.message)}},q=async()=>{var t;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:k.value.id}),await f()}catch(e){console.error("Failed to finish round:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}},f=async()=>{try{const t=await axios.get("/api/bonus-battles/active");if(T.value=t.data.total_battles,v.value=t.data.battle,B.value=t.data.concurrents,x.value=t.data.stage,k.value=t.data.bracket,A.value=t.data.scores,h.value="Bonus Battle #"+(T.value+1),B.value){const e=B.value;g.value=e.slice(0,2).map(a=>{const m=A.value.filter(u=>u.bonus_concurrent_id===a.id);return{...a,scores:m.length?m:[]}})}}catch(t){console.error("Failed to fetch active bonus battle:",t.message)}},V=t=>{const e=G.availableGames.find(a=>a.id===t);return e?`http://127.0.0.1:8000/storage/games/${e.image}`:""};return(t,e)=>(o(),Y(Q,{title:"Bonus Battle"},{default:H(()=>[s("div",I,[s("div",ee,[!v.value&&!d.value?(o(),l("div",te,[s("div",ae,[s("div",null,[e[3]||(e[3]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Titlu Bonus Battle",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),id:"title",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[_,h.value]])]),s("div",null,[e[4]||(e[4]=s("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),y(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),id:"stake",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[_,w.value]])]),s("div",se,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Participanți",-1)),(o(!0),l(S,null,U(c.value,(a,m)=>(o(),l("div",{key:m,class:"flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow"},[a.game_id?(o(),l("img",{key:0,src:V(a.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-lg"},null,8,oe)):r("",!0),K(O(Z),{options:E.value,label:"name",reduce:u=>u.id,modelValue:a.game_id,"onUpdate:modelValue":u=>a.game_id=u,placeholder:"Alege Joc",class:"flex-1 input-select"},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),y(s("input",{type:"text","onUpdate:modelValue":u=>a.for_user=u,class:"flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 p-2.5",placeholder:"Cine a ales? (opțional)"},null,8,le),[[_,a.for_user]]),c.value.length>2?(o(),l("button",{key:1,onClick:u=>$(m),class:"btn-danger"}," ✕ ",8,re)):r("",!0)]))),128)),s("div",ne,[s("button",{onClick:P,class:"btn-primary"},"Adaugă Participanți"),c.value.length>2?(o(),l("button",{key:0,onClick:$,class:"btn-danger"}," Șterge ")):r("",!0)])]),s("button",{type:"button",onClick:D,class:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md"},"Start ")])])):d.value?(o(),l("div",de,[s("div",ue,[s("div",ie,[d.value.game.image?(o(),l("img",{key:0,src:V(d.value.game.id),alt:"Game Thumbnail",class:"w-32 auto mx-auto object-cover rounded-lg mb-4"},null,8,ce)):r("",!0),s("h2",me," Câștigător! - "+b(d.value.game.name),1),s("p",be," User: "+b(d.value.for_user),1)])])])):r("",!0),v.value?(o(),l("div",ge,[s("div",pe,[s("h2",ve,"Active Battle: "+b(v.value.title),1),s("p",null,"Stake: "+b(v.value.stake)+" | Etapa: "+b(x.value.name),1),g.value.length>1?(o(),l("div",ye,[(o(!0),l(S,null,U(g.value,(a,m)=>(o(),l("div",{key:m,class:"border rounded-md p-4 shadow"},[s("h3",_e,b(a.game.name),1),a.game.image?(o(),l("img",{key:0,src:V(a.game.id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-lg"},null,8,he)):r("",!0),s("div",null,[(o(!0),l(S,null,U(a.scores,(u,i)=>(o(),l("div",{key:i,class:"flex items-center space-x-2 mt-1"},[s("label",fe,[e[6]||(e[6]=F(" Cost Buy ")),y(s("input",{type:"number","onUpdate:modelValue":p=>a.scores[i].cost_buy=p,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Amount"},null,8,xe),[[_,a.scores[i].cost_buy]])]),s("label",ke,[e[7]||(e[7]=F(" Rezultat Buy ")),y(s("input",{type:"number","onUpdate:modelValue":p=>a.scores[i].result_buy=p,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Result",onInput:p=>R(m,i)},null,40,we),[[_,a.scores[i].result_buy]])]),s("label",Be,[e[8]||(e[8]=F(" Scor ")),y(s("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":p=>a.scores[i].score=p,class:"block w-20 border-gray-300 rounded-md shadow-sm disabled",placeholder:"Result"},null,8,Ce),[[_,a.scores[i].score]])]),i>=1?(o(),l("button",{key:0,type:"button",onClick:p=>N(m,i),class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"}," X ",8,Ve)):r("",!0)]))),128)),s("button",{type:"button",onClick:e[2]||(e[2]=u=>j()),class:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-md text-sm"}," Adaugă Buy ")]),s("p",Se," Scor Total: "+b(M(a.scores)),1)]))),128))])):r("",!0),d.value?(o(),l("div",Ue,[s("p",Fe,"Câștigător: "+b(d.value.game.name)+" | User: "+b(d.value.for_user),1)])):r("",!0),x.value.name!=="Final"?(o(),l("button",{key:2,type:"button",onClick:q,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Următoarii Concurenți ")):r("",!0),x.value.name==="Final"?(o(),l("button",{key:3,type:"button",onClick:L,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Termina Battle ")):r("",!0)])])):r("",!0)])])]),_:1}))}};export{je as default};
