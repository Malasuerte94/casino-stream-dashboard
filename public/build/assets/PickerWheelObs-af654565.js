import{_ as p}from"./_plugin-vue_export-helper-c27b6911.js";import{c as a,b as r,n as d,F as u,s as f,t as m,k as w,o as l,z as y}from"./app-9964ed26.js";const _={props:["id"],data(){return{games:[],colors:["#f48a00","#022522"],isSpinning:!1,selectedGame:null,spinDuration:4e3,showSelectedGame:!1,centerImageUrl:"https://yt3.googleusercontent.com/CfIgnRwE7ROK9CugvIS1PQOjiOUfMyruXwnHwE3FmRnHu7Utw-RjZKldzKONjXFSTUl8zCfX=s160-c-k-c0x00ffffff-no-rj",previousEndDegree:0,animation:null,newEndDegree:0}},async mounted(){await this.getList(),await this.getProfilePicture(),this.pollForSpin()},methods:{async getList(){try{let t=(await axios.get(`/api/wheel-list/${this.id}`)).data.split(`
`).map(i=>i.trim()).filter(i=>i);JSON.stringify(t)!==JSON.stringify(this.games)&&(this.games=t)}catch(e){console.log("Error checking list:",e)}},pollForSpin(){setInterval(()=>{axios.get(`/api/spin/check/${this.id}`).then(e=>{this.getList(),e.data.shouldSpin&&(this.spinWheel(),axios.post(`/api/spin/clear/${this.id}`).catch(t=>{console.log("Error clearing spin trigger:",t)}))}).catch(e=>{console.log("Error checking spin trigger:",e)})},3e3)},async getProfilePicture(){await axios.get(`/api/user/profile-picture/${this.id}`).then(e=>{this.centerImageUrl=e.data.profile_picture}).catch(e=>{console.log("Error getting user picture",e)})},getLabelStyle(e){const t=this.games.length,i=this.colors[e%2];return{"align-content":"center","clip-path":"polygon(0% 0, 100% 50%, 0% 100%)",display:"grid","font-size":"20px","grid-area":"1 / -1","aspect-ratio":`1/calc(2*tan(180deg/${t}))`,"list-style":"none","padding-left":"1ch",rotate:`calc(360deg / ${t} * calc(${e} - 1))`,"transform-origin":"center right",width:"50cqi",background:`${i}`}},spinWheel(){if(this.isSpinning)return;this.isSpinning=!0,this.showSelectedGame=!1;const e=this.$refs.wheel;this.animation&&this.animation.cancel();const t=Math.random()*360+1800;this.newEndDegree=this.previousEndDegree+t,this.animation=e.animate([{transform:`rotate(${this.previousEndDegree}deg)`},{transform:`rotate(${this.newEndDegree}deg)`}],{duration:this.spinDuration,easing:"cubic-bezier(0.440, -0.205, 0.000, 1.130)",fill:"forwards"}),this.animation.onfinish=()=>{e.style.transform="";const o=document.querySelector(".selector-arrow").getBoundingClientRect(),s=o.left+o.width/2,g=o.top+o.height/2,n=document.elementsFromPoint(s,g).find(c=>c.classList&&c.classList.contains("slice-label"));if(n){const c=Number(n.getAttribute("data-index"));this.selectedGame=this.games[c],this.showSelectedGame=!0}else console.warn("No slice element found at the arrow position");this.previousEndDegree=this.newEndDegree,setTimeout(()=>{this.animation.cancel(),this.isSpinning=!1,this.showSelectedGame=!1},3e3)}}}},S={key:0,id:"game"},E=["src"],v=["data-index"],x={key:0,class:"selected-game"},k={key:1,class:"text-center text-gray-500"};function b(e,t,i,o,s,g){return s.games.length>0?(l(),a("div",S,[r("div",{class:d(["wheel-container",{centered:s.isSpinning}])},[r("div",{class:d(["wheel",{idle:!s.isSpinning}]),ref:"wheel"},[r("img",{class:"center-image",src:s.centerImageUrl,alt:"center image"},null,8,E),(l(!0),a(u,null,f(s.games,(h,n)=>(l(),a("div",{key:n,class:"slice-label","data-index":n,style:y(g.getLabelStyle(n))},m(h),13,v))),128))],2),t[0]||(t[0]=r("div",{class:"selector-arrow"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[r("path",{d:"M12 21l-12-18h24z"})])],-1))],2),s.showSelectedGame?(l(),a("div",x,m(s.selectedGame),1)):w("",!0)])):(l(),a("div",k,"No games found"))}const z=p(_,[["render",b]]);export{z as default};
