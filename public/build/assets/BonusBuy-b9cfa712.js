import{_ as w,C as _,u as V}from"./MyInput-b14173b6.js";import{p as m,q as y,c as n,b as i,a as d,f,w as v,L as U,k as c,o,F as L,E as T,n as B,I as G,t as k}from"./app-044fa54a.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";const x={components:{MyInput:w,vSelect:_},data(){return{bonusBuy:{},bonusBuyGames:[],fieldUpdateTimeouts:{},debounceTimer:null,loading:!1}},computed:{gameOptions(){return V().availableGames},isEnded(){return Boolean(this.bonusBuy.ended)}},mounted(){this.getLatestList()},methods:{debounceUpdateBonusBuy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.updateBonusBuy(),1e3)},debounceFieldUpdate(e,s){(s==="result"||s==="price")&&this.calcCurentRowMultiplier(e),this.fieldUpdateTimeouts[e.id]||(this.fieldUpdateTimeouts[e.id]={}),this.fieldUpdateTimeouts[e.id][s]&&clearTimeout(this.fieldUpdateTimeouts[e.id][s]),this.fieldUpdateTimeouts[e.id][s]=setTimeout(()=>{this.updateBonusBuyGames()},1e3)},getGameThumbnail(e){const s=this.gameOptions.find(p=>p.id===e);return s?`/storage/games/${s.image}`:""},async getLatestList(){try{const e=await m.get("/api/bonus-buy");this.bonusBuy=e.data.bonusBuy,this.bonusBuyGames=e.data.bonusBuyGames}catch(e){console.error(e)}},async updateBonusBuy(){try{await m.patch("/api/bonus-buy",{bonusBuy:this.bonusBuy}),await this.getLatestList()}catch(e){console.error(e)}},async updateBonusBuyGames(){try{this.loading=!0,await m.put("/api/bonus-buy-games",{games:this.bonusBuyGames})}catch(e){console.error(e)}finally{await this.getLatestList(),this.loading=!1}},async createNewBonusBuyGameRow(){try{await m.post("/api/bonus-buy-games",{bonusBuyId:this.bonusBuy.id}),await this.getLatestList()}catch(e){console.error(e)}},async removeBonusBuyGameRow(e){try{await m.delete(`/api/bonus-buy-games/${e}`),await this.getLatestList()}catch(s){console.error(s)}},wantToReset(){this.$dialog({message:"Ești sigur că vrei să faci o listă nouă?",buttons:["da","nu"],da:this.resetBonusBuy,nu:()=>console.log("Canceled reset")})},async resetBonusBuy(){try{await m.post("/api/close-bonus-list",{close:!0,list_id:this.bonusBuy.id,type:"buy"}),await m.post("/api/bonus-buy"),await this.getLatestList(),this.$emit("newlist")}catch(e){console.error(e)}},calcCurentRowMultiplier(e){if(!e.price||!e.result||e.result<0)return;const s=Math.round(e.result/e.price*100)/100;e.multiplier=s}}},C={class:"p-6 rounded-lg shadow-lg bg-gray-800"},E={class:"space-y-6 mb-6"},R={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},M={class:"text-center text-gray-200 font-medium"},z=["src"],N={key:1},F=["onClick"],S={key:1,class:"flex justify-center mt-8"};function O(e,s,h,p,u,a){const r=y("MyInput"),g=y("v-select");return o(),n("div",C,[i("div",E,[i("div",R,[d(r,{modelValue:u.bonusBuy.name,"onUpdate:modelValue":s[0]||(s[0]=t=>u.bonusBuy.name=t),type:"text",disabled:a.isEnded,onInput:a.debounceUpdateBonusBuy,label:"Nume Lista"},null,8,["modelValue","disabled","onInput"]),d(r,{modelValue:u.bonusBuy.start,"onUpdate:modelValue":s[1]||(s[1]=t=>u.bonusBuy.start=t),type:"number",disabled:!0,label:"Cost (LEI)"},null,8,["modelValue"]),d(r,{modelValue:u.bonusBuy.result,"onUpdate:modelValue":s[2]||(s[2]=t=>u.bonusBuy.result=t),type:"number",disabled:!0,label:"Rezultat (LEI)"},null,8,["modelValue"]),i("button",{onClick:s[3]||(s[3]=(...t)=>a.wantToReset&&a.wantToReset(...t)),class:"btn-primary w-full md:w-auto"}," LISTA NOUA ")])]),u.bonusBuyGames.length>0?(o(),f(U,{key:0,name:"fade"},{default:v(()=>[(o(!0),n(L,null,T(u.bonusBuyGames,(t,b)=>(o(),n("div",{key:t.id||b,class:B(["relative overflow-hidden rounded-lg shadow mb-4 game-row",{"bg-gray-700":!t.game_id}])},[t.game_id?(o(),n("div",{key:0,class:"bg-blur",style:G({backgroundImage:"url("+a.getGameThumbnail(t.game_id)+")"})},null,4)):c("",!0),i("div",{class:B(["relative z-10 grid grid-cols-1 md:grid-cols-[10px_50px_1fr_120px_120px_120px_120px_50px] gap-4 items-center p-4",t.game_id?"bg-transparent":"bg-white dark:bg-gray-700"])},[i("div",M,k(b+1),1),t.game_id?(o(),n("img",{key:0,src:a.getGameThumbnail(t.game_id),alt:"Game Thumbnail",class:"w-20 h-20 object-cover rounded-lg"},null,8,z)):(o(),n("span",N)),d(g,{disabled:a.isEnded||u.loading,options:a.gameOptions,label:"name",reduce:l=>l.id,"append-to-body":"","onUpdate:modelValue":[l=>a.debounceFieldUpdate(t,"game_id"),l=>t.game_id=l],modelValue:t.game_id},null,8,["disabled","options","reduce","onUpdate:modelValue","modelValue"]),d(r,{modelValue:t.stake,"onUpdate:modelValue":l=>t.stake=l,type:"number",disabled:a.isEnded||u.loading,onInput:l=>a.debounceFieldUpdate(t,"stake"),label:"Miză",min:"1",step:"0.1"},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),d(r,{modelValue:t.price,"onUpdate:modelValue":l=>t.price=l,type:"number",disabled:a.isEnded||u.loading,onInput:l=>a.debounceFieldUpdate(t,"price"),label:"Preț (LEI)",min:"0",step:"0.1"},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),d(r,{modelValue:t.result,"onUpdate:modelValue":l=>t.result=l,type:"number",disabled:a.isEnded||u.loading,onInput:l=>a.debounceFieldUpdate(t,"result"),label:"Rezultat (LEI)",min:"0",step:"0.1"},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"]),d(r,{modelValue:t.multiplier,"onUpdate:modelValue":l=>t.multiplier=l,type:"number",disabled:!0,label:"Multiplicator"},null,8,["modelValue","onUpdate:modelValue"]),a.isEnded?c("",!0):(o(),n("button",{key:2,onClick:l=>a.removeBonusBuyGameRow(t.id),class:"btn-danger"},s[5]||(s[5]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,F))],2)],2))),128))]),_:1})):c("",!0),a.isEnded?c("",!0):(o(),n("div",S,[i("button",{onClick:s[4]||(s[4]=(...t)=>a.createNewBonusBuyGameRow&&a.createNewBonusBuyGameRow(...t)),class:"btn-primary w-full max-w-md"}," + Game ")]))])}const q=I(x,[["render",O]]);export{q as default};
