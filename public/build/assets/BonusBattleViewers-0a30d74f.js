import{q as g,c as o,b as s,h as b,m as y,d as _,t as c,k as p,F as h,E as m,o as l,n as k}from"./app-1a6a8153.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";const w={name:"BattleViewerList",emits:["winnersPicked"],data(){return{battleViewers:[],winners:[],setting:!1,loading:!1}},props:{fillCount:{type:Number,required:!1}},async mounted(){await this.fetchBattleViewers(),await this.fetchSetting(),window.Echo.channel(`App.Models.User.${this.$page.props.user.id}`).listen("BattleViewerUpdated",()=>{this.fetchBattleViewers()})},methods:{async fetchBattleViewers(){try{const t=await g.get("api/bonus-battles/battle-viewers");this.battleViewers=t.data}catch(t){console.error("Failed to fetch battle viewers:",t.message)}},async fetchSetting(){if(!this.loading){this.loading=!0;try{const t=await g.get("/api/get-setting-public",{params:{setting_name:"battle_selections"}});t.data.setting_value!==void 0&&(this.setting=t.data.setting_value==1)}catch(t){console.error("Failed to fetch setting:",t.message)}finally{this.loading=!1}}},copyText(t){if(navigator.clipboard)navigator.clipboard.writeText(t).then(()=>{alert("Comanda a fost copiată în clipboard")}).catch(e=>{console.error("Failed to copy text: ",e)});else{const e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(r){console.error("Failed to copy text: ",r)}document.body.removeChild(e)}},updateWinners(){this.$emit("winnersPicked",this.winners.map(t=>t.user))},getRandomItem(t){return t[Math.floor(Math.random()*t.length)]},async markAsPicked(t){try{await g.patch(`api/bonus-battles/battle-viewers/${t}`,{picked:!0})}catch(e){console.error("Failed to mark as picked:",e.message)}},async markAsEliminated(t){try{await g.patch(`api/bonus-battles/battle-viewers/${t}`,{eliminated:!0})}catch(e){console.error("Failed to mark as eliminated:",e.message)}},async pickWinner(){if(!this.loading){this.loading=!0;try{const t=this.battleViewers.filter(r=>!r.picked&&!r.eliminated);if(!t.length){console.error("No available candidates");return}const e=this.getRandomItem(t);await this.markAsPicked(e.id),e.picked=!0,this.winners.push(e),this.updateWinners()}catch(t){console.error("Error picking winner:",t)}finally{this.loading=!1}}},async fillList(){if(!this.loading){this.loading=!0;try{if(this.fillCount<0)return;const t=[];for(let e=0;e<this.fillCount;e++){const r=this.battleViewers.filter(n=>!n.picked&&!n.eliminated);if(!r.length)break;const d=this.getRandomItem(r);await this.markAsPicked(d.id),d.picked=!0,t.push(d)}this.winners=t,this.updateWinners()}catch(t){console.error("Error filling list:",t)}finally{this.loading=!1}}},clearList(){this.$dialog({message:"Ești sigur că vrei să faci o listă nouă?",buttons:["da","nu"],da:async()=>{if(!this.loading){this.loading=!0;try{await g.post("api/bonus-battles/battle-viewers/remove-all"),this.battleViewers=[],this.winners=[],this.updateWinners()}catch(t){console.error("Failed to clear the list:",t.message)}finally{this.loading=!1}}},nu:()=>console.log("Canceled reset")})},async rerollWinner(t,e){if(!this.loading){this.loading=!0;try{await this.markAsEliminated(t.id);const r=this.battleViewers.find(a=>a.id===t.id);r&&(r.eliminated=!0);const d=this.battleViewers.filter(a=>!a.picked&&!a.eliminated);if(!d.length){console.error("No available candidates for reroll");return}const n=this.getRandomItem(d);await this.markAsPicked(n.id),n.picked=!0,this.winners.splice(e,1,n),this.updateWinners()}catch(r){console.error("Error in rerollWinner:",r)}finally{this.loading=!1}}},eliminateWinner(t,e){this.$dialog({message:"Ești sigur că vrei să elimini acest utilizator?",buttons:["da","nu"],da:async()=>{if(!this.loading){this.loading=!0;try{await this.markAsEliminated(t.id),this.winners.splice(e,1);const r=this.battleViewers.find(d=>d.id===t.id);r&&(r.eliminated=!0),this.updateWinners()}catch(r){console.error("Error eliminating winner:",r)}finally{this.loading=!1}}},nu:()=>console.log("Canceled elimination")})},async updateSetting(){if(!this.loading){this.loading=!0;try{await g.post("/api/settings/save",{setting_name:"battle_selections",setting_value:this.setting})}catch(t){console.error("Error saving settings:",t)}finally{this.loading=!1}}}},computed:{apiUrlCommand(){return`{readapi.${window.location.origin}/api/add-bb-viewer/{user.name}/{1}/${this.$page.props.user.id}}`},apiUrlCommandNightBot(){return`$(urlfetch ${window.location.origin}/api/add-bb-viewer/$(user)/$(1) $(2) $(3)/${this.$page.props.user.id})`}}},v={class:"p-2 rounded-md shadow-md md:w-1/3 bg-gray-800 space-y-4 transition-all duration-300"},C={class:"flex items-center justify-between p-2 bg-gray-700 rounded"},B={for:"toggle",class:"relative inline-flex items-center cursor-pointer"},V=["disabled"],E={class:"ml-3 text-sm font-medium text-gray-300"},L={key:0,class:"ml-2 text-xs italic text-gray-400"},W={key:0,class:"overflow-auto max-h-60 border border-gray-700 rounded"},N={class:"min-w-full text-sm"},U={class:"text-sm"},A={class:"px-2 py-2"},F={class:"px-2 py-2"},P={class:"px-2 py-2"},S=["onClick","disabled"],z={key:0},I={key:1},R=["onClick","disabled"],T={key:0},M={key:1},q={class:"overflow-auto max-h-60 border border-gray-700 rounded"},D={class:"min-w-full"},Y={class:"px-2 py-2"},j={class:"px-2 py-2"},J={class:"px-2 py-2"},O={class:"px-2 py-2"},G={class:"mt-4 flex space-x-4"},H=["disabled"],K={key:0},Q={key:1},X=["disabled"],Z={key:0},$={key:1},ee=["disabled"],te={key:0},se={key:1},ie={class:"mb-4 text-sm"},ne={class:"mb-4 text-sm"};function ae(t,e,r,d,n,a){return l(),o("div",v,[s("div",C,[s("label",B,[b(s("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":e[0]||(e[0]=i=>n.setting=i),onChange:e[1]||(e[1]=(...i)=>a.updateSetting&&a.updateSetting(...i)),class:"sr-only peer",disabled:n.loading},null,40,V),[[y,n.setting]]),e[7]||(e[7]=s("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1)),s("span",E,[_(c(n.setting?"Înscrieri Pornite prin Bot":"Înscrieri Oprite prin Bot")+" ",1),n.loading?(l(),o("span",L,"Loading...")):p("",!0)])])]),n.winners.length?(l(),o("div",W,[s("table",N,[s("tbody",U,[(l(!0),o(h,null,m(n.winners,(i,u)=>(l(),o("tr",{key:i.id,class:"text-sm"},[s("td",A,c(i.user),1),s("td",F,c(i.game),1),s("td",P,[s("button",{onClick:f=>a.rerollWinner(i,u),class:"bg-blue-600 rounded p-1 btn-sm text-sm mr-2",disabled:n.loading},[n.loading?(l(),o("span",z,"Loading...")):(l(),o("span",I,"Reroll"))],8,S),s("button",{onClick:f=>a.eliminateWinner(i,u),class:"bg-red-600 rounded p-1 btn-sm",disabled:n.loading},[n.loading?(l(),o("span",T,"Loading...")):(l(),o("span",M,"Elimină"))],8,R)])]))),128))])])])):p("",!0),s("div",q,[s("table",D,[e[8]||(e[8]=s("thead",{class:"bg-gray-900"},[s("tr",null,[s("th",{class:"px-2 py-2 text-left text-gray-300"},"User"),s("th",{class:"px-2 py-2 text-left text-gray-300"},"Joc"),s("th",{class:"px-2 py-2 text-left text-gray-300"},"Ales"),s("th",{class:"px-2 py-2 text-left text-gray-300"},"Eliminat")])],-1)),s("tbody",null,[(l(!0),o(h,null,m(n.battleViewers,i=>(l(),o("tr",{key:i.id,class:k({"bg-green-600":i.picked&&!i.eliminated,"bg-red-600":i.eliminated})},[s("td",Y,c(i.user),1),s("td",j,c(i.game),1),s("td",J,c(i.picked?"Yes":"No"),1),s("td",O,c(i.eliminated?"Yes":"No"),1)],2))),128))])])]),s("div",G,[s("button",{onClick:e[2]||(e[2]=(...i)=>a.pickWinner&&a.pickWinner(...i)),class:"btn-primary",disabled:n.loading},[n.loading?(l(),o("span",K,"Loading...")):(l(),o("span",Q,"Alege Câștigător"))],8,H),s("button",{onClick:e[3]||(e[3]=(...i)=>a.fillList&&a.fillList(...i)),class:"btn-primary",disabled:n.loading},[n.loading?(l(),o("span",Z,"Loading...")):(l(),o("span",$,"Umple Lista"))],8,X),s("button",{onClick:e[4]||(e[4]=(...i)=>a.clearList&&a.clearList(...i)),class:"btn-danger",disabled:n.loading},[n.loading?(l(),o("span",te,"Loading...")):(l(),o("span",se,"Șterge Lista"))],8,ee)]),e[9]||(e[9]=s("p",{class:"mb-2 text-gray-300 text-sm"}," Poți automatiza procesul de înscriere dacă folosești Streamlabs Cloud Bot. ",-1)),e[10]||(e[10]=s("p",{class:"mb-2 text-gray-300 text-sm"}," Creează comanda Streamlabs Coud Bot !particip: ",-1)),s("div",ie,[s("button",{class:"w-full text-left p-2 bg-green-600 text-gray-900 rounded focus:outline-none hover:bg-green-500 transition",onClick:e[5]||(e[5]=i=>a.copyText(a.apiUrlCommand))},[s("code",null,c(a.apiUrlCommand),1)])]),e[11]||(e[11]=s("p",{class:"mb-2 text-gray-300 text-sm"}," Creează comanda NightBot !particip: ",-1)),s("div",ne,[s("button",{class:"w-full text-left p-2 bg-green-600 text-gray-900 rounded focus:outline-none hover:bg-green-500 transition",onClick:e[6]||(e[6]=i=>a.copyText(a.apiUrlCommandNightBot))},[s("code",null,c(a.apiUrlCommandNightBot),1)])])])}const le=x(w,[["render",ae],["__scopeId","data-v-6a8a2af7"]]);export{le as default};
