import{d,l as K,q as O,c as Q,w as W,o,a as s,e as l,k as _,E as h,F as S,h as U,f as n,b as j,u as E,t as c,g as F}from"./app-b54f83c0.js";import{_ as Z}from"./AppLayout-c55f6025.js";import{u as I,C as N}from"./gameStore-896dd847.js";import"./ResponsiveNavLink-eda1089b.js";import"./_plugin-vue_export-helper-c27b6911.js";const ee={class:"py-2"},te={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ae={key:0,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},se={class:"p-6 space-y-4"},oe={class:"bg-gray-100 dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-4"},le=["src"],re=["onUpdate:modelValue"],ne=["onClick"],de={class:"flex gap-4"},ue={key:1,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},ie={class:"p-6 flex justify-center items-center bg-gray-100 dark:bg-gray-800"},ce={class:"w-full max-w-md bg-white dark:bg-gray-700 shadow-lg rounded-lg p-6 text-center"},me=["src"],be={class:"text-2xl font-bold text-gray-800 dark:text-white mb-2"},ge={class:"text-lg font-medium text-gray-600 dark:text-gray-300"},pe={key:2,class:"bg-white overflow-hidden shadow-xl sm:rounded-lg mt-6"},ve={class:"p-6"},ye={class:"text-xl font-bold mb-4"},_e={key:0,class:"grid grid-cols-2 gap-4 mt-4"},he={class:"text-lg font-bold mb-2"},fe={class:"flex gap-2 items-center mb-2 bg-blend-darken p-2 rounded border-blue-900 border"},xe=["src"],we={class:"text-sm font-medium text-gray-700"},ke=["onUpdate:modelValue"],Be={class:"text-sm font-medium text-gray-700"},Ce=["onUpdate:modelValue","onInput"],Ve={class:"text-sm font-medium text-gray-700"},Se=["onUpdate:modelValue"],Ue=["onClick"],Fe={class:"mt-4 text-lg font-bold"},Ae={key:1},Ge={class:"mt-4 text-lg font-bold"},Re={__name:"BonusBattle",setup(Te){const f=d(""),k=d("5-10"),m=d([]),v=d(null),B=d(null),x=d(null),w=d(null),A=d(null),G=d(null),u=d(null),g=d([]),T=I(),$=K(()=>T.availableGames);O(async()=>{await y()});const R=()=>{const t=m.value.length,e=t===0?2:t*2;for(let a=0;a<e-t;a++)m.value.push({game_id:"",for_user:""})},P=()=>{const t=m.value.length;if(t<=2){alert("You must have at least 2 participants.");return}const e=t/2;m.value.splice(e)},M=async()=>{g.value.forEach(t=>{t==null||t.scores.push({bracket_id:w.value.id,bonus_concurrent_id:t.id,cost_buy:0,score:0,result_buy:0})}),await C(),await y()},z=async(t,e)=>{await q(g.value[t].scores[e].id),g.value[t].scores.splice(e,1)},D=async(t,e)=>{const a=g.value[t].scores[e];a.cost_buy>0?(a.score=parseFloat((a.result_buy/a.cost_buy).toFixed(2)),await C()):alert("Amount must be greater than 0.")},L=t=>t.reduce((e,a)=>e+a.score,0).toFixed(2),q=async t=>{var e;try{const a=await axios.delete(`/api/bonus-battles/delete-score/${t}`);console.log("Bonus score deleted successfully:",a.data),await C()}catch(a){console.error("Failed to delete bonus score:",((e=a.response)==null?void 0:e.data)||a.message)}},C=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/add-score",{active_bracket:w.value.id,bracket:g.value});console.log("Bonus battle stored successfully:",e.data)}catch(e){console.error("Failed to store bonus score:",((t=e.response)==null?void 0:t.data)||e.message)}},J=async()=>{var t;if(!f.value||m.value.some(e=>!e.game_id)){alert("All fields must be filled to start.");return}try{const e=await axios.post("/api/bonus-battles",{title:f.value,stake:k.value,concurrents:m.value});console.log("Bonus battle stored successfully:",e.data),await y()}catch(e){console.error("Failed to store bonus battle:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while saving the bonus battle. Please try again.")}},X=async()=>{var t;try{const e=await axios.post("/api/bonus-battles/end-battle",{bonus_battle_id:v.value.id});u.value=e.data.winner,await y()}catch(e){console.log("endBattle error:",((t=e.response)==null?void 0:t.data)||e.message)}},Y=async()=>{var t;try{await axios.post("/api/bonus-battles/finish-round",{active_bracket:w.value.id}),await y()}catch(e){console.error("Failed to finish round:",((t=e.response)==null?void 0:t.data)||e.message),alert("An error occurred while finishing the round. Please try again.")}},H=async(t,e)=>{try{await axios.put("/api/bonus-battles/edit-concurrent",{id:t,game_id:e}),await y()}catch{alert("Please try again.")}},y=async()=>{try{const t=await axios.get("/api/bonus-battles/active");if(G.value=t.data.total_battles,v.value=t.data.battle,B.value=t.data.concurrents,x.value=t.data.stage,w.value=t.data.bracket,A.value=t.data.scores,f.value="Bonus Battle #"+(G.value+1),B.value){const e=B.value;g.value=e.slice(0,2).map(a=>{const b=A.value.filter(r=>r.bonus_concurrent_id===a.id);return{...a,scores:b.length?b:[]}})}}catch(t){console.error("Failed to fetch active bonus battle:",t.message)}},V=t=>{const e=T.availableGames.find(a=>a.id===t);return e?`/storage/games/${e.image}`:""};return(t,e)=>(o(),Q(Z,{title:"Bonus Battle"},{default:W(()=>[s("div",ee,[s("div",te,[!v.value&&!u.value?(o(),l("div",ae,[s("div",se,[s("div",null,[e[3]||(e[3]=s("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"Titlu Bonus Battle",-1)),_(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),id:"title",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[h,f.value]])]),s("div",null,[e[4]||(e[4]=s("label",{for:"stake",class:"block text-sm font-medium text-gray-700"},"Miză (eg: 5-8, 5, 10-20, etc.)",-1)),_(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),id:"stake",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[h,k.value]])]),s("div",oe,[e[5]||(e[5]=s("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Participanți",-1)),(o(!0),l(S,null,U(m.value,(a,b)=>(o(),l("div",{key:b,class:"flex items-center gap-4 bg-white dark:bg-gray-700 p-4 rounded-lg shadow"},[a.game_id?(o(),l("img",{key:0,src:V(a.game_id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-lg"},null,8,le)):n("",!0),j(E(N),{options:$.value,label:"name",reduce:r=>r.id,modelValue:a.game_id,"onUpdate:modelValue":r=>a.game_id=r,placeholder:"Alege Joc",class:"flex-1 input-select"},null,8,["options","reduce","modelValue","onUpdate:modelValue"]),_(s("input",{type:"text","onUpdate:modelValue":r=>a.for_user=r,class:"flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 p-2.5",placeholder:"Cine a ales? (opțional)"},null,8,re),[[h,a.for_user]]),m.value.length>2?(o(),l("button",{key:1,onClick:r=>P(b),class:"btn-danger"}," ✕ ",8,ne)):n("",!0)]))),128)),s("div",de,[s("button",{onClick:R,class:"btn-primary"},"Adaugă Participanți"),m.value.length>2?(o(),l("button",{key:0,onClick:P,class:"btn-danger"}," Șterge ")):n("",!0)])]),s("button",{type:"button",onClick:J,class:"mt-4 bg-green-600 text-white px-4 py-2 rounded-md"},"Start ")])])):u.value?(o(),l("div",ue,[s("div",ie,[s("div",ce,[u.value.game.image?(o(),l("img",{key:0,src:V(u.value.game.id),alt:"Game Thumbnail",class:"w-32 auto mx-auto object-cover rounded-lg mb-4"},null,8,me)):n("",!0),s("h2",be," Câștigător! - "+c(u.value.game.name),1),s("p",ge," User: "+c(u.value.for_user),1)])])])):n("",!0),v.value?(o(),l("div",pe,[s("div",ve,[s("h2",ye,"Active Battle: "+c(v.value.title),1),s("p",null,"Stake: "+c(v.value.stake)+" | Etapa: "+c(x.value.name),1),g.value.length>1?(o(),l("div",_e,[(o(!0),l(S,null,U(g.value,(a,b)=>(o(),l("div",{key:b,class:"border rounded-md p-4 shadow"},[s("h3",he,c(a.game.name)+" - "+c(a.for_user),1),s("div",fe,[a.game.image?(o(),l("img",{key:0,src:V(a.game.id),alt:"Game Thumbnail",class:"w-16 h-16 object-cover rounded-lg"},null,8,xe)):n("",!0),j(E(N),{options:$.value,label:"name",reduce:r=>r.id,"onUpdate:modelValue":r=>H(a.id,r),placeholder:"Schimbi jocul?",class:"flex-1"},null,8,["options","reduce","onUpdate:modelValue"])]),s("div",null,[(o(!0),l(S,null,U(a.scores,(r,i)=>(o(),l("div",{key:i,class:"flex items-center space-x-2 mt-1"},[s("label",we,[e[6]||(e[6]=F(" Cost Buy ")),_(s("input",{type:"number","onUpdate:modelValue":p=>a.scores[i].cost_buy=p,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Amount"},null,8,ke),[[h,a.scores[i].cost_buy]])]),s("label",Be,[e[7]||(e[7]=F(" Rezultat Buy ")),_(s("input",{type:"number","onUpdate:modelValue":p=>a.scores[i].result_buy=p,class:"block w-40 border-gray-300 rounded-md shadow-sm",placeholder:"Result",onInput:p=>D(b,i)},null,40,Ce),[[h,a.scores[i].result_buy]])]),s("label",Ve,[e[8]||(e[8]=F(" Scor ")),_(s("input",{readonly:"",disabled:"",type:"number","onUpdate:modelValue":p=>a.scores[i].score=p,class:"block w-20 border-gray-300 rounded-md shadow-sm disabled input-disabled",placeholder:"Result"},null,8,Se),[[h,a.scores[i].score]])]),i>=1?(o(),l("button",{key:0,type:"button",onClick:p=>z(b,i),class:"bg-red-600 text-white px-4 py-2 rounded-md text-sm"}," X ",8,Ue)):n("",!0)]))),128)),s("button",{type:"button",onClick:e[2]||(e[2]=r=>M()),class:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-md text-sm"}," Adaugă Buy ")]),s("p",Fe," Scor Total: "+c(L(a.scores)),1)]))),128))])):n("",!0),u.value?(o(),l("div",Ae,[s("p",Ge,"Câștigător: "+c(u.value.game.name)+" | User: "+c(u.value.for_user),1)])):n("",!0),x.value.name!=="Final"?(o(),l("button",{key:2,type:"button",onClick:Y,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Următoarii Concurenți ")):n("",!0),x.value.name==="Final"?(o(),l("button",{key:3,type:"button",onClick:X,class:"mt-6 bg-green-600 text-white px-4 py-2 rounded-md"}," Termina Battle ")):n("",!0)])])):n("",!0)])])]),_:1}))}};export{Re as default};
